import{r as s,R as G,j as e}from"./react-vendor-D244Vx8q.js";import{u as J,a as Q,s as f,g as z,U as x,c as X,E as W,d as Y,C as Z,M as _,L as ee,f as re}from"./index-BcV99Zb4.js";import"./vendor-kkeqS5Xn.js";import"./qr-utils-B8AONaXL.js";import"./firebase-CUKyr0uK.js";const ae=15,te=()=>{const[a,b]=s.useState([]),[h,g]=s.useState([]),[c,p]=s.useState([]),[N,T]=s.useState(!1),[u,k]=s.useState(!1),{addToast:y}=J(),[v,C]=s.useState(1),[S,M]=s.useState([void 0]),[D,H]=s.useState(!0),[R,V]=s.useState(""),A=Q(R,300),[i,E]=s.useState({searchTerm:"",role:"",courseId:"",classId:""});s.useEffect(()=>{(async()=>{const[l,n]=await Promise.all([f.getCourses(),f.getClasses()]);g(l),p(n)})()},[]);const o=s.useCallback(async(t,l)=>{T(!0);try{const n=S[t-1],{data:O,nextCursor:L}=await f.getUsers({limit:ae,cursor:n,filters:l});b(O),H(!!L),L&&S.length<=t&&M(P=>[...P,L])}catch(n){console.error(n),y("error","Erro ao carregar usuÃ¡rios.")}finally{T(!1)}},[S,y]);s.useEffect(()=>{E(t=>({...t,searchTerm:A}))},[A]),s.useEffect(()=>{M([void 0]),C(1),o(1,i)},[i]);const w=()=>{if(!D)return;const t=v+1;C(t),o(t,i)},j=()=>{if(v===1)return;const t=v-1;C(t),o(t,i)},F=async t=>{k(!0);try{const l=t.role===x.ADMIN?x.USER:x.ADMIN;await f.updateUserRole(t.uid,l),y("success",`Role de ${t.name} alterada para ${l}.`),I()}catch(l){y("error",z(l))}finally{k(!1)}},$=async t=>{k(!0);try{await f.deleteUser(t),y("success","UsuÃ¡rio excluÃ­do."),I()}catch(l){y("error",z(l))}finally{k(!1)}},q=async(t,l)=>{k(!0);try{await f.updateUserProfile(t,l),y("success","Perfil atualizado."),I()}catch(n){throw n}finally{k(!1)}},I=()=>{M([void 0]),C(1),o(1,i)},B=s.useCallback(t=>{var l;return((l=h.find(n=>n.id===t))==null?void 0:l.name)||"-"},[h]),d=s.useCallback(t=>{var l;return((l=c.find(n=>n.id===t))==null?void 0:l.name)||"-"},[c]),U=s.useMemo(()=>i.courseId?c.filter(t=>t.courseId===i.courseId):[],[c,i.courseId]);return{users:a,courses:h,classes:c,loading:N,actionLoading:u,currentPage:v,hasNextPage:D,localSearchTerm:R,filters:i,availableClassesForFilter:U,setLocalSearchTerm:V,setFilters:E,handleNextPage:w,handlePrevPage:j,updateUserRole:F,deleteUser:$,updateUserProfile:q,getCourseName:B,getClassName:d,refresh:I}},se=G.memo(({user:a,courseName:b,className:h,onEdit:g,onRequestRoleChange:c,onRequestDelete:p,onViewEnrollments:N})=>e.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center text-primary dark:text-indigo-300 font-bold text-sm",children:a.name?a.name.charAt(0):a.email.charAt(0).toUpperCase()}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.name||"Sem nome"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.email})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:b}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:h})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:a.rm||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${a.role===x.ADMIN?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"}`,children:a.role===x.ADMIN?"Admin":"Aluno"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end gap-1 opacity-80 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>N(a),className:"p-2 text-cyan-600 hover:bg-cyan-50 dark:text-cyan-400 dark:hover:bg-cyan-900/20 rounded-lg transition-colors",title:"Ver HistÃ³rico de InscriÃ§Ãµes",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})})}),e.jsx("button",{onClick:()=>g(a),className:"p-2 text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"Editar Dados do UsuÃ¡rio",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})})}),e.jsx("button",{onClick:()=>c(a),className:`p-2 rounded-lg transition-colors ${a.role===x.ADMIN?"text-amber-600 hover:bg-amber-50 dark:text-amber-400 dark:hover:bg-amber-900/20":"text-gray-400 hover:text-amber-600 hover:bg-amber-50 dark:hover:text-amber-400 dark:hover:bg-amber-900/20"}`,title:a.role===x.ADMIN?"Remover PermissÃ£o de Admin":"Promover a Admin",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})}),e.jsx("button",{onClick:()=>p(a),className:"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 dark:hover:text-red-400 dark:hover:bg-red-900/20 rounded-lg transition-colors",title:"Excluir UsuÃ¡rio Permanentemente",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})})]})),de=G.memo(({user:a,courseName:b,className:h,onEdit:g,onRequestRoleChange:c,onRequestDelete:p,onViewEnrollments:N})=>e.jsxs("div",{className:"bg-white dark:bg-darkcard shadow rounded-lg p-4 flex flex-col space-y-3 border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center text-primary dark:text-indigo-300 font-bold",children:a.name?a.name.charAt(0):a.email.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 dark:text-white",children:a.name||"Sem nome"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:a.email})]})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${a.role===x.ADMIN?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"}`,children:a.role})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm border-t border-b border-gray-100 dark:border-gray-700 py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs block",children:"Curso"}),e.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:b})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs block",children:"Turma"}),e.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:h})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs block",children:"RM"}),e.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:a.rm||"-"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-1 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>N(a),className:"text-cyan-600 dark:text-cyan-400 text-sm font-medium border border-cyan-100 dark:border-cyan-900 px-2 py-1 rounded hover:bg-cyan-50 dark:hover:bg-cyan-900/30 flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Agenda"]}),e.jsx("button",{onClick:()=>g(a),className:"text-indigo-600 dark:text-indigo-400 text-sm font-medium border border-indigo-100 dark:border-indigo-900 px-2 py-1 rounded hover:bg-indigo-50 dark:hover:bg-indigo-900/30",children:"Editar"}),e.jsx("button",{onClick:()=>c(a),className:"text-amber-600 dark:text-amber-400 text-sm font-medium border border-amber-100 dark:border-amber-900 px-2 py-1 rounded hover:bg-amber-50 dark:hover:bg-amber-900/30",children:a.role===x.ADMIN?"User":"Admin"}),e.jsx("button",{onClick:()=>p(a),className:"text-red-600 dark:text-red-400 text-sm font-medium border border-red-100 dark:border-red-900 px-2 py-1 rounded hover:bg-red-50 dark:hover:bg-red-900/30",children:"Excluir"})]})]})),xe=()=>{const{users:a,courses:b,classes:h,loading:g,actionLoading:c,currentPage:p,hasNextPage:N,localSearchTerm:T,filters:u,availableClassesForFilter:k,setLocalSearchTerm:y,setFilters:v,handleNextPage:C,handlePrevPage:S,updateUserRole:M,deleteUser:D,updateUserProfile:H,getCourseName:R,getClassName:V}=te(),{addToast:A}=J(),[i,E]=s.useState(null),[o,w]=s.useState({name:"",rm:"",courseId:"",classId:""}),[j,F]=s.useState(null),[$,q]=s.useState([]),[I,B]=s.useState(!1),[d,U]=s.useState(null),t=s.useCallback(r=>{E(r),w({name:r.name||"",rm:r.rm||"",courseId:r.courseId||"",classId:r.classId||""})},[]),l=s.useCallback(r=>U({type:"ROLE",user:r}),[]),n=s.useCallback(r=>U({type:"DELETE",user:r}),[]),O=async()=>{if(d)try{d.type==="DELETE"?await D(d.user.uid):d.type==="ROLE"&&await M(d.user),U(null)}catch{}},L=async r=>{if(r.preventDefault(),!!i)try{await H(i.uid,o),E(null)}catch(m){A("error",z(m))}},P=s.useCallback(async r=>{F(r),B(!0);try{const m=await f.getUserEnrollmentsDetails(r.uid);q(m)}catch(m){console.error(m),q([])}finally{B(!1)}},[]),K=async r=>{j&&(await f.cancelEnrollment(r),A("success","InscriÃ§Ã£o removida."),P(j))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Gerenciamento de UsuÃ¡rios"}),e.jsxs("div",{className:"bg-white dark:bg-darkcard p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Buscar"}),e.jsx("input",{type:"text",placeholder:"Nome, Email ou RM...",className:"w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:T,onChange:r=>y(r.target.value)})]}),e.jsxs("div",{className:"w-full md:w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Perfil"}),e.jsxs("select",{className:"w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:u.role,onChange:r=>v({...u,role:r.target.value}),children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:x.ADMIN,children:"Admin"}),e.jsx("option",{value:x.USER,children:"User"})]})]}),e.jsxs("div",{className:"w-full md:w-48",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Curso"}),e.jsxs("select",{className:"w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:u.courseId,onChange:r=>{v({...u,courseId:r.target.value,classId:""})},children:[e.jsx("option",{value:"",children:"Todos os Cursos"}),b.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{className:"w-full md:w-48",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Turma"}),e.jsxs("select",{className:"w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white disabled:bg-gray-100 dark:disabled:bg-gray-700",value:u.classId,onChange:r=>v({...u,classId:r.target.value}),disabled:!u.courseId,children:[e.jsx("option",{value:"",children:"Todas as Turmas"}),k.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-darkcard shadow overflow-x-auto sm:rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700 hidden md:table",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"UsuÃ¡rio"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Curso/Turma"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"RM"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-darkcard divide-y divide-gray-200 dark:divide-gray-700",children:g?Array.from({length:5}).map((r,m)=>e.jsx(X,{},m)):a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-0",children:e.jsx(W,{title:"Nenhum usuÃ¡rio",description:"Tente ajustar os filtros."})})}):a.map(r=>e.jsx(se,{user:r,courseName:R(r.courseId),className:V(r.classId),onEdit:t,onRequestRoleChange:l,onRequestDelete:n,onViewEnrollments:P},r.uid))})]}),e.jsx("div",{className:"md:hidden p-4 space-y-4 bg-gray-50 dark:bg-darkbg",children:g?Array.from({length:5}).map((r,m)=>e.jsx(Y,{},m)):a.length===0?e.jsx(W,{title:"Nenhum usuÃ¡rio",description:"Tente ajustar os filtros."}):a.map(r=>e.jsx(de,{user:r,courseName:R(r.courseId),className:V(r.classId),onEdit:t,onRequestRoleChange:l,onRequestDelete:n,onViewEnrollments:P},r.uid))})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("button",{onClick:S,disabled:p===1||g,className:"px-4 py-2 bg-white dark:bg-darkcard border dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:"Anterior"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["PÃ¡gina ",p]}),e.jsx("button",{onClick:C,disabled:!N||g,className:"px-4 py-2 bg-white dark:bg-darkcard border dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:"PrÃ³ximo"})]}),e.jsx(Z,{isOpen:!!d,onClose:()=>U(null),onConfirm:O,title:"Confirmar AÃ§Ã£o",message:(d==null?void 0:d.type)==="DELETE"?`Tem certeza que deseja excluir ${d.user.name}?`:`Deseja alterar o perfil de ${d==null?void 0:d.user.name} para ${(d==null?void 0:d.user.role)===x.ADMIN?"USUÃRIO":"ADMIN"}?`,isProcessing:c,variant:(d==null?void 0:d.type)==="DELETE"?"danger":"primary"}),e.jsx(_,{isOpen:!!i,onClose:()=>E(null),title:"Editar UsuÃ¡rio",children:e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-300",children:"Nome Completo"}),e.jsx("input",{type:"text",className:"mt-1 w-full border dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:o.name,onChange:r=>w({...o,name:r.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-300",children:"RM"}),e.jsx("input",{type:"text",className:"mt-1 w-full border dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:o.rm,onChange:r=>w({...o,rm:r.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-300",children:"Curso"}),e.jsxs("select",{className:"mt-1 w-full border dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:o.courseId,onChange:r=>w({...o,courseId:r.target.value,classId:""}),children:[e.jsx("option",{value:"",children:"Selecione..."}),b.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-300",children:"Turma"}),e.jsxs("select",{className:"mt-1 w-full border dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:o.classId,onChange:r=>w({...o,classId:r.target.value}),disabled:!o.courseId,children:[e.jsx("option",{value:"",children:"Selecione..."}),h.filter(r=>r.courseId===o.courseId).map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsx(ee,{type:"submit",isLoading:c,className:"w-full",children:"Salvar"})]})}),e.jsx(_,{isOpen:!!j,onClose:()=>F(null),title:`Agenda: ${j==null?void 0:j.name}`,children:e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto",children:I?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Carregando..."}):$.length===0?e.jsx("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700 rounded text-gray-500 dark:text-gray-300",children:"Nenhuma inscriÃ§Ã£o."}):e.jsx("ul",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:$.map((r,m)=>e.jsxs("li",{className:"py-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm text-gray-900 dark:text-white",children:r.eventName}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ðŸ“… ",re(r.sessionDate)," â€¢ â° ",r.sessionTime]})]}),e.jsx("button",{onClick:()=>K(r.enrollmentId),className:"text-red-500 dark:text-red-400 text-xs font-bold border dark:border-red-900 px-2 py-1 rounded hover:bg-red-50 dark:hover:bg-red-900/30",children:"Remover"})]},m))})})})]})};export{xe as AdminUsers};
