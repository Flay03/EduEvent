import{r as s,R as W,j as e}from"./react-vendor-D244Vx8q.js";import{u as J,a as Q,s as v,g as _,U as g,c as X,E as H,d as Y,C as Z,M as G,L as ee,f as ae}from"./index-BrJzFuZA.js";import"./vendor-kkeqS5Xn.js";import"./qr-utils-B8AONaXL.js";import"./firebase-CUKyr0uK.js";const re=15,te=()=>{const[r,b]=s.useState([]),[h,m]=s.useState([]),[c,p]=s.useState([]),[N,A]=s.useState(!1),[u,k]=s.useState(!1),{addToast:y}=J(),[j,C]=s.useState(1),[S,R]=s.useState([void 0]),[L,z]=s.useState(!0),[T,V]=s.useState(""),P=Q(T,300),[i,E]=s.useState({searchTerm:"",role:"",courseId:"",classId:""});s.useEffect(()=>{(async()=>{const[l,n]=await Promise.all([v.getCourses(),v.getClasses()]);m(l),p(n)})()},[]);const o=s.useCallback(async(t,l)=>{A(!0);try{const n=S[t-1],{data:B,nextCursor:M}=await v.getUsers({limit:re,cursor:n,filters:l});b(B),z(!!M),M&&S.length<=t&&R(D=>[...D,M])}catch(n){console.error(n),y("error","Erro ao carregar usuÃ¡rios.")}finally{A(!1)}},[S,y]);s.useEffect(()=>{E(t=>({...t,searchTerm:P}))},[P]),s.useEffect(()=>{R([void 0]),C(1),o(1,i)},[i]);const w=()=>{if(!L)return;const t=j+1;C(t),o(t,i)},f=()=>{if(j===1)return;const t=j-1;C(t),o(t,i)},F=async t=>{k(!0);try{const l=t.role===g.ADMIN?g.USER:g.ADMIN;await v.updateUserRole(t.uid,l),y("success",`Role de ${t.name} alterada para ${l}.`),I()}catch(l){y("error",_(l))}finally{k(!1)}},q=async t=>{k(!0);try{await v.deleteUser(t),y("success","UsuÃ¡rio excluÃ­do."),I()}catch(l){y("error",_(l))}finally{k(!1)}},$=async(t,l)=>{k(!0);try{await v.updateUserProfile(t,l),y("success","Perfil atualizado."),I()}catch(n){throw n}finally{k(!1)}},I=()=>{R([void 0]),C(1),o(1,i)},O=s.useCallback(t=>{var l;return((l=h.find(n=>n.id===t))==null?void 0:l.name)||"-"},[h]),d=s.useCallback(t=>{var l;return((l=c.find(n=>n.id===t))==null?void 0:l.name)||"-"},[c]),U=s.useMemo(()=>i.courseId?c.filter(t=>t.courseId===i.courseId):[],[c,i.courseId]);return{users:r,courses:h,classes:c,loading:N,actionLoading:u,currentPage:j,hasNextPage:L,localSearchTerm:T,filters:i,availableClassesForFilter:U,setLocalSearchTerm:V,setFilters:E,handleNextPage:w,handlePrevPage:f,updateUserRole:F,deleteUser:q,updateUserProfile:$,getCourseName:O,getClassName:d,refresh:I}},se=W.memo(({user:r,courseName:b,className:h,onEdit:m,onRequestRoleChange:c,onRequestDelete:p,onViewEnrollments:N})=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center text-primary dark:text-indigo-300 font-bold",children:r.name?r.name.charAt(0):r.email.charAt(0).toUpperCase()}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:r.name||"Sem nome"}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.email})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm text-gray-900 dark:text-white",children:b}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:h})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:r.rm||"-"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${r.role===g.ADMIN?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"}`,children:r.role})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[e.jsx("button",{onClick:()=>N(r),className:"text-cyan-600 hover:text-cyan-900 dark:text-cyan-400 dark:hover:text-cyan-300",title:"Ver InscriÃ§Ãµes",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("button",{onClick:()=>m(r),className:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300",children:"Editar"}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("button",{onClick:()=>c(r),className:"text-amber-600 hover:text-amber-900 dark:text-amber-400 dark:hover:text-amber-300",children:r.role===g.ADMIN?"Virar User":"Virar Admin"}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"|"}),e.jsx("button",{onClick:()=>p(r),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:"Excluir"})]})]})),de=W.memo(({user:r,courseName:b,className:h,onEdit:m,onRequestRoleChange:c,onRequestDelete:p,onViewEnrollments:N})=>e.jsxs("div",{className:"bg-white dark:bg-darkcard shadow rounded-lg p-4 flex flex-col space-y-3 border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900/50 flex items-center justify-center text-primary dark:text-indigo-300 font-bold",children:r.name?r.name.charAt(0):r.email.charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-bold text-gray-900 dark:text-white",children:r.name||"Sem nome"}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.email})]})]}),e.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${r.role===g.ADMIN?"bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-300":"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"}`,children:r.role})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm border-t border-b border-gray-100 dark:border-gray-700 py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs block",children:"Curso"}),e.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:b})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs block",children:"Turma"}),e.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:h})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs block",children:"RM"}),e.jsx("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:r.rm||"-"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-1 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>N(r),className:"text-cyan-600 dark:text-cyan-400 text-sm font-medium border border-cyan-100 dark:border-cyan-900 px-2 py-1 rounded hover:bg-cyan-50 dark:hover:bg-cyan-900/30 flex items-center",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),"Agenda"]}),e.jsx("button",{onClick:()=>m(r),className:"text-indigo-600 dark:text-indigo-400 text-sm font-medium border border-indigo-100 dark:border-indigo-900 px-2 py-1 rounded hover:bg-indigo-50 dark:hover:bg-indigo-900/30",children:"Editar"}),e.jsx("button",{onClick:()=>c(r),className:"text-amber-600 dark:text-amber-400 text-sm font-medium border border-amber-100 dark:border-amber-900 px-2 py-1 rounded hover:bg-amber-50 dark:hover:bg-amber-900/30",children:r.role===g.ADMIN?"User":"Admin"}),e.jsx("button",{onClick:()=>p(r),className:"text-red-600 dark:text-red-400 text-sm font-medium border border-red-100 dark:border-red-900 px-2 py-1 rounded hover:bg-red-50 dark:hover:bg-red-900/30",children:"Excluir"})]})]})),xe=()=>{const{users:r,courses:b,classes:h,loading:m,actionLoading:c,currentPage:p,hasNextPage:N,localSearchTerm:A,filters:u,availableClassesForFilter:k,setLocalSearchTerm:y,setFilters:j,handleNextPage:C,handlePrevPage:S,updateUserRole:R,deleteUser:L,updateUserProfile:z,getCourseName:T,getClassName:V}=te(),{addToast:P}=J(),[i,E]=s.useState(null),[o,w]=s.useState({name:"",rm:"",courseId:"",classId:""}),[f,F]=s.useState(null),[q,$]=s.useState([]),[I,O]=s.useState(!1),[d,U]=s.useState(null),t=s.useCallback(a=>{E(a),w({name:a.name||"",rm:a.rm||"",courseId:a.courseId||"",classId:a.classId||""})},[]),l=s.useCallback(a=>U({type:"ROLE",user:a}),[]),n=s.useCallback(a=>U({type:"DELETE",user:a}),[]),B=async()=>{if(d)try{d.type==="DELETE"?await L(d.user.uid):d.type==="ROLE"&&await R(d.user),U(null)}catch{}},M=async a=>{if(a.preventDefault(),!!i)try{await z(i.uid,o),E(null)}catch(x){P("error",_(x))}},D=s.useCallback(async a=>{F(a),O(!0);try{const x=await v.getUserEnrollmentsDetails(a.uid);$(x)}catch(x){console.error(x),$([])}finally{O(!1)}},[]),K=async a=>{f&&(await v.cancelEnrollment(a),P("success","InscriÃ§Ã£o removida."),D(f))};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col justify-between gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Gerenciamento de UsuÃ¡rios"}),e.jsxs("div",{className:"bg-white dark:bg-darkcard p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Buscar"}),e.jsx("input",{type:"text",placeholder:"Nome, Email ou RM...",className:"w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:A,onChange:a=>y(a.target.value)})]}),e.jsxs("div",{className:"w-full md:w-40",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Perfil"}),e.jsxs("select",{className:"w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:u.role,onChange:a=>j({...u,role:a.target.value}),children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:g.ADMIN,children:"Admin"}),e.jsx("option",{value:g.USER,children:"User"})]})]}),e.jsxs("div",{className:"w-full md:w-48",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Curso"}),e.jsxs("select",{className:"w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:u.courseId,onChange:a=>{j({...u,courseId:a.target.value,classId:""})},children:[e.jsx("option",{value:"",children:"Todos os Cursos"}),b.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"w-full md:w-48",children:[e.jsx("label",{className:"block text-xs font-medium text-gray-500 dark:text-gray-400 mb-1",children:"Turma"}),e.jsxs("select",{className:"w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white disabled:bg-gray-100 dark:disabled:bg-gray-700",value:u.classId,onChange:a=>j({...u,classId:a.target.value}),disabled:!u.courseId,children:[e.jsx("option",{value:"",children:"Todas as Turmas"}),k.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-darkcard shadow overflow-x-auto sm:rounded-lg border border-gray-200 dark:border-gray-700",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700 hidden md:table",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"UsuÃ¡rio"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Curso/Turma"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"RM"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-darkcard divide-y divide-gray-200 dark:divide-gray-700",children:m?Array.from({length:5}).map((a,x)=>e.jsx(X,{},x)):r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"p-0",children:e.jsx(H,{title:"Nenhum usuÃ¡rio",description:"Tente ajustar os filtros."})})}):r.map(a=>e.jsx(se,{user:a,courseName:T(a.courseId),className:V(a.classId),onEdit:t,onRequestRoleChange:l,onRequestDelete:n,onViewEnrollments:D},a.uid))})]}),e.jsx("div",{className:"md:hidden p-4 space-y-4 bg-gray-50 dark:bg-darkbg",children:m?Array.from({length:5}).map((a,x)=>e.jsx(Y,{},x)):r.length===0?e.jsx(H,{title:"Nenhum usuÃ¡rio",description:"Tente ajustar os filtros."}):r.map(a=>e.jsx(de,{user:a,courseName:T(a.courseId),className:V(a.classId),onEdit:t,onRequestRoleChange:l,onRequestDelete:n,onViewEnrollments:D},a.uid))})]}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("button",{onClick:S,disabled:p===1||m,className:"px-4 py-2 bg-white dark:bg-darkcard border dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:"Anterior"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["PÃ¡gina ",p]}),e.jsx("button",{onClick:C,disabled:!N||m,className:"px-4 py-2 bg-white dark:bg-darkcard border dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:"PrÃ³ximo"})]}),e.jsx(Z,{isOpen:!!d,onClose:()=>U(null),onConfirm:B,title:"Confirmar AÃ§Ã£o",message:(d==null?void 0:d.type)==="DELETE"?`Tem certeza que deseja excluir ${d.user.name}?`:`Deseja alterar o perfil de ${d==null?void 0:d.user.name} para ${(d==null?void 0:d.user.role)===g.ADMIN?"USUÃRIO":"ADMIN"}?`,isProcessing:c,variant:(d==null?void 0:d.type)==="DELETE"?"danger":"primary"}),e.jsx(G,{isOpen:!!i,onClose:()=>E(null),title:"Editar UsuÃ¡rio",children:e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-300",children:"Nome Completo"}),e.jsx("input",{type:"text",className:"mt-1 w-full border dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:o.name,onChange:a=>w({...o,name:a.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-300",children:"RM"}),e.jsx("input",{type:"text",className:"mt-1 w-full border dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:o.rm,onChange:a=>w({...o,rm:a.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-300",children:"Curso"}),e.jsxs("select",{className:"mt-1 w-full border dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:o.courseId,onChange:a=>w({...o,courseId:a.target.value,classId:""}),children:[e.jsx("option",{value:"",children:"Selecione..."}),b.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-gray-700 dark:text-gray-300",children:"Turma"}),e.jsxs("select",{className:"mt-1 w-full border dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-700 text-gray-900 dark:text-white",value:o.classId,onChange:a=>w({...o,classId:a.target.value}),disabled:!o.courseId,children:[e.jsx("option",{value:"",children:"Selecione..."}),h.filter(a=>a.courseId===o.courseId).map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsx(ee,{type:"submit",isLoading:c,className:"w-full",children:"Salvar"})]})}),e.jsx(G,{isOpen:!!f,onClose:()=>F(null),title:`Agenda: ${f==null?void 0:f.name}`,children:e.jsx("div",{className:"space-y-4 max-h-[60vh] overflow-y-auto",children:I?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"Carregando..."}):q.length===0?e.jsx("div",{className:"text-center py-8 bg-gray-50 dark:bg-gray-700 rounded text-gray-500 dark:text-gray-300",children:"Nenhuma inscriÃ§Ã£o."}):e.jsx("ul",{className:"divide-y divide-gray-200 dark:divide-gray-600",children:q.map((a,x)=>e.jsxs("li",{className:"py-3 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-sm text-gray-900 dark:text-white",children:a.eventName}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["ðŸ“… ",ae(a.sessionDate)," â€¢ â° ",a.sessionTime]})]}),e.jsx("button",{onClick:()=>K(a.enrollmentId),className:"text-red-500 dark:text-red-400 text-xs font-bold border dark:border-red-900 px-2 py-1 rounded hover:bg-red-50 dark:hover:bg-red-900/30",children:"Remover"})]},x))})})})]})};export{xe as AdminUsers};
