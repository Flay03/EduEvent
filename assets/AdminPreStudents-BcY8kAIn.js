import{r as t,j as e}from"./react-vendor-D244Vx8q.js";import{u as te,a as ae,s as i,L as se,C as de}from"./index-BJYSapP8.js";import"./vendor-kkeqS5Xn.js";import"./qr-utils-B8AONaXL.js";import"./firebase-CUKyr0uK.js";const oe=20,xe=()=>{const{addToast:n}=te(),[k,E]=t.useState(!1),[q,I]=t.useState(!1),[G,_]=t.useState([]),[u,B]=t.useState([]),[l,P]=t.useState({preRegistrationEnabled:!1}),[j,H]=t.useState(""),[h,R]=t.useState(""),[A,T]=t.useState(""),[g,v]=t.useState([]),[M,w]=t.useState(null),[V,D]=t.useState([]),[x,Q]=t.useState(""),b=ae(x,300),[m,N]=t.useState(1),[L,O]=t.useState([void 0]),[$,J]=t.useState(!0),[y,C]=t.useState(null);t.useEffect(()=>{K(),U()},[]),t.useEffect(()=>{O([void 0]),N(1),p(1,b)},[b]);const K=async()=>{const[r,s]=await Promise.all([i.getCourses(),i.getClasses()]);_(r),B(s)},U=async()=>{const r=await i.getSystemConfig();P(r)},p=async(r,s)=>{E(!0);try{const o=L[r-1],{data:c,nextCursor:a}=await i.getPreStudents({limit:oe,cursor:o,filters:{classId:s}});D(c),J(!!a),a&&L.length<=r&&O(f=>{const d=[...f];return d[r]=a,d})}catch(o){console.error(o),n("error","Erro ao carregar lista de alunos.")}finally{E(!1)}},W=()=>{if(!$)return;const r=m+1;N(r),p(r,b)},X=()=>{if(m===1)return;const r=m-1;N(r),p(r,b)},Y=async()=>{try{const r=!l.preRegistrationEnabled;await i.updateSystemConfig({preRegistrationEnabled:r}),P({preRegistrationEnabled:r}),n("success",`Sistema de Pré-Cadastro ${r?"ATIVADO":"DESATIVADO"}`)}catch{n("error","Erro ao atualizar configuração.")}},Z=()=>{if(w(null),!h){w("Selecione uma turma primeiro.");return}const r=u.find(a=>a.id===h);if(!r)return;const s=A.split(`
`).filter(a=>a.trim().length>0),o=[],c=[];s.forEach((a,f)=>{let d;if(a.includes(";")?d=a.split(";"):d=a.split(/\t|\s{2,}/),d.length<2){const S=a.indexOf(" ");if(S>0)d=[a.substring(0,S),a.substring(S+1)];else{c.push(`Linha ${f+1}: Formato inválido (esperado: RM;Nome ou RM<tab>Nome)`);return}}const F=d[0].trim(),z=d[1].trim();if(!F||!z){c.push(`Linha ${f+1}: RM ou Nome vazio.`);return}o.push({rm:F,name:z,classId:r.id,courseId:r.courseId})}),c.length>0?(w(c.join(`
`)),v([])):v(o)},ee=async()=>{if(g.length!==0){I(!0);try{await i.addPreStudents(g),n("success",`${g.length} alunos importados com sucesso!`),v([]),T(""),(!x||x===h)&&p(1,x)}catch{n("error","Erro ao importar alunos.")}finally{I(!1)}}},re=async()=>{if(y)try{await i.deletePreStudent(y),n("success","Aluno removido do pré-cadastro."),D(r=>r.filter(s=>s.rm!==y)),C(null)}catch{n("error","Erro ao remover aluno.")}};return e.jsxs("div",{className:"space-y-8 animate-fade-in",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Gerenciamento de Pré-Cadastro de Alunos"}),e.jsxs("div",{className:`p-4 rounded-lg border flex items-center justify-between transition-colors ${l.preRegistrationEnabled?"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-800":"bg-gray-50 border-gray-200 dark:bg-gray-800 dark:border-gray-700"}`,children:[e.jsxs("div",{children:[e.jsxs("h3",{className:`font-bold ${l.preRegistrationEnabled?"text-green-800 dark:text-green-300":"text-gray-700 dark:text-gray-300"}`,children:["Sistema de Pré-Cadastro: ",l.preRegistrationEnabled?"ATIVO":"INATIVO"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Quando ativo, novos usuários devem informar um RM válido cadastrado abaixo para acessar o sistema."})]}),e.jsx("button",{onClick:Y,className:`px-4 py-2 rounded-md font-bold text-white shadow-sm transition-colors ${l.preRegistrationEnabled?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600"}`,children:l.preRegistrationEnabled?"DESATIVAR":"ATIVAR"})]}),e.jsxs("div",{className:"bg-white dark:bg-darkcard shadow rounded-lg border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Importação em Massa"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Curso"}),e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:j,onChange:r=>{H(r.target.value),R("")},children:[e.jsx("option",{value:"",children:"Selecione o Curso..."}),G.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Turma"}),e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-md p-2 bg-white dark:bg-gray-800 text-gray-900 dark:text-white disabled:opacity-50",value:h,onChange:r=>R(r.target.value),disabled:!j,children:[e.jsx("option",{value:"",children:"Selecione a Turma..."}),u.filter(r=>r.courseId===j).map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Cole a lista de alunos (Aceita formato Excel/Tab ou RM;Nome)"}),e.jsx("textarea",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-md p-3 font-mono text-sm bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white h-40",placeholder:`12345	Nome do Aluno (Tabulado)
67890;Outro Aluno (Ponto e Vírgula)`,value:A,onChange:r=>T(r.target.value)}),M&&e.jsx("div",{className:"mt-2 p-3 bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-300 text-xs rounded whitespace-pre-wrap",children:M})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("button",{onClick:Z,className:"px-4 py-2 border border-gray-300 dark:border-gray-600 rounded text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 transition",children:"Verificar Formato"}),g.length>0&&e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:[g.length," alunos válidos"]}),e.jsx(se,{onClick:ee,isLoading:q,className:"bg-primary hover:bg-indigo-700 text-white",children:"Confirmar Importação"})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-darkcard shadow rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Alunos Pré-Cadastrados"}),e.jsx("div",{className:"w-full md:w-64",children:e.jsxs("select",{className:"w-full border border-gray-300 dark:border-gray-600 rounded-md p-2 text-sm bg-white dark:bg-gray-800 text-gray-900 dark:text-white",value:x,onChange:r=>Q(r.target.value),children:[e.jsx("option",{value:"",children:"Todas as Turmas"}),u.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})})]}),k?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Carregando..."}):V.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"Nenhum aluno encontrado no pré-cadastro para esta seleção."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"RM"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Nome"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Turma"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"bg-white dark:bg-darkcard divide-y divide-gray-200 dark:divide-gray-700",children:V.map(r=>{var s;return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:r.rm}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:r.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:((s=u.find(o=>o.id===r.classId))==null?void 0:s.name)||r.classId}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("button",{onClick:()=>C(r.rm),className:"text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300",children:"Excluir"})})]},r.rm)})})]})}),e.jsxs("div",{className:"flex justify-between items-center px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:X,disabled:m===1||k,className:"px-4 py-2 bg-white dark:bg-darkcard border dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:"Anterior"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Página ",m]}),e.jsx("button",{onClick:W,disabled:!$||k,className:"px-4 py-2 bg-white dark:bg-darkcard border dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50",children:"Próximo"})]})]})]}),e.jsx(de,{isOpen:!!y,onClose:()=>C(null),onConfirm:re,title:"Remover Aluno",message:"Tem certeza que deseja remover este aluno do pré-cadastro? Isso não afetará usuários que já se registraram.",confirmText:"Remover"})]})};export{xe as AdminPreStudents};
