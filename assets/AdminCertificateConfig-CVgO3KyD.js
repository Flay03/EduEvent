import{r as g,j as e}from"./react-vendor-D244Vx8q.js";import{u as Y,L as Z,s as M,e as O}from"./index-BcV99Zb4.js";import"./vendor-kkeqS5Xn.js";import"./qr-utils-B8AONaXL.js";import"./firebase-CUKyr0uK.js";const j=297,w=210,n=c=>c*3.7795275591,L=c=>c/3.7795275591,K=()=>{const{addToast:c}=Y(),[$,F]=g.useState(!1),[N,S]=g.useState(!0),[o,i]=g.useState({backgroundType:"color",backgroundColor:"#FFFFFF",showBorder:!0,elements:[]}),[C,h]=g.useState(null),f=g.useRef(null),[y,E]=g.useState(.5);g.useEffect(()=>{(async()=>{S(!0);try{const a=await M.getCertificateConfig();a&&a.elements?(a.showBorder===void 0&&(a.showBorder=!0),i(a)):i({backgroundType:"color",backgroundColor:"#FFFFFF",showBorder:!0,elements:[]})}catch{c("error","Falha ao carregar configuraÃ§Ãµes.")}finally{S(!1)}})()},[c]),g.useEffect(()=>{if(!N)return v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)},[N]);const v=()=>{if(f.current){const{clientWidth:r,clientHeight:a}=f.current,s=60,d=n(j),m=n(w),x=(r-s)/d,b=(a-s)/m,u=Math.min(x,b);E(Math.max(.2,Math.min(u,1.5)))}},W=()=>E(r=>Math.min(r+.1,2)),A=()=>E(r=>Math.max(r-.1,.2)),z=async()=>{F(!0);try{await M.updateCertificateConfig(o),c("success","Layout salvo com sucesso!")}catch{c("error","Erro ao salvar.")}finally{F(!1)}},D=async()=>{const r={uid:"1",email:"exemplo@teste.com",name:"Maria Souza",role:"user",isOnboarded:!0},a={id:"e1",name:"Workshop de InovaÃ§Ã£o",description:"",location:"AuditÃ³rio 1",visibility:"public",sessions:[],createdBy:"",createdAt:""},s={id:"s1",date:new Date().toISOString().split("T")[0],startTime:"14:00",endTime:"18:00",capacity:50,filled:0};try{await O(r,a,s,"TEST-CODE-123",o),c("success","Preview gerado.")}catch(d){console.error(d),c("error","Erro no preview.")}},T=r=>{const a={id:`el_${Date.now()}`,type:r,label:r==="text"?"Novo Texto":"Nova VariÃ¡vel",x:j/2,y:w/2,content:r==="text"?"Texto aqui":"{student_name}",fontSize:16,fontColor:"#000000",fontFamily:"helvetica",align:"center",fontWeight:"normal"};i(s=>({...s,elements:[...s.elements,a]})),h(a.id)},P=r=>{var d;const a=(d=r.target.files)==null?void 0:d[0];if(!a)return;const s=new FileReader;s.onload=m=>{var u;const x=(u=m.target)==null?void 0:u.result,b={id:`img_${Date.now()}`,type:"image",label:"Imagem",x:j/2-15,y:w/2-15,width:30,height:30,content:x,align:"center"};i(p=>({...p,elements:[...p.elements,b]})),h(b.id)},s.readAsDataURL(a)},l=(r,a)=>{i(s=>({...s,elements:s.elements.map(d=>d.id===r?{...d,...a}:d)}))},I=r=>{i(a=>({...a,elements:a.elements.filter(s=>s.id!==r)})),h(null)},B=(r,a)=>{r.stopPropagation(),h(a);const s=o.elements.find(k=>k.id===a);if(!s)return;const d=r.clientX,m=r.clientY,x=s.x,b=s.y,u=k=>{const H=(k.clientX-d)/y,_=(k.clientY-m)/y,R=L(H),X=L(_);l(a,{x:x+R,y:b+X})},p=()=>{window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",p)};window.addEventListener("mousemove",u),window.addEventListener("mouseup",p)};if(N)return e.jsx("div",{className:"p-10 text-center text-gray-500",children:"Carregando Editor..."});const t=o.elements.find(r=>r.id===C);return e.jsxs("div",{className:"flex flex-col h-[calc(100vh-100px)]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 px-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Editor de Certificados"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:D,className:"px-4 py-2 border rounded-md hover:bg-gray-100 dark:border-gray-600 dark:text-white dark:hover:bg-gray-700",children:"Preview PDF"}),e.jsx(Z,{onClick:z,isLoading:$,children:"Salvar Layout"})]})]}),e.jsxs("div",{className:"flex flex-1 gap-4 overflow-hidden px-2",children:[e.jsxs("div",{className:"w-64 bg-white dark:bg-darkcard border border-gray-200 dark:border-gray-700 rounded-lg p-4 flex flex-col gap-4 overflow-y-auto shadow-sm flex-shrink-0",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Adicionar Elemento"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>T("text"),className:"flex flex-col items-center justify-center p-3 border rounded hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 dark:text-gray-200 text-xs",children:[e.jsx("span",{className:"text-lg mb-1",children:"T"})," Texto"]}),e.jsxs("button",{onClick:()=>T("variable"),className:"flex flex-col items-center justify-center p-3 border rounded hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 dark:text-gray-200 text-xs",children:[e.jsx("span",{className:"text-lg mb-1",children:"{ }"})," VariÃ¡vel"]}),e.jsxs("label",{className:"flex flex-col items-center justify-center p-3 border rounded hover:bg-gray-50 dark:border-gray-600 dark:hover:bg-gray-700 dark:text-gray-200 text-xs cursor-pointer col-span-2",children:[e.jsx("span",{className:"text-lg mb-1",children:"ðŸ–¼ï¸"})," Imagem",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:P})]})]})]}),e.jsxs("div",{className:"border-t pt-4 dark:border-gray-700",children:[e.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase mb-2",children:"Camadas"}),e.jsx("ul",{className:"space-y-1",children:o.elements.map((r,a)=>e.jsxs("li",{onClick:()=>h(r.id),className:`text-sm p-2 rounded cursor-pointer flex justify-between items-center ${C===r.id?"bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200":"hover:bg-gray-100 dark:hover:bg-gray-800 dark:text-gray-300"}`,children:[e.jsx("span",{className:"truncate w-32",children:r.label||r.content}),e.jsx("button",{onClick:s=>{s.stopPropagation(),I(r.id)},className:"text-red-500 hover:text-red-700",children:"Ã—"})]},r.id))})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 bg-gray-100 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden relative",children:[e.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 z-20 flex items-center bg-white dark:bg-gray-800 rounded-full shadow-md border border-gray-200 dark:border-gray-600 px-2 py-1 space-x-2",children:[e.jsx("button",{onClick:A,className:"w-8 h-8 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-300",title:"Zoom Out",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),e.jsxs("span",{className:"text-xs font-bold text-gray-600 dark:text-gray-300 w-12 text-center",children:[Math.round(y*100),"%"]}),e.jsx("button",{onClick:W,className:"w-8 h-8 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center justify-center text-gray-600 dark:text-gray-300",title:"Zoom In",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsx("div",{className:"w-px h-4 bg-gray-300 dark:bg-gray-600 mx-1"}),e.jsx("button",{onClick:v,className:"px-3 py-1 text-xs font-bold text-indigo-600 dark:text-indigo-400 hover:bg-indigo-50 dark:hover:bg-indigo-900/30 rounded-full transition-colors",title:"Ajustar Ã  Tela",children:"Ajustar"})]}),e.jsx("div",{ref:f,className:"flex-1 overflow-auto flex items-center justify-center p-10 cursor-grab active:cursor-grabbing bg-gray-200/50 dark:bg-black/20",onMouseDown:r=>{r.target===f.current&&h(null)},children:e.jsxs("div",{className:"bg-white shadow-2xl relative transition-transform duration-200 ease-out origin-center shrink-0 border border-gray-300 dark:border-gray-600",style:{width:`${n(j)}px`,height:`${n(w)}px`,transform:`scale(${y})`,backgroundColor:o.backgroundColor||"#ffffff",backgroundImage:o.backgroundType==="image"&&o.backgroundImage?`url(${o.backgroundImage})`:"none",backgroundSize:"cover"},onClick:r=>r.stopPropagation(),children:[o.showBorder!==!1&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute border border-black pointer-events-none",style:{top:`${n(10)}px`,left:`${n(10)}px`,right:`${n(10)}px`,bottom:`${n(10)}px`,borderWidth:"1px"}}),e.jsx("div",{className:"absolute border border-black pointer-events-none",style:{top:`${n(12)}px`,left:`${n(12)}px`,right:`${n(12)}px`,bottom:`${n(12)}px`,borderWidth:"0.5px"}})]}),o.elements.map(r=>e.jsx("div",{onMouseDown:a=>B(a,r.id),style:{position:"absolute",left:`${n(r.x)}px`,top:`${n(r.y)}px`,fontSize:r.fontSize?`${r.fontSize*1.33}px`:"16px",color:r.fontColor,fontFamily:r.fontFamily==="times"?"Times New Roman":r.fontFamily==="courier"?"Courier New":"Arial",fontWeight:r.fontWeight==="bold"||r.fontWeight==="bolditalic"?"bold":"normal",fontStyle:r.fontWeight==="italic"||r.fontWeight==="bolditalic"?"italic":"normal",textAlign:r.align||"left",transform:r.align==="center"?"translate(-50%, -50%)":r.align==="right"?"translate(-100%, -50%)":"translate(0, -50%)",cursor:"move",border:C===r.id?"2px dashed #4F46E5":"1px dashed transparent",padding:"2px",whiteSpace:"pre-wrap",maxWidth:"80%",userSelect:"none"},children:r.type==="image"?e.jsx("img",{src:r.content,alt:"el",style:{width:r.width?`${n(r.width)}px`:"auto",height:r.height?`${n(r.height)}px`:"auto",pointerEvents:"none"}}):r.content},r.id))]})})]}),e.jsxs("div",{className:"w-72 bg-white dark:bg-darkcard border border-gray-200 dark:border-gray-700 rounded-lg p-4 overflow-y-auto shadow-sm flex-shrink-0",children:[t?e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-xs font-bold text-gray-500 uppercase border-b pb-2",children:"Propriedades"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium dark:text-gray-300",children:"ConteÃºdo"}),t.type==="variable"?e.jsxs("select",{className:"w-full mt-1 p-2 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-white text-sm",value:t.content,onChange:r=>l(t.id,{content:r.target.value}),children:[e.jsx("option",{value:"{student_name}",children:"Nome do Aluno"}),e.jsx("option",{value:"{event_name}",children:"Nome do Evento"}),e.jsx("option",{value:"{date}",children:"Data do Evento"}),e.jsx("option",{value:"{hours}",children:"Carga HorÃ¡ria"}),e.jsx("option",{value:"{enrollment_id}",children:"CÃ³digo ValidaÃ§Ã£o"}),e.jsx("option",{value:"{location}",children:"Local"}),e.jsx("option",{value:"{start_time}",children:"Hora InÃ­cio"}),e.jsx("option",{value:"{end_time}",children:"Hora Fim"})]}):t.type==="text"?e.jsx("textarea",{className:"w-full mt-1 p-2 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-white text-sm",rows:3,value:t.content,onChange:r=>l(t.id,{content:r.target.value})}):e.jsx("p",{className:"text-xs text-gray-500 italic",children:"Imagem selecionada"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium dark:text-gray-300",children:"X (mm)"}),e.jsx("input",{type:"number",className:"w-full p-1 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-white",value:Math.round(t.x),onChange:r=>l(t.id,{x:Number(r.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium dark:text-gray-300",children:"Y (mm)"}),e.jsx("input",{type:"number",className:"w-full p-1 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-white",value:Math.round(t.y),onChange:r=>l(t.id,{y:Number(r.target.value)})})]})]}),t.type!=="image"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium dark:text-gray-300",children:"Tamanho Fonte"}),e.jsx("input",{type:"range",min:"8",max:"72",className:"w-full",value:t.fontSize,onChange:r=>l(t.id,{fontSize:Number(r.target.value)})}),e.jsxs("div",{className:"text-right text-xs",children:[t.fontSize,"px"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium dark:text-gray-300",children:"Cor"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"color",className:"h-8 w-8 p-0 border-0",value:t.fontColor,onChange:r=>l(t.id,{fontColor:r.target.value})}),e.jsx("input",{type:"text",className:"flex-1 p-1 border rounded text-xs dark:bg-gray-800 dark:border-gray-600 dark:text-white",value:t.fontColor,onChange:r=>l(t.id,{fontColor:r.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium dark:text-gray-300",children:"Fonte"}),e.jsxs("select",{className:"w-full p-1 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-white text-xs",value:t.fontFamily,onChange:r=>l(t.id,{fontFamily:r.target.value}),children:[e.jsx("option",{value:"helvetica",children:"Helvetica"}),e.jsx("option",{value:"times",children:"Times"}),e.jsx("option",{value:"courier",children:"Courier"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium dark:text-gray-300",children:"Peso"}),e.jsxs("select",{className:"w-full p-1 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-white text-xs",value:t.fontWeight,onChange:r=>l(t.id,{fontWeight:r.target.value}),children:[e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"bold",children:"Negrito"}),e.jsx("option",{value:"italic",children:"ItÃ¡lico"}),e.jsx("option",{value:"bolditalic",children:"Negrito ItÃ¡lico"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium dark:text-gray-300 mb-1",children:"Alinhamento"}),e.jsx("div",{className:"flex border rounded overflow-hidden dark:border-gray-600",children:["left","center","right"].map(r=>e.jsx("button",{onClick:()=>l(t.id,{align:r}),className:`flex-1 py-1 text-xs hover:bg-gray-100 dark:hover:bg-gray-700 ${t.align===r?"bg-indigo-100 dark:bg-indigo-900 text-indigo-600 dark:text-indigo-300":"dark:text-gray-300"}`,children:r==="left"?"Esq":r==="center"?"Cen":"Dir"},r))})]})]}),t.type==="image"&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium dark:text-gray-300",children:"Largura (mm)"}),e.jsx("input",{type:"number",className:"w-full p-1 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-white",value:Math.round(t.width||0),onChange:r=>l(t.id,{width:Number(r.target.value)})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium dark:text-gray-300",children:"Altura (mm)"}),e.jsx("input",{type:"number",className:"w-full p-1 border rounded dark:bg-gray-800 dark:border-gray-600 dark:text-white",value:Math.round(t.height||0),onChange:r=>l(t.id,{height:Number(r.target.value)})})]})]}),e.jsx("button",{onClick:()=>I(t.id),className:"w-full py-2 bg-red-50 text-red-600 border border-red-200 rounded hover:bg-red-100 mt-4 text-xs font-bold",children:"Excluir Elemento"})]}):e.jsx("div",{className:"text-center text-gray-400 text-sm mt-10",children:"Selecione um elemento no canvas para editar suas propriedades."}),e.jsxs("div",{className:"border-t mt-6 pt-4 dark:border-gray-700",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase mb-2",children:"Fundo do Certificado"}),e.jsxs("select",{className:"w-full p-2 border rounded mb-2 dark:bg-gray-800 dark:border-gray-600 dark:text-white text-sm",value:o.backgroundType,onChange:r=>i({...o,backgroundType:r.target.value}),children:[e.jsx("option",{value:"color",children:"Cor SÃ³lida"}),e.jsx("option",{value:"image",children:"Imagem Personalizada"})]}),o.backgroundType==="color"&&e.jsxs("div",{className:"flex gap-2 items-center mb-4",children:[e.jsx("input",{type:"color",value:o.backgroundColor,onChange:r=>i({...o,backgroundColor:r.target.value})}),e.jsx("span",{className:"text-xs dark:text-gray-300",children:o.backgroundColor})]}),o.backgroundType==="image"&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block w-full p-2 border border-dashed rounded text-center text-xs cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 dark:border-gray-600 dark:text-gray-300",children:[o.backgroundImage?"Alterar Imagem":"Carregar Imagem",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:r=>{var s;const a=(s=r.target.files)==null?void 0:s[0];if(a){const d=new FileReader;d.onload=m=>{var x;return i({...o,backgroundImage:(x=m.target)==null?void 0:x.result})},d.readAsDataURL(a)}}})]}),o.backgroundImage&&e.jsx("button",{onClick:()=>i({...o,backgroundImage:void 0}),className:"text-xs text-red-500 mt-1 hover:underline w-full text-center",children:"Remover Fundo"})]}),e.jsxs("div",{className:"flex items-center justify-between border-t pt-3 dark:border-gray-700",children:[e.jsx("label",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"Exibir Borda"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:o.showBorder!==!1,onChange:r=>i({...o,showBorder:r.target.checked})}),e.jsx("div",{className:"w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-indigo-600"})]})]})]})]})]})]})};export{K as AdminCertificateConfig};
