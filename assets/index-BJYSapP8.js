const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminEvents-BuJdU-nY.js","assets/react-vendor-D244Vx8q.js","assets/vendor-kkeqS5Xn.js","assets/qr-utils-B8AONaXL.js","assets/firebase-CUKyr0uK.js","assets/AdminUsers-CVzGInSx.js","assets/AdminCourses-PpTtgPm_.js","assets/AdminEventEnrollments-DebcoFfC.js","assets/xlsx-SQR8kOWN.js","assets/AdminScanner-CKbXQc8_.js","assets/AdminCertificateConfig-DUHjpaCt.js","assets/AdminPreStudents-BcY8kAIn.js","assets/DevTools-DOKC7Tyj.js"])))=>i.map(i=>d[i]);
import{r as b,j as e,L as $,u as fe,a as We,R as ne,b as it,c as Tt,Q as At,H as Mt,d as Rt,e as K,N as Ie,f as Lt}from"./react-vendor-D244Vx8q.js";import{E as Dt,f as me}from"./vendor-kkeqS5Xn.js";import{i as _t,g as Ot,a as Ft,b as Pt,c as $t,s as et,d as tt,e as Ut,G as zt,f as Bt,h as F,j as ae,k as qt,o as Vt,l as z,q,w as U,m as V,n as Me,p as ie,r as he,t as ot,u as we,v as ze,x as je,y as Be,z as dt,A as lt,B as Wt,C as ct,D as ve}from"./firebase-CUKyr0uK.js";import"./qr-utils-B8AONaXL.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function s(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(a){if(a.ep)return;a.ep=!0;const n=s(a);fetch(a.href,n)}})();var B=(o=>(o.ADMIN="admin",o.COORDINATOR="coordinator",o.USER="user",o))(B||{}),Y=(o=>(o.CONFIRMED="confirmed",o.CANCELED="canceled",o.WAITLIST="waitlist",o))(Y||{});const Z=o=>{if(!o)return"";if(o.match(/^\d{4}-\d{2}-\d{2}$/)){const[t,s,r]=o.split("-");return`${r}/${s}/${t}`}try{const t=new Date(o);return isNaN(t.getTime())?o:new Intl.DateTimeFormat("pt-BR").format(t)}catch{return o}},st=o=>{if(!o)return"";try{let t;if(o.match(/^\d{4}-\d{2}-\d{2}$/)){const[s,r,a]=o.split("-").map(Number);t=new Date(s,r-1,a)}else t=new Date(o);return isNaN(t.getTime())?o:new Intl.DateTimeFormat("pt-BR",{weekday:"short",day:"2-digit",month:"2-digit"}).format(t)}catch{return o}},Pe={},Gt=o=>o&&o.apiKey&&o.projectId&&o.appId,rt={apiKey:"AIzaSyBOUAqkPhqFhsIkZVh97OJau-SzQug1PBE",authDomain:"eduevent-e50f4.firebaseapp.com",projectId:"eduevent-e50f4",storageBucket:"eduevent-e50f4.appspot.com",messagingSenderId:"964945250582",appId:"1:964945250582:web:3ce9fcdad019132561a837",measurementId:"G-KCLHFXEEML",vapidKey:(Pe==null?void 0:Pe.VITE_FIREBASE_VAPID_KEY)||""},oe={useFirebase:Gt(rt),firebase:rt},Re=oe.firebase;let Ae,Q,h,at;const mt=o=>o&&o.apiKey&&o.projectId&&o.appId,Ht=async()=>{if("serviceWorker"in navigator&&mt(Re))try{const t=`/EduEvent/firebase-messaging-sw.js?${new URLSearchParams(Re).toString()}`;return await navigator.serviceWorker.register(t,{scope:"/EduEvent/"})}catch(o){console.error("Service Worker registration failed:",o)}};try{oe.useFirebase&&mt(Re)?(Ae=_t(Re),Q=Ot(Ae),h=Ft(Ae),typeof window<"u"&&Ht().then(o=>{try{at=Pt(Ae),o&&oe.firebase.vapidKey&&$t(at,{vapidKey:oe.firebase.vapidKey,serviceWorkerRegistration:o}).catch(t=>console.log("Push token flow needs user interaction.")),console.log("Firebase Messaging initialized.")}catch(t){console.warn("Failed to initialize Firebase Messaging:",t)}}),console.log("Firebase initialized successfully.")):oe.useFirebase?console.warn("Firebase `useFirebase` is true, but config keys are missing. Please check your .env.local file. Skipping Firebase Init."):console.log("`useFirebase` is false. Skipping Firebase Init.")}catch(o){console.error("Error initializing Firebase:",o)}const $e={backgroundType:"color",backgroundColor:"#FFFFFF",showBorder:!0,elements:[{id:"e1",type:"text",label:"Institution",content:"EDU EVENT SCHEDULER",x:148.5,y:30,fontSize:24,fontColor:"#1F2937",fontFamily:"helvetica",fontWeight:"bold",align:"center"},{id:"e2",type:"text",label:"Title",content:"CERTIFICADO",x:148.5,y:60,fontSize:40,fontColor:"#4F46E5",fontFamily:"helvetica",fontWeight:"bold",align:"center"},{id:"e3",type:"text",label:"Subtitle",content:"Certificamos que",x:148.5,y:80,fontSize:16,fontColor:"#6B7280",fontFamily:"helvetica",fontWeight:"normal",align:"center"},{id:"e4",type:"variable",label:"Student Name",content:"{student_name}",x:148.5,y:100,fontSize:28,fontColor:"#111827",fontFamily:"helvetica",fontWeight:"bold",align:"center"},{id:"e5",type:"text",label:"Context",content:"participou do evento",x:148.5,y:115,fontSize:16,fontColor:"#6B7280",fontFamily:"helvetica",fontWeight:"normal",align:"center"},{id:"e6",type:"variable",label:"Event Name",content:"{event_name}",x:148.5,y:130,fontSize:22,fontColor:"#4F46E5",fontFamily:"helvetica",fontWeight:"bold",align:"center"},{id:"e7",type:"text",label:"Date",content:"Realizado em {date}. Carga horÃ¡ria: {hours}h.",x:148.5,y:145,fontSize:14,fontColor:"#374151",fontFamily:"helvetica",fontWeight:"normal",align:"center"},{id:"e8",type:"text",label:"Signer 1",content:`______________________
Diretor AcadÃªmico`,x:74,y:170,fontSize:12,fontColor:"#000000",fontFamily:"helvetica",fontWeight:"normal",align:"center"},{id:"e9",type:"text",label:"Signer 2",content:`______________________
Coordenador de Eventos`,x:222,y:170,fontSize:12,fontColor:"#000000",fontFamily:"helvetica",fontWeight:"normal",align:"center"},{id:"e10",type:"text",label:"Footer",content:"CÃ³digo de validaÃ§Ã£o: {enrollment_id}",x:148.5,y:190,fontSize:10,fontColor:"#9CA3AF",fontFamily:"courier",fontWeight:"normal",align:"center"}]},Ue={preRegistrationEnabled:!1};class Jt{mapAuthError(t){switch(t){case"auth/invalid-credential":case"auth/user-not-found":case"auth/wrong-password":return"E-mail ou senha incorretos.";case"auth/email-already-in-use":return"Este e-mail jÃ¡ estÃ¡ em uso.";case"auth/weak-password":return"A senha Ã© muito fraca.";case"auth/invalid-email":return"E-mail invÃ¡lido.";case"auth/popup-closed-by-user":return"Login cancelado.";default:return"Erro na autenticaÃ§Ã£o. Tente novamente."}}async login(t,s){if(!Q)throw new Error("ServiÃ§o de autenticaÃ§Ã£o nÃ£o inicializado.");if(!s)throw new Error("A senha Ã© obrigatÃ³ria.");try{await et(Q,tt);const r=await Ut(Q,t,s);return this._fetchUserProfile(r.user)}catch(r){throw console.error("Erro no Login Firebase:",r),new Error(this.mapAuthError(r.code))}}async loginWithGoogle(){if(!Q)throw new Error("ServiÃ§o de autenticaÃ§Ã£o nÃ£o inicializado.");try{await et(Q,tt);const t=new zt;await Bt(Q,t)}catch(t){throw console.error("Erro ao iniciar Login com Google:",t),new Error(this.mapAuthError(t.code))}}async _fetchUserProfile(t){if(!h)throw new Error("Banco de dados nÃ£o inicializado.");const s=F(h,"users",t.uid);let r;try{r=await ae(s)}catch(a){if(console.error("Erro ao acessar Firestore:",a),a.code==="permission-denied")return{uid:t.uid,email:t.email||"",role:B.USER,isOnboarded:!1,blocked:!1};throw new Error("Erro de conexÃ£o ao buscar perfil do usuÃ¡rio.")}if(r.exists()){const a=r.data();return{uid:t.uid,email:t.email||"",name:a.name||t.displayName,role:a.role||B.USER,rm:a.rm,courseId:a.courseId,classId:a.classId,isOnboarded:a.isOnboarded||!1,blocked:a.blocked||!1}}else return{uid:t.uid,email:t.email||"",name:t.displayName||"",role:B.USER,isOnboarded:!1,blocked:!1}}async logout(){Q&&await qt(Q)}onAuthStateChanged(t){return Q?Vt(Q,async s=>{if(s)try{const r=await this._fetchUserProfile(s);t(r)}catch{t({uid:s.uid,email:s.email||"",role:B.USER,isOnboarded:!1,blocked:!1})}else t(null)}):(console.warn("Firebase Auth not initialized correctly. Defaulting to logged out state."),t(null),()=>{})}async updateUserProfile(t,s){if(!h)throw new Error("Banco de dados nÃ£o inicializado.");if(s.rm&&!s.blocked)try{const n=z(h,"users"),i=q(n,U("rm","==",s.rm));if((await V(i)).docs.find(c=>c.id!==t))throw new Error("Este RM jÃ¡ estÃ¡ cadastrado para outro usuÃ¡rio.")}catch(n){if(n.code!=="permission-denied")throw n}const r=F(h,"users",t),a={...s,updatedAt:new Date().toISOString()};s.name&&s.rm&&!s.blocked&&(a.isOnboarded=!0);try{await Me(r,a,{merge:!0})}catch{throw new Error("NÃ£o foi possÃ­vel salvar seus dados.")}return{...s,uid:t,email:"",role:B.USER,isOnboarded:!0,blocked:!1}}async getUserProfile(t){if(!h)throw new Error("ServiÃ§o nÃ£o inicializado.");try{const s=F(h,"users",t),r=await ae(s);if(r.exists()){const a=r.data();return{uid:t,email:a.email||"",name:a.name||"UsuÃ¡rio",role:a.role||B.USER,rm:a.rm,courseId:a.courseId,classId:a.classId,isOnboarded:a.isOnboarded,blocked:a.blocked}}}catch{console.warn(`Could not fetch profile for ${t} from DB.`)}return Q&&Q.currentUser&&Q.currentUser.uid===t?this._fetchUserProfile(Q.currentUser):null}async getUsers(t){if(!h)return{data:[],nextCursor:void 0};const{limit:s,cursor:r,filters:a}=t,{searchTerm:n,role:i,courseId:d,classId:l}=a;try{const c=[ie("email"),he(s)];i&&c.push(U("role","==",i)),d&&c.push(U("courseId","==",d)),l&&c.push(U("classId","==",l)),r&&c.push(ot(r));const m=q(z(h,"users"),...c),g=await V(m);let f=g.docs.map(y=>({uid:y.id,...y.data()}));if(n){const y=n.toLowerCase();f=f.filter(p=>{var E,I;return((E=p.name)==null?void 0:E.toLowerCase().includes(y))||p.email.toLowerCase().includes(y)||((I=p.rm)==null?void 0:I.includes(y))})}const x=g.docs.length===s?g.docs[g.docs.length-1]:void 0;return{data:f,nextCursor:x}}catch(c){return console.error("Erro ao buscar usuÃ¡rios:",c),c.code==="failed-precondition"&&console.warn("Falta Ã­ndice composto. Crie no link do console."),{data:[],nextCursor:void 0}}}async deleteUser(t){if(!h)return;const s=we(h),r=q(z(h,"enrollments"),U("userId","==",t)),n=(await V(r)).docs.map(f=>({id:f.id,...f.data()})),i=Array.from(new Set(n.map(f=>f.eventId))),l=await(async f=>{const x=[];for(let y=0;y<f.length;y+=30){const p=f.slice(y,y+30),E=q(z(h,"events"),U(lt(),"in",p)),I=await V(E);x.push(...I.docs.map(v=>({id:v.id,...v.data()})))}return x})(i),c=new Map(l.map(f=>[f.id,f]));n.forEach(f=>{if(f.status===Y.CONFIRMED){const x=c.get(f.eventId);if(x){const y=x.sessions.findIndex(p=>p.id===f.sessionId);if(y!==-1&&x.sessions[y].filled>0){const p=[...x.sessions];p[y]={...p[y],filled:Math.max(0,p[y].filled-1)},x.sessions=p,s.update(F(h,"events",x.id),{sessions:p})}}}s.delete(F(h,"enrollments",f.id))});const m=q(z(h,"teams"),U("members","array-contains",t));(await V(m)).forEach(f=>{f.data().captainId===t?s.delete(f.ref):s.update(f.ref,{members:ze(t)})}),s.delete(F(h,"users",t)),await s.commit()}async updateUserRole(t,s){h&&await je(F(h,"users",t),{role:s})}}class Qt{constructor(){this.coursesCache=null,this.classesCache=null}async getCourses(){if(!h)return[];if(this.coursesCache)return this.coursesCache;const t=await V(z(h,"courses"));return this.coursesCache=t.docs.map(s=>({id:s.id,...s.data()})),this.coursesCache}async addCourse(t){if(!h)throw new Error("DB not init");const s=await Be(z(h,"courses"),{name:t});return this.coursesCache=null,{id:s.id,name:t}}async updateCourse(t,s){h&&(await je(F(h,"courses",t),{name:s}),this.coursesCache=null)}async deleteCourse(t){if(!h)return;const s=we(h);s.delete(F(h,"courses",t));const r=q(z(h,"classes"),U("courseId","==",t));(await V(r)).forEach(d=>s.delete(d.ref));const n=q(z(h,"users"),U("courseId","==",t));(await V(n)).forEach(d=>s.update(d.ref,{courseId:""})),await s.commit(),this.coursesCache=null,this.classesCache=null}async getClasses(t){if(!h)return[];if(!this.classesCache){const s=await V(z(h,"classes"));this.classesCache=s.docs.map(r=>({id:r.id,...r.data()}))}return t?this.classesCache.filter(s=>s.courseId===t):this.classesCache}async addClass(t,s){if(!h)throw new Error("DB not init");const r=await Be(z(h,"classes"),{courseId:t,name:s});return this.classesCache=null,{id:r.id,courseId:t,name:s}}async updateClass(t,s){h&&(await je(F(h,"classes",t),{name:s}),this.classesCache=null)}async deleteClass(t){if(!h)return;const s=we(h);await dt(F(h,"classes",t));const r=q(z(h,"users"),U("classId","==",t));(await V(r)).forEach(n=>s.update(n.ref,{classId:""})),await s.commit(),this.classesCache=null}async getEvents(t){if(!h)return{data:[],nextCursor:void 0};const{limit:s,cursor:r,filters:a}=t,{searchTerm:n,visibility:i,course:d}=a,l=50;try{const c=q(z(h,"events"),ie("createdAt","desc"),he(l)),g=(await V(c)).docs.map(I=>({id:I.id,...I.data()}));let f=[];i==="class"&&d&&(f=await this.getClasses());const x=g.filter(I=>{var N,S;const v=n?I.name.toLowerCase().includes(n.toLowerCase())||I.description.toLowerCase().includes(n.toLowerCase()):!0,w=i?I.visibility===i:!0;let k=!0;return d&&(I.visibility==="public"?k=!1:I.visibility==="course"?k=((N=I.allowedCourses)==null?void 0:N.includes(d))||!1:I.visibility==="class"&&(f.length>0?k=((S=I.allowedClasses)==null?void 0:S.some(A=>{const C=f.find(R=>R.id===A);return(C==null?void 0:C.courseId)===d}))||!1:k=!1)),v&&w&&k}),y=typeof r=="number"?r:0,p=x.slice(y,y+s),E=y+p.length<x.length?y+p.length:void 0;return{data:p,nextCursor:E}}catch{return{data:[],nextCursor:void 0}}}async getEventById(t){if(!h)return;const s=F(h,"events",t),r=await ae(s);return r.exists()?{id:r.id,...r.data()}:void 0}async getEventsByIds(t){if(!h||t.length===0)return[];const s=30,r=[];for(let a=0;a<t.length;a+=s){const n=t.slice(a,a+s),i=q(z(h,"events"),U(lt(),"in",n)),d=await V(i);r.push(...d.docs.map(l=>({id:l.id,...l.data()})))}return r}async getEventsByParentId(t){if(!h)return[];const s=q(z(h,"events"),U("parentId","==",t));return(await V(s)).docs.map(a=>({id:a.id,...a.data()}))}async getAvailableEventsForUser(t){if(!h)return[];try{const s=z(h,"events"),r=he(50),n=[q(s,U("visibility","==","public"),ie("createdAt","desc"),r)];if(t.courseId){const l=q(s,U("allowedCourses","array-contains",t.courseId),ie("createdAt","desc"),r);n.push(l)}if(t.classId){const l=q(s,U("allowedClasses","array-contains",t.classId),ie("createdAt","desc"),r);n.push(l)}const i=await Promise.all(n.map(l=>V(l).catch(c=>(console.warn("Query falhou (verifique Ã­ndices):",c.message),{docs:[]})))),d=new Map;return i.forEach(l=>{l.docs.forEach(c=>{d.has(c.id)||d.set(c.id,{id:c.id,...c.data()})})}),Array.from(d.values()).sort((l,c)=>(c.createdAt||"").localeCompare(l.createdAt||""))}catch(s){return console.error("Erro crÃ­tico ao buscar eventos:",s),[]}}async getPublicEvents(){if(!h)return[];const t=q(z(h,"events"),U("visibility","==","public"),ie("createdAt","desc"),he(10));return(await V(t)).docs.map(r=>({id:r.id,...r.data()}))}async createEvent(t){if(!h)return;const{id:s,...r}=t;await Me(F(h,"events",s),JSON.parse(JSON.stringify(r)))}async updateEvent(t){if(!h)return;const{id:s,...r}=t;await je(F(h,"events",s),JSON.parse(JSON.stringify(r)))}async deleteEvent(t){if(!h)return;const s=we(h),r=[t],a=q(z(h,"events"),U("parentId","==",t));(await V(a)).forEach(l=>r.push(l.id));const i=[],d=[];for(let l=0;l<r.length;l+=10)d.push(r.slice(l,l+10));for(const l of d){const c=q(z(h,"enrollments"),U("eventId","in",l));(await V(c)).forEach(x=>i.push(x.ref));const g=q(z(h,"teams"),U("eventId","in",l));(await V(g)).forEach(x=>s.delete(x.ref))}r.forEach(l=>s.delete(F(h,"events",l))),i.forEach(l=>s.delete(l)),await s.commit()}}class Yt{constructor(t,s){this.notificationService=t,this.eventService=s}async getTeamsForEvent(t){if(!h)return[];const s=q(z(h,"teams"),U("eventId","==",t));return(await V(s)).docs.map(a=>({id:a.id,...a.data()}))}async createTeam(t,s,r){if(!h)throw new Error("DB not init");const a=Math.random().toString(36).substring(2,6).toUpperCase(),n=`Equipe #${Math.floor(Math.random()*1e3)}`,i=`team_${Date.now()}`,d={id:i,eventId:t,sessionId:s,name:n,code:a,captainId:r.uid,members:[r.uid],createdAt:new Date().toISOString()};return await ve(h,async l=>{const c=F(h,"events",t),m=await l.get(c);if(!m.exists())throw new Error("Evento nÃ£o encontrado.");const g=m.data();if(g.registrationLocked)throw new Error("As inscriÃ§Ãµes para este evento estÃ£o temporariamente bloqueadas.");const f=`${r.uid}_${t}`,x=F(h,"enrollments",f),y=await l.get(x);if(y.exists()&&y.data().status===Y.CONFIRMED)throw new Error("VocÃª jÃ¡ estÃ¡ inscrito neste evento.");const p=g.sessions.findIndex(v=>v.id===s);if(p===-1)throw new Error("SessÃ£o invÃ¡lida.");if(g.sessions[p].filled>=g.sessions[p].capacity)throw new Error("A sessÃ£o estÃ¡ lotada (limite de equipes atingido).");const E=[...g.sessions];E[p]={...E[p],filled:E[p].filled+1},l.update(c,{sessions:E}),l.set(x,{userId:r.uid,eventId:t,sessionId:s,teamId:i,status:Y.CONFIRMED,enrolledAt:new Date().toISOString(),attended:!1,userName:r.name,userEmail:r.email,userRm:r.rm,userCourseId:r.courseId,userClassId:r.classId});const I=F(h,"teams",i);l.set(I,d)}),d}async joinTeam(t,s,r){if(!h)throw new Error("DB not init");const a=F(h,"teams",t);await ve(h,async n=>{const i=await n.get(a);if(!i.exists())throw new Error("Equipe nÃ£o encontrada.");const d=i.data();if(d.code!==r)throw new Error("CÃ³digo da equipe invÃ¡lido.");if(d.members.includes(s.uid))throw new Error("VocÃª jÃ¡ faz parte desta equipe.");const l=F(h,"events",d.eventId),c=await n.get(l);if(c.exists()&&c.data().registrationLocked)throw new Error("As inscriÃ§Ãµes para este evento estÃ£o temporariamente bloqueadas.");const m=`${s.uid}_${d.eventId}`,g=F(h,"enrollments",m),f=await n.get(g);if(f.exists()&&f.data().status===Y.CONFIRMED)throw new Error("VocÃª jÃ¡ estÃ¡ inscrito neste evento.");n.set(g,{userId:s.uid,eventId:d.eventId,sessionId:d.sessionId,teamId:t,status:Y.CONFIRMED,enrolledAt:new Date().toISOString(),attended:!1,userName:s.name,userEmail:s.email,userRm:s.rm,userCourseId:s.courseId,userClassId:s.classId}),n.update(a,{members:ct(s.uid)})});try{const n=await ae(a);if(n.exists()){const i=n.data();i.captainId!==s.uid&&await this.notificationService.createNotification({userId:i.captainId,title:"Novo membro na equipe! ðŸ›¡ï¸",message:`${s.name||"Um usuÃ¡rio"} entrou na sua equipe ${i.name}.`,type:"success",createdAt:new Date().toISOString(),read:!1,link:`/event/${i.eventId}`})}}catch(n){console.error("Error creating notification",n)}}async leaveTeam(t,s){if(!h||!Q||!Q.currentUser)return;const r=Q.currentUser.uid,a=F(h,"teams",t);let n=null,i=null,d=!1,l=!1;try{const c=await ae(F(h,"users",s));c.exists()&&(i=c.data())}catch{}if(await ve(h,async c=>{const m=await c.get(a);if(!m.exists())throw new Error("Equipe nÃ£o encontrada.");n=m.data();const g=F(h,"events",n.eventId),f=await c.get(g);if(n.captainId===s){d=!0;for(const x of n.members){const y=`${x}_${n.eventId}`,p=F(h,"enrollments",y);c.delete(p)}if(f.exists()){const x=f.data(),y=x.sessions.findIndex(p=>p.id===n.sessionId);if(y!==-1){const p=[...x.sessions];p[y].filled=Math.max(0,p[y].filled-1),c.update(g,{sessions:p})}}c.delete(a)}else{r!==s&&(l=!0),c.update(a,{members:ze(s)});const x=`${s}_${n.eventId}`,y=F(h,"enrollments",x);c.delete(y)}}),n){const c=n.name,m=(i==null?void 0:i.name)||"Um membro";if(d){const g=n.members.filter(f=>f!==(n==null?void 0:n.captainId));for(const f of g)await this.notificationService.createNotification({userId:f,title:"Equipe Desfeita âš ï¸",message:`A equipe "${c}" foi desfeita pelo capitÃ£o. Sua inscriÃ§Ã£o foi cancelada.`,type:"warning",read:!1,createdAt:new Date().toISOString(),link:"/dashboard"})}else l?await this.notificationService.createNotification({userId:s,title:"Removido da Equipe ðŸš«",message:`VocÃª foi removido da equipe "${c}" pelo capitÃ£o.`,type:"warning",read:!1,createdAt:new Date().toISOString(),link:"/dashboard"}):n.captainId!==s&&await this.notificationService.createNotification({userId:n.captainId,title:"Membro Saiu ðŸƒ",message:`${m} saiu da sua equipe "${c}".`,type:"info",read:!1,createdAt:new Date().toISOString(),link:`/event/${n.eventId}`})}}async kickMember(t,s){return this.leaveTeam(t,s)}async getEnrollmentsForUser(t){if(!h)return[];try{const s=q(z(h,"enrollments"),U("userId","==",t));return(await V(s)).docs.map(n=>({id:n.id,...n.data()})).filter(n=>n.status!==Y.CANCELED)}catch(s){return console.error("Error fetching enrollments",s),[]}}async getUserEnrollmentsDetails(t){if(!h)return[];try{const s=q(z(h,"enrollments"),U("userId","==",t),U("status","==",Y.CONFIRMED)),a=(await V(s)).docs.map(l=>({id:l.id,...l.data()}));if(a.length===0)return[];const n=Array.from(new Set(a.map(l=>l.eventId))),i=await this.eventService.getEventsByIds(n),d=new Map(i.map(l=>[l.id,l]));return a.map(l=>{const c=d.get(l.eventId);if(!c)return null;const m=c.sessions.find(g=>g.id===l.sessionId);return m?{enrollmentId:l.id,eventName:c.name,eventLocation:c.location,sessionDate:m.date,sessionTime:`${m.startTime} - ${m.endTime}`,enrolledAt:l.enrolledAt}:null}).filter(Boolean)}catch{return[]}}async getEnrichedEnrollments(t){if(!h)return[];const s=q(z(h,"enrollments"),U("eventId","==",t),U("status","==",Y.CONFIRMED)),a=(await V(s)).docs.map(l=>({id:l.id,...l.data()}));if(a.length===0)return[];const n=a.filter(l=>!l.userName).map(l=>l.userId),i=new Map;if(n.length>0){const l=n.map(m=>ae(F(h,"users",m)));(await Promise.all(l)).forEach(m=>{m.exists()&&i.set(m.id,{uid:m.id,...m.data()})})}const d=await this.eventService.getEventById(t);return d?a.map(l=>{let c={uid:l.userId,name:l.userName,email:l.userEmail||"",rm:l.userRm||"",courseId:l.userCourseId,classId:l.userClassId};if(!c.name){const g=i.get(l.userId);g?c=g:c.name="Desconhecido"}const m=d.sessions.find(g=>g.id===l.sessionId);return{id:l.id,user:c,session:{id:m.id,date:m.date,startTime:m.startTime,endTime:m.endTime},status:l.status,enrolledAt:l.enrolledAt,teamId:l.teamId,attended:l.attended,checkInAt:l.checkInAt}}):[]}async getEnrollmentDetailsForEvent(t){return(await this.getEnrichedEnrollments(t)).map(r=>({Nome:r.user.name,Email:r.user.email,RM:r.user.rm,SessaoData:Z(r.session.date),SessaoHora:`${r.session.startTime}`,Status:r.status,DataInscricao:new Date(r.enrolledAt).toLocaleString("pt-BR"),Presenca:r.attended?"Sim":"NÃ£o"}))}async createEnrollment(t,s,r,a=!1){if(!h)throw new Error("DB not init");const n=await ae(F(h,"events",s));if(!n.exists())throw new Error("Evento nÃ£o encontrado");const i=n.data();if(i.registrationLocked)throw new Error("As inscriÃ§Ãµes para este evento estÃ£o temporariamente bloqueadas.");const d=i.sessions.find(x=>x.id===r);if(!d)throw new Error("SessÃ£o nÃ£o encontrada");const l=q(z(h,"enrollments"),U("userId","==",t),U("status","==",Y.CONFIRMED)),m=(await V(l)).docs.map(x=>x.data());if(m.some(x=>x.eventId===s))throw new Error("VocÃª jÃ¡ estÃ¡ inscrito neste evento");if(m.length>0){const x=[...new Set(m.map(p=>p.eventId))],y=await this.eventService.getEventsByIds(x);for(const p of m){const E=y.find(v=>v.id===p.eventId),I=E==null?void 0:E.sessions.find(v=>v.id===p.sessionId);if(E&&I&&I.date===d.date&&d.startTime<I.endTime&&d.endTime>I.startTime)throw new Error(`CONFLICT|${E.name}|${I.startTime}|${I.endTime}`)}}const g=`enr_${Date.now()}_${t}`;let f;return await ve(h,async x=>{const y=F(h,"events",s),p=await x.get(y);if(!p.exists())throw new Error("Evento nÃ£o encontrado");const E=F(h,"users",t),I=await x.get(E);let v=null;I.exists()&&(v={uid:I.id,...I.data()});const w=p.data();if(w.registrationLocked)throw new Error("As inscriÃ§Ãµes para este evento estÃ£o bloqueadas.");const k=w.sessions.findIndex(S=>S.id===r);if(k===-1)throw new Error("SessÃ£o nÃ£o encontrada");if(!a){if(w.sessions[k].filled>=w.sessions[k].capacity)throw new Error("A sessÃ£o estÃ¡ lotada");const S=[...w.sessions];S[k].filled+=1,x.update(y,{sessions:S})}f={id:g,userId:t,eventId:s,sessionId:r,status:Y.CONFIRMED,enrolledAt:new Date().toISOString(),attended:!1,userName:(v==null?void 0:v.name)||"Desconhecido",userEmail:(v==null?void 0:v.email)||"",userRm:(v==null?void 0:v.rm)||"",userCourseId:v==null?void 0:v.courseId,userClassId:v==null?void 0:v.classId};const N=F(h,"enrollments",g);x.set(N,f)}),f}async cancelEnrollment(t){if(!h||!Q||!Q.currentUser)return;const s=Q.currentUser.uid;let r=null,a="um evento";await ve(h,async n=>{const i=F(h,"enrollments",t),d=await n.get(i);if(!d.exists())throw new Error("InscriÃ§Ã£o nÃ£o encontrada");r=d.data();const l=F(h,"events",r.eventId),c=await n.get(l);let m=null,g=null;r.teamId&&(m=F(h,"teams",r.teamId),g=await n.get(m));let f=!0;if(r.teamId&&g&&g.exists()&&(g.data().captainId===r.userId?(n.delete(m),f=!0):(n.update(m,{members:ze(r.userId)}),f=!1)),c.exists()){const x=c.data();if(a=x.name,f){const y=x.sessions.findIndex(p=>p.id===r.sessionId);if(y!==-1){const p=[...x.sessions];p[y].filled=Math.max(0,p[y].filled-1),n.update(l,{sessions:p})}}}n.delete(i)}),r&&r.userId!==s&&await this.notificationService.createNotification({userId:r.userId,title:"InscriÃ§Ã£o Cancelada âš ï¸",message:`Sua inscriÃ§Ã£o no evento "${a}" foi cancelada pela administraÃ§Ã£o.`,type:"warning",read:!1,createdAt:new Date().toISOString(),link:"/dashboard"})}async markAttendance(t){if(!h)throw new Error("DB not init");return await ve(h,async s=>{const r=F(h,"enrollments",t),a=await s.get(r);if(!a.exists())return{success:!1,message:"InscriÃ§Ã£o nÃ£o encontrada."};const n=a.data();let i=n.userName;if(!i){const c=await s.get(F(h,"users",n.userId));i=c.exists()?c.data().name:"Desconhecido"}const d=await s.get(F(h,"events",n.eventId)),l=d.exists()?d.data().name:"Evento";return n.attended?{success:!1,message:"Check-in jÃ¡ realizado anteriormente.",alreadyAttended:!0,userName:i,eventName:l}:(s.update(r,{attended:!0,checkInAt:new Date().toISOString()}),{success:!0,message:"Check-in realizado com sucesso!",userName:i,eventName:l})})}}class Kt{async getNotifications(t){if(!h)return[];const s=q(z(h,"notifications"),U("userId","==",t),ie("createdAt","desc"),he(20));return(await V(s)).docs.map(a=>({id:a.id,...a.data()}))}subscribeToNotifications(t,s){if(!h)return()=>{};const r=q(z(h,"notifications"),U("userId","==",t),ie("createdAt","desc"),he(20));return Wt(r,n=>{const i=n.docs.map(d=>({id:d.id,...d.data()}));s(i)})}async markNotificationAsRead(t){h&&await je(F(h,"notifications",t),{read:!0})}async markAllNotificationsAsRead(t){if(!h)return;const s=q(z(h,"notifications"),U("userId","==",t),U("read","==",!1)),r=await V(s),a=we(h);r.forEach(n=>a.update(n.ref,{read:!0})),await a.commit()}async createNotification(t){h&&await Be(z(h,"notifications"),t)}async saveDeviceToken(t,s){if(!h)return;const r=F(h,"users",t);await je(r,{pushTokens:ct(s)})}}class Xt{async getCertificateConfig(){if(!h)return $e;try{const t=F(h,"config","certificate"),s=await ae(t);if(s.exists())return{...$e,...s.data()}}catch(t){console.warn("Erro ao buscar config certificado",t)}return $e}async updateCertificateConfig(t){h&&await Me(F(h,"config","certificate"),t,{merge:!0})}async getSystemConfig(){if(!h)return Ue;try{const t=F(h,"config","system"),s=await ae(t);if(s.exists())return{...Ue,...s.data()}}catch(t){console.warn("Erro ao buscar config sistema",t)}return Ue}async updateSystemConfig(t){h&&await Me(F(h,"config","system"),t,{merge:!0})}}class Zt{async addPreStudents(t){if(!h)return;const s=we(h);t.forEach(r=>{const a=F(h,"preStudents",r.rm);s.set(a,r)}),await s.commit()}async getPreStudentByRM(t){if(!h)return null;try{const s=F(h,"preStudents",t),r=await ae(s);return r.exists()?r.data():null}catch(s){return console.error("Error fetching pre-student",s),null}}async getPreStudents(t){if(!h)return{data:[],nextCursor:void 0};const{limit:s,cursor:r,filters:a}=t,n=a.classId;try{const i=[ie("name"),he(s)];n&&i.push(U("classId","==",n)),r&&i.push(ot(r));const d=q(z(h,"preStudents"),...i),l=await V(d),c=l.docs.map(g=>g.data()),m=l.docs.length===s?l.docs[l.docs.length-1]:void 0;return{data:c,nextCursor:m}}catch(i){return console.error("Error listing pre-students",i),{data:[],nextCursor:void 0}}}async deletePreStudent(t){h&&await dt(F(h,"preStudents",t))}}class es{async resetAndSeedData(){console.log("Reset not supported in Firebase from client.")}async exportData(){return"{}"}async importData(t){}}class ts{constructor(){this.authService=new Jt,this.eventService=new Qt,this.notificationService=new Kt,this.enrollmentService=new Yt(this.notificationService,this.eventService),this.devService=new es,this.configService=new Xt,this.preRegistrationService=new Zt}login(t,s){return this.authService.login(t,s)}loginWithGoogle(){return this.authService.loginWithGoogle()}logout(){return this.authService.logout()}onAuthStateChanged(t){return this.authService.onAuthStateChanged(t)}updateUserProfile(t,s){return this.authService.updateUserProfile(t,s)}getUserProfile(t){return this.authService.getUserProfile(t)}getUsers(t){return this.authService.getUsers(t)}deleteUser(t){return this.authService.deleteUser(t)}updateUserRole(t,s){return this.authService.updateUserRole(t,s)}getCourses(){return this.eventService.getCourses()}addCourse(t){return this.eventService.addCourse(t)}updateCourse(t,s){return this.eventService.updateCourse(t,s)}deleteCourse(t){return this.eventService.deleteCourse(t)}getClasses(t){return this.eventService.getClasses(t)}addClass(t,s){return this.eventService.addClass(t,s)}updateClass(t,s){return this.eventService.updateClass(t,s)}deleteClass(t){return this.eventService.deleteClass(t)}getEvents(t){return this.eventService.getEvents(t)}getEventById(t){return this.eventService.getEventById(t)}getEventsByIds(t){return this.eventService.getEventsByIds(t)}getAvailableEventsForUser(t){return this.eventService.getAvailableEventsForUser(t)}getPublicEvents(){return this.eventService.getPublicEvents()}getEventsByParentId(t){return this.eventService.getEventsByParentId(t)}createEvent(t){return this.eventService.createEvent(t)}updateEvent(t){return this.eventService.updateEvent(t)}deleteEvent(t){return this.eventService.deleteEvent(t)}getTeamsForEvent(t){return this.enrollmentService.getTeamsForEvent(t)}createTeam(t,s,r){return this.enrollmentService.createTeam(t,s,r)}joinTeam(t,s,r){return this.enrollmentService.joinTeam(t,s,r)}leaveTeam(t,s){return this.enrollmentService.leaveTeam(t,s)}kickMember(t,s){return this.enrollmentService.kickMember(t,s)}getEnrollmentsForUser(t){return this.enrollmentService.getEnrollmentsForUser(t)}getUserEnrollmentsDetails(t){return this.enrollmentService.getUserEnrollmentsDetails(t)}getEnrichedEnrollments(t){return this.enrollmentService.getEnrichedEnrollments(t)}getEnrollmentDetailsForEvent(t){return this.enrollmentService.getEnrollmentDetailsForEvent(t)}createEnrollment(t,s,r,a){return this.enrollmentService.createEnrollment(t,s,r,a)}cancelEnrollment(t){return this.enrollmentService.cancelEnrollment(t)}markAttendance(t){return this.enrollmentService.markAttendance(t)}getNotifications(t){return this.notificationService.getNotifications(t)}subscribeToNotifications(t,s){return this.notificationService.subscribeToNotifications(t,s)}markNotificationAsRead(t){return this.notificationService.markNotificationAsRead(t)}markAllNotificationsAsRead(t){return this.notificationService.markAllNotificationsAsRead(t)}createNotification(t){return this.notificationService.createNotification(t)}saveDeviceToken(t,s){return this.notificationService.saveDeviceToken(t,s)}getCertificateConfig(){return this.configService.getCertificateConfig()}updateCertificateConfig(t){return this.configService.updateCertificateConfig(t)}getSystemConfig(){return this.configService.getSystemConfig()}updateSystemConfig(t){return this.configService.updateSystemConfig(t)}addPreStudents(t){return this.preRegistrationService.addPreStudents(t)}getPreStudentByRM(t){return this.preRegistrationService.getPreStudentByRM(t)}getPreStudents(t){return this.preRegistrationService.getPreStudents(t)}deletePreStudent(t){return this.preRegistrationService.deletePreStudent(t)}resetAndSeedData(){return this.devService.resetAndSeedData()}exportData(){return this.devService.exportData()}importData(t){return this.devService.importData(t)}}const ss=[{id:"c1",name:"CiÃªncia da ComputaÃ§Ã£o"},{id:"c2",name:"Design Digital"},{id:"c3",name:"AdministraÃ§Ã£o"}],rs=[{id:"t1",courseId:"c1",name:"CC-2024-A"},{id:"t2",courseId:"c1",name:"CC-2024-B"},{id:"t3",courseId:"c2",name:"DD-2024-A"},{id:"t4",courseId:"c3",name:"ADM-2024-A"}],as={backgroundType:"color",backgroundColor:"#FFFFFF",showBorder:!0,elements:[{id:"e1",type:"text",label:"Institution",content:"EDU EVENT SCHEDULER",x:148.5,y:30,fontSize:24,fontColor:"#1F2937",fontFamily:"helvetica",fontWeight:"bold",align:"center"},{id:"e2",type:"text",label:"Title",content:"CERTIFICADO",x:148.5,y:60,fontSize:40,fontColor:"#4F46E5",fontFamily:"helvetica",fontWeight:"bold",align:"center"},{id:"e3",type:"text",label:"Subtitle",content:"Certificamos que",x:148.5,y:80,fontSize:16,fontColor:"#6B7280",fontFamily:"helvetica",fontWeight:"normal",align:"center"},{id:"e4",type:"variable",label:"Student Name",content:"{student_name}",x:148.5,y:100,fontSize:28,fontColor:"#111827",fontFamily:"helvetica",fontWeight:"bold",align:"center"},{id:"e5",type:"text",label:"Context",content:"participou do evento",x:148.5,y:115,fontSize:16,fontColor:"#6B7280",fontFamily:"helvetica",fontWeight:"normal",align:"center"},{id:"e6",type:"variable",label:"Event Name",content:"{event_name}",x:148.5,y:130,fontSize:22,fontColor:"#4F46E5",fontFamily:"helvetica",fontWeight:"bold",align:"center"},{id:"e7",type:"text",label:"Date",content:"Realizado em {date}. Carga horÃ¡ria: {hours}h.",x:148.5,y:145,fontSize:14,fontColor:"#374151",fontFamily:"helvetica",fontWeight:"normal",align:"center"},{id:"e8",type:"text",label:"Signer 1",content:`______________________
Diretor AcadÃªmico`,x:74,y:170,fontSize:12,fontColor:"#000000",fontFamily:"helvetica",fontWeight:"normal",align:"center"},{id:"e9",type:"text",label:"Signer 2",content:`______________________
Coordenador de Eventos`,x:222,y:170,fontSize:12,fontColor:"#000000",fontFamily:"helvetica",fontWeight:"normal",align:"center"},{id:"e10",type:"text",label:"Footer",content:"CÃ³digo de validaÃ§Ã£o: {enrollment_id}",x:148.5,y:190,fontSize:10,fontColor:"#9CA3AF",fontFamily:"courier",fontWeight:"normal",align:"center"}]},ns={preRegistrationEnabled:!1},u={USERS:"eduevent_users",EVENTS:"eduevent_events",ENROLLMENTS:"eduevent_enrollments",TEAMS:"eduevent_teams",NOTIFICATIONS:"eduevent_notifications",CURRENT_USER:"eduevent_current_user",COURSES:"eduevent_courses",CLASSES:"eduevent_classes",CERT_CONFIG:"eduevent_cert_config_v2",SYSTEM_CONFIG:"eduevent_system_config",PRE_STUDENTS:"eduevent_pre_students"},W=o=>new Promise(t=>setTimeout(t,o));class pe{getItems(t){const s=localStorage.getItem(t);return s?JSON.parse(s):[]}saveItems(t,s){localStorage.setItem(t,JSON.stringify(s))}addItem(t,s){const r=this.getItems(t);r.push(s),this.saveItems(t,r)}}class qe extends pe{constructor(){super(...arguments),this.authListeners=[]}notifyAuthListeners(t){this.authListeners.forEach(s=>s(t))}async login(t,s){await W(500);let a=this.getItems(u.USERS).find(n=>n.email===t);return a||(a={uid:`user_${Date.now()}`,email:t,role:t.includes("admin")?B.ADMIN:B.USER,isOnboarded:!1,blocked:!1},this.addItem(u.USERS,a)),localStorage.setItem(u.CURRENT_USER,JSON.stringify(a)),this.notifyAuthListeners(a),a}async loginWithGoogle(){await W(800);const t="google.mock@example.com";let r=this.getItems(u.USERS).find(a=>a.email===t);r||(r={uid:`user_google_${Date.now()}`,email:t,name:"Google Mock User",role:B.USER,isOnboarded:!1,blocked:!1},this.addItem(u.USERS,r)),localStorage.setItem(u.CURRENT_USER,JSON.stringify(r)),this.notifyAuthListeners(r)}async logout(){localStorage.removeItem(u.CURRENT_USER),this.notifyAuthListeners(null)}onAuthStateChanged(t){this.authListeners.push(t);const s=localStorage.getItem(u.CURRENT_USER),r=s?JSON.parse(s):null;return t(r),()=>{this.authListeners=this.authListeners.filter(a=>a!==t)}}async updateUserProfile(t,s){await W(600);const r=this.getItems(u.USERS),a=r.findIndex(c=>c.uid===t);if(a===-1)throw new Error("UsuÃ¡rio nÃ£o encontrado");if(s.rm&&!s.blocked&&r.some(m=>m.rm===s.rm&&m.uid!==t))throw new Error("Este RM jÃ¡ estÃ¡ cadastrado para outro usuÃ¡rio.");const n=s.isOnboarded!==void 0?s.isOnboarded:!!s.name&&!!s.rm&&!s.blocked,i={...r[a],...s,isOnboarded:n};r[a]=i,this.saveItems(u.USERS,r);const d=localStorage.getItem(u.CURRENT_USER),l=d?JSON.parse(d):null;return l&&l.uid===t&&(localStorage.setItem(u.CURRENT_USER,JSON.stringify(i)),this.notifyAuthListeners(i)),i}async getUserProfile(t){return await W(100),this.getItems(u.USERS).find(a=>a.uid===t)||null}async getUsers(t){await W(500);const s=this.getItems(u.USERS),{searchTerm:r,role:a,courseId:n,classId:i}=t.filters,d=s.filter(g=>{var E,I;const f=r?((E=g.name)==null?void 0:E.toLowerCase().includes(r.toLowerCase()))||g.email.toLowerCase().includes(r.toLowerCase())||((I=g.rm)==null?void 0:I.includes(r)):!0,x=a?g.role===a:!0,y=n?g.courseId===n:!0,p=i?g.classId===i:!0;return f&&x&&y&&p}),l=t.cursor||0,c=d.slice(l,l+t.limit),m=l+c.length;return{data:c,nextCursor:m<d.length?m:void 0}}async deleteUser(t){await W(500);let s=this.getItems(u.USERS);s=s.filter(r=>r.uid!==t),this.saveItems(u.USERS,s)}async updateUserRole(t,s){await W(300);const r=this.getItems(u.USERS),a=r.findIndex(n=>n.uid===t);a!==-1&&(r[a].role=s,this.saveItems(u.USERS,r))}}class Ve extends pe{constructor(){super(),localStorage.getItem(u.COURSES)||localStorage.setItem(u.COURSES,JSON.stringify(ss)),localStorage.getItem(u.CLASSES)||localStorage.setItem(u.CLASSES,JSON.stringify(rs))}async getCourses(){return this.getItems(u.COURSES)}async addCourse(t){const s=this.getItems(u.COURSES),r={id:`c_${Date.now()}`,name:t};return s.push(r),this.saveItems(u.COURSES,s),r}async updateCourse(t,s){const r=this.getItems(u.COURSES),a=r.findIndex(n=>n.id===t);a!==-1&&(r[a].name=s,this.saveItems(u.COURSES,r))}async deleteCourse(t){let s=this.getItems(u.COURSES);s=s.filter(a=>a.id!==t),this.saveItems(u.COURSES,s);let r=this.getItems(u.CLASSES);r=r.filter(a=>a.courseId!==t),this.saveItems(u.CLASSES,r)}async getClasses(t){const s=this.getItems(u.CLASSES);return t?s.filter(r=>r.courseId===t):s}async addClass(t,s){const r=this.getItems(u.CLASSES),a={id:`t_${Date.now()}`,courseId:t,name:s};return r.push(a),this.saveItems(u.CLASSES,r),a}async updateClass(t,s){const r=this.getItems(u.CLASSES),a=r.findIndex(n=>n.id===t);a!==-1&&(r[a].name=s,this.saveItems(u.CLASSES,r))}async deleteClass(t){let s=this.getItems(u.CLASSES);s=s.filter(r=>r.id!==t),this.saveItems(u.CLASSES,s)}async getEvents(t){await W(400);const s=this.getItems(u.EVENTS),{searchTerm:r,visibility:a,course:n}=t.filters,i=this.getItems(u.CLASSES),d=s.filter(g=>{var p,E;const f=r?g.name.toLowerCase().includes(r.toLowerCase())||g.description.toLowerCase().includes(r.toLowerCase()):!0,x=a?g.visibility===a:!0;let y=!0;return n&&(g.visibility==="public"?y=!1:g.visibility==="course"?y=((p=g.allowedCourses)==null?void 0:p.includes(n))||!1:g.visibility==="class"&&(y=((E=g.allowedClasses)==null?void 0:E.some(I=>{const v=i.find(w=>w.id===I);return(v==null?void 0:v.courseId)===n}))||!1)),f&&x&&y}),l=t.cursor||0,c=d.slice(l,l+t.limit),m=l+c.length;return{data:c,nextCursor:m<d.length?m:void 0}}async getEventById(t){return await W(200),this.getItems(u.EVENTS).find(r=>r.id===t)}async getEventsByIds(t){return await W(200),this.getItems(u.EVENTS).filter(r=>t.includes(r.id))}async getEventsByParentId(t){return await W(200),this.getItems(u.EVENTS).filter(r=>r.parentId===t)}async getAvailableEventsForUser(t){return await W(400),this.getItems(u.EVENTS).filter(r=>{var a,n;return r.visibility==="public"?!0:r.visibility==="course"?t.courseId?(a=r.allowedCourses)==null?void 0:a.includes(t.courseId):!1:r.visibility==="class"&&t.classId?(n=r.allowedClasses)==null?void 0:n.includes(t.classId):!1})}async getPublicEvents(){return await W(400),this.getItems(u.EVENTS).filter(s=>s.visibility==="public")}async createEvent(t){await W(600),this.addItem(u.EVENTS,t)}async updateEvent(t){await W(500);const s=this.getItems(u.EVENTS),r=s.findIndex(a=>a.id===t.id);if(r!==-1)s[r]=t,this.saveItems(u.EVENTS,s);else throw new Error("Evento nÃ£o encontrado para atualizaÃ§Ã£o")}async deleteEvent(t){await W(400);let s=this.getItems(u.EVENTS);const r=s.filter(i=>i.id===t||i.parentId===t).map(i=>i.id);s=s.filter(i=>!r.includes(i.id)),this.saveItems(u.EVENTS,s);let a=this.getItems(u.ENROLLMENTS);a=a.filter(i=>!r.includes(i.eventId)),this.saveItems(u.ENROLLMENTS,a);let n=this.getItems(u.TEAMS);n=n.filter(i=>!r.includes(i.eventId)),this.saveItems(u.TEAMS,n)}}class is extends pe{constructor(t){super(),this.notificationService=t}async getTeamsForEvent(t){return await W(300),this.getItems(u.TEAMS).filter(r=>r.eventId===t)}async createTeam(t,s,r){await W(500);const a=this.getItems(u.EVENTS),n=a.findIndex(p=>p.id===t);if(n===-1)throw new Error("Evento nÃ£o encontrado.");if(a[n].registrationLocked)throw new Error("As inscriÃ§Ãµes para este evento estÃ£o temporariamente bloqueadas.");const i=a[n].sessions.findIndex(p=>p.id===s);if(i===-1)throw new Error("SessÃ£o nÃ£o encontrada.");const d=a[n].sessions[i];if(d.filled>=d.capacity)throw new Error("A sessÃ£o estÃ¡ lotada.");const l=this.getItems(u.TEAMS),c=`team_${Date.now()}`,m=Math.random().toString(36).substring(2,6).toUpperCase(),g=`Equipe #${Math.floor(Math.random()*1e3)}`,f={id:c,eventId:t,sessionId:s,name:g,code:m,captainId:r.uid,members:[r.uid],createdAt:new Date().toISOString()};await this.createEnrollment(r.uid,t,s,!0);const x=this.getItems(u.ENROLLMENTS),y=x.findIndex(p=>p.userId===r.uid&&p.eventId===t);return y!==-1&&(x[y].teamId=c,this.saveItems(u.ENROLLMENTS,x)),a[n].sessions[i].filled+=1,this.saveItems(u.EVENTS,a),l.push(f),this.saveItems(u.TEAMS,l),f}async joinTeam(t,s,r){await W(500);const a=this.getItems(u.TEAMS),n=a.findIndex(l=>l.id===t);if(n===-1)throw new Error("Equipe nÃ£o encontrada.");if(a[n].code!==r)throw new Error("CÃ³digo de equipe invÃ¡lido.");if(a[n].members.includes(s.uid))throw new Error("VocÃª jÃ¡ faz parte desta equipe.");await this.createEnrollment(s.uid,a[n].eventId,a[n].sessionId,!0);const i=this.getItems(u.ENROLLMENTS),d=i.findIndex(l=>l.userId===s.uid&&l.eventId===a[n].eventId);d!==-1&&(i[d].teamId=t,this.saveItems(u.ENROLLMENTS,i)),a[n].members.push(s.uid),this.saveItems(u.TEAMS,a),await this.notificationService.createNotification({userId:a[n].captainId,title:"Novo membro na equipe! ðŸ›¡ï¸",message:`${s.name||"Um usuÃ¡rio"} entrou na sua equipe ${a[n].name}.`,type:"success",createdAt:new Date().toISOString(),read:!1,link:`/event/${a[n].eventId}`})}async leaveTeam(t,s){var g;await W(500);const r=this.getItems(u.TEAMS),a=r.findIndex(f=>f.id===t);if(a===-1)throw new Error("Equipe nÃ£o encontrada.");const n=r[a],i=this.getItems(u.EVENTS),d=i.findIndex(f=>f.id===n.eventId),l=localStorage.getItem(u.CURRENT_USER),c=l?JSON.parse(l):null,m=c==null?void 0:c.uid;if(n.captainId===s){for(const f of n.members){const y=this.getItems(u.ENROLLMENTS).find(p=>p.userId===f&&p.eventId===n.eventId);y&&await this.cancelEnrollment(y.id),f!==s&&await this.notificationService.createNotification({userId:f,title:"Equipe Desfeita âš ï¸",message:`A equipe "${n.name}" foi desfeita pelo capitÃ£o. Sua inscriÃ§Ã£o foi cancelada.`,type:"warning",read:!1,createdAt:new Date().toISOString(),link:"/dashboard"})}if(r.splice(a,1),d!==-1){const f=i[d].sessions.findIndex(x=>x.id===n.sessionId);f!==-1&&(i[d].sessions[f].filled=Math.max(0,i[d].sessions[f].filled-1),this.saveItems(u.EVENTS,i))}}else{n.members=n.members.filter(E=>E!==s);const x=this.getItems(u.ENROLLMENTS).find(E=>E.userId===s&&E.eventId===n.eventId);x&&await this.cancelEnrollment(x.id);const p=((g=this.getItems(u.USERS).find(E=>E.uid===s))==null?void 0:g.name)||"Um membro";m!==s?await this.notificationService.createNotification({userId:s,title:"Removido da Equipe ðŸš«",message:`VocÃª foi removido da equipe "${n.name}" pelo capitÃ£o.`,type:"warning",read:!1,createdAt:new Date().toISOString(),link:"/dashboard"}):await this.notificationService.createNotification({userId:n.captainId,title:"Membro Saiu ðŸƒ",message:`${p} saiu da sua equipe "${n.name}".`,type:"info",read:!1,createdAt:new Date().toISOString(),link:`/event/${n.eventId}`})}this.saveItems(u.TEAMS,r)}async kickMember(t,s){return this.leaveTeam(t,s)}async getEnrollmentsForUser(t){return await W(300),this.getItems(u.ENROLLMENTS).filter(r=>r.userId===t&&r.status!==Y.CANCELED)}async getUserEnrollmentsDetails(t){const s=this.getItems(u.ENROLLMENTS).filter(a=>a.userId===t&&a.status===Y.CONFIRMED),r=this.getItems(u.EVENTS);return s.map(a=>{const n=r.find(d=>d.id===a.eventId),i=n==null?void 0:n.sessions.find(d=>d.id===a.sessionId);return!n||!i?null:{enrollmentId:a.id,eventName:n.name,eventLocation:n.location,sessionDate:i.date,sessionTime:`${i.startTime} - ${i.endTime}`,enrolledAt:a.enrolledAt}}).filter(Boolean)}async getEnrichedEnrollments(t){const s=this.getItems(u.ENROLLMENTS).filter(n=>n.eventId===t&&n.status===Y.CONFIRMED),r=this.getItems(u.USERS),a=this.getItems(u.EVENTS).find(n=>n.id===t);return s.map(n=>{const i=r.find(l=>l.uid===n.userId),d=a==null?void 0:a.sessions.find(l=>l.id===n.sessionId);return{id:n.id,user:{uid:i==null?void 0:i.uid,name:(i==null?void 0:i.name)||"Desconhecido",email:(i==null?void 0:i.email)||"",rm:(i==null?void 0:i.rm)||"",courseId:i==null?void 0:i.courseId,classId:i==null?void 0:i.classId},session:{id:d==null?void 0:d.id,date:d==null?void 0:d.date,startTime:d==null?void 0:d.startTime,endTime:d==null?void 0:d.endTime},status:n.status,enrolledAt:n.enrolledAt,teamId:n.teamId,attended:n.attended,checkInAt:n.checkInAt}})}async getEnrollmentDetailsForEvent(t){const s=this.getItems(u.ENROLLMENTS).filter(n=>n.eventId===t&&n.status===Y.CONFIRMED),r=this.getItems(u.USERS),a=this.getItems(u.EVENTS).find(n=>n.id===t);return s.map(n=>{const i=r.find(l=>l.uid===n.userId),d=a==null?void 0:a.sessions.find(l=>l.id===n.sessionId);return{Nome:(i==null?void 0:i.name)||"Desconhecido",Email:(i==null?void 0:i.email)||"",RM:(i==null?void 0:i.rm)||"",SessaoData:Z(d==null?void 0:d.date),SessaoHora:(d==null?void 0:d.startTime)||"",Status:n.status,DataInscricao:new Date(n.enrolledAt).toLocaleString("pt-BR"),Presenca:n.attended?"Sim":"NÃ£o"}})}async createEnrollment(t,s,r,a=!1){await W(800);const n=this.getItems(u.EVENTS),i=n.findIndex(x=>x.id===s);if(i===-1)throw new Error("Evento nÃ£o encontrado");if(n[i].registrationLocked)throw new Error("As inscriÃ§Ãµes para este evento estÃ£o temporariamente bloqueadas.");const d=n[i].sessions.findIndex(x=>x.id===r);if(d===-1)throw new Error("SessÃ£o nÃ£o encontrada");const l=n[i].sessions[d];if(!a&&l.filled>=l.capacity)throw new Error("A sessÃ£o estÃ¡ lotada");const c=this.getItems(u.ENROLLMENTS),m=c.filter(x=>x.userId===t&&x.status===Y.CONFIRMED);if(m.find(x=>x.eventId===s))throw new Error("VocÃª jÃ¡ estÃ¡ inscrito neste evento");for(const x of m){const y=n.find(E=>E.id===x.eventId),p=y==null?void 0:y.sessions.find(E=>E.id===x.sessionId);if(y&&p&&p.date===l.date&&l.startTime<p.endTime&&l.endTime>p.startTime)throw new Error(`CONFLICT|${y.name}|${p.startTime}|${p.endTime}`)}const f={id:`enr_${Date.now()}`,userId:t,eventId:s,sessionId:r,status:Y.CONFIRMED,enrolledAt:new Date().toISOString(),attended:!1};return c.push(f),this.saveItems(u.ENROLLMENTS,c),a||(n[i].sessions[d].filled+=1,this.saveItems(u.EVENTS,n)),f}async cancelEnrollment(t){await W(500);const s=localStorage.getItem(u.CURRENT_USER),r=s?JSON.parse(s):null,a=r==null?void 0:r.uid,n=this.getItems(u.ENROLLMENTS),i=n.findIndex(c=>c.id===t);if(i===-1)throw new Error("InscriÃ§Ã£o nÃ£o encontrada");const d=n[i];let l=!0;if(d.teamId){const c=this.getItems(u.TEAMS),m=c.findIndex(g=>g.id===d.teamId);if(m!==-1){const g=c[m];g.members=g.members.filter(f=>f!==d.userId),g.captainId===d.userId?(c.splice(m,1),l=!0):l=!1,this.saveItems(u.TEAMS,c)}}if(l){const c=this.getItems(u.EVENTS),m=c.findIndex(g=>g.id===d.eventId);if(m!==-1){const g=c[m].sessions.findIndex(f=>f.id===d.sessionId);g!==-1&&(c[m].sessions[g].filled=Math.max(0,c[m].sessions[g].filled-1),this.saveItems(u.EVENTS,c))}}n.splice(i,1),this.saveItems(u.ENROLLMENTS,n),a&&d.userId!==a&&await this.notificationService.createNotification({userId:d.userId,title:"InscriÃ§Ã£o Cancelada âš ï¸",message:"Sua inscriÃ§Ã£o foi cancelada pela administraÃ§Ã£o.",type:"warning",read:!1,createdAt:new Date().toISOString(),link:"/dashboard"})}async markAttendance(t){await W(500);const s=this.getItems(u.ENROLLMENTS),r=s.findIndex(i=>i.id===t);if(r===-1)return{success:!1,message:"InscriÃ§Ã£o nÃ£o encontrada."};if(s[r].attended){const i=await new qe().getUserProfile(s[r].userId),d=await new Ve().getEventById(s[r].eventId);return{success:!1,message:"Check-in jÃ¡ realizado anteriormente.",alreadyAttended:!0,userName:(i==null?void 0:i.name)||"Desconhecido",eventName:(d==null?void 0:d.name)||"Evento"}}s[r].attended=!0,s[r].checkInAt=new Date().toISOString(),this.saveItems(u.ENROLLMENTS,s);const a=await new qe().getUserProfile(s[r].userId),n=await new Ve().getEventById(s[r].eventId);return{success:!0,message:"Check-in realizado com sucesso!",userName:a==null?void 0:a.name,eventName:n==null?void 0:n.name}}}class os extends pe{async getNotifications(t){return this.getItems(u.NOTIFICATIONS).filter(r=>r.userId===t).sort((r,a)=>a.createdAt.localeCompare(r.createdAt))}subscribeToNotifications(t,s){s(this.getItems(u.NOTIFICATIONS).filter(a=>a.userId===t).sort((a,n)=>n.createdAt.localeCompare(a.createdAt)));const r=setInterval(()=>{const a=this.getItems(u.NOTIFICATIONS).filter(n=>n.userId===t).sort((n,i)=>i.createdAt.localeCompare(n.createdAt));s(a)},3e3);return()=>clearInterval(r)}async markNotificationAsRead(t){const s=this.getItems(u.NOTIFICATIONS),r=s.findIndex(a=>a.id===t);r!==-1&&(s[r].read=!0,this.saveItems(u.NOTIFICATIONS,s))}async markAllNotificationsAsRead(t){const s=this.getItems(u.NOTIFICATIONS);s.forEach(r=>{r.userId===t&&(r.read=!0)}),this.saveItems(u.NOTIFICATIONS,s)}async createNotification(t){const s=this.getItems(u.NOTIFICATIONS),r={...t,id:`notif_${Date.now()}`};s.push(r),this.saveItems(u.NOTIFICATIONS,s)}async saveDeviceToken(t,s){console.log(`[Mock] Saving device token for user ${t}: ${s}`)}}class ds extends pe{async getCertificateConfig(){const t=localStorage.getItem(u.CERT_CONFIG);return t?JSON.parse(t):as}async updateCertificateConfig(t){localStorage.setItem(u.CERT_CONFIG,JSON.stringify(t))}async getSystemConfig(){const t=localStorage.getItem(u.SYSTEM_CONFIG);return t?JSON.parse(t):ns}async updateSystemConfig(t){localStorage.setItem(u.SYSTEM_CONFIG,JSON.stringify(t))}}class ls extends pe{async addPreStudents(t){const s=this.getItems(u.PRE_STUDENTS),r=new Map(s.map(a=>[a.rm,a]));t.forEach(a=>r.set(a.rm,a)),this.saveItems(u.PRE_STUDENTS,Array.from(r.values()))}async getPreStudentByRM(t){return await W(300),this.getItems(u.PRE_STUDENTS).find(r=>r.rm===t)||null}async getPreStudents(t){const s=this.getItems(u.PRE_STUDENTS),{limit:r,cursor:a,filters:n}=t,i=n.classId;let d=s;i&&(d=d.filter(g=>g.classId===i)),d.sort((g,f)=>g.name.localeCompare(f.name));const l=typeof a=="number"?a:0,c=d.slice(l,l+r),m=l+c.length<d.length?l+c.length:void 0;return{data:c,nextCursor:m}}async deletePreStudent(t){let s=this.getItems(u.PRE_STUDENTS);s=s.filter(r=>r.rm!==t),this.saveItems(u.PRE_STUDENTS,s)}}class cs extends pe{async resetAndSeedData(){localStorage.clear(),await W(500);const t=[{id:"c1",name:"CiÃªncia da ComputaÃ§Ã£o"},{id:"c2",name:"Direito"},{id:"c3",name:"Medicina"}];this.saveItems(u.COURSES,t);const s=[{id:"t1",courseId:"c1",name:"CC-2024-A"}];this.saveItems(u.CLASSES,s);const r=[{uid:"u_admin",email:"admin@school.com",name:"Admin",role:B.ADMIN,isOnboarded:!0}];this.saveItems(u.USERS,r)}async exportData(){const t={};return[u.USERS,u.EVENTS,u.ENROLLMENTS,u.COURSES,u.CLASSES,u.TEAMS,u.NOTIFICATIONS,u.CERT_CONFIG,u.SYSTEM_CONFIG,u.PRE_STUDENTS].forEach(r=>{t[r]=this.getItems(r)}),JSON.stringify(t,null,2)}async importData(t){try{const s=JSON.parse(t);localStorage.clear();const r={users:u.USERS,events:u.EVENTS,enrollments:u.ENROLLMENTS,courses:u.COURSES,classes:u.CLASSES,teams:u.TEAMS,notifications:u.NOTIFICATIONS,cert_config:u.CERT_CONFIG,pre_students:u.PRE_STUDENTS,system_config:u.SYSTEM_CONFIG,[u.TEAMS]:u.TEAMS,[u.CERT_CONFIG]:u.CERT_CONFIG,[u.SYSTEM_CONFIG]:u.SYSTEM_CONFIG,[u.PRE_STUDENTS]:u.PRE_STUDENTS};Object.keys(s).forEach(a=>{const n=r[a]||a;if(Array.isArray(s[a])){const i=s[a].map(d=>{const{_id:l,...c}=d;return c});this.saveItems(n,i)}else(n===u.CERT_CONFIG||n===u.SYSTEM_CONFIG)&&localStorage.setItem(n,JSON.stringify(s[a]))})}catch{throw new Error("Formato de JSON invÃ¡lido.")}}}class ms{constructor(){this.authService=new qe,this.eventService=new Ve,this.notificationService=new os,this.enrollmentService=new is(this.notificationService),this.devService=new cs,this.configService=new ds,this.preRegistrationService=new ls}login(t,s){return this.authService.login(t,s)}loginWithGoogle(){return this.authService.loginWithGoogle()}logout(){return this.authService.logout()}onAuthStateChanged(t){return this.authService.onAuthStateChanged(t)}updateUserProfile(t,s){return this.authService.updateUserProfile(t,s)}getUserProfile(t){return this.authService.getUserProfile(t)}getUsers(t){return this.authService.getUsers(t)}deleteUser(t){return this.authService.deleteUser(t)}updateUserRole(t,s){return this.authService.updateUserRole(t,s)}getCourses(){return this.eventService.getCourses()}addCourse(t){return this.eventService.addCourse(t)}updateCourse(t,s){return this.eventService.updateCourse(t,s)}deleteCourse(t){return this.eventService.deleteCourse(t)}getClasses(t){return this.eventService.getClasses(t)}addClass(t,s){return this.eventService.addClass(t,s)}updateClass(t,s){return this.eventService.updateClass(t,s)}deleteClass(t){return this.eventService.deleteClass(t)}getEvents(t){return this.eventService.getEvents(t)}getEventById(t){return this.eventService.getEventById(t)}getEventsByIds(t){return this.eventService.getEventsByIds(t)}getAvailableEventsForUser(t){return this.eventService.getAvailableEventsForUser(t)}getPublicEvents(){return this.eventService.getPublicEvents()}getEventsByParentId(t){return this.eventService.getEventsByParentId(t)}createEvent(t){return this.eventService.createEvent(t)}updateEvent(t){return this.eventService.updateEvent(t)}deleteEvent(t){return this.eventService.deleteEvent(t)}getTeamsForEvent(t){return this.enrollmentService.getTeamsForEvent(t)}createTeam(t,s,r){return this.enrollmentService.createTeam(t,s,r)}joinTeam(t,s,r){return this.enrollmentService.joinTeam(t,s,r)}leaveTeam(t,s){return this.enrollmentService.leaveTeam(t,s)}kickMember(t,s){return this.enrollmentService.kickMember(t,s)}getEnrollmentsForUser(t){return this.enrollmentService.getEnrollmentsForUser(t)}getUserEnrollmentsDetails(t){return this.enrollmentService.getUserEnrollmentsDetails(t)}getEnrichedEnrollments(t){return this.enrollmentService.getEnrichedEnrollments(t)}getEnrollmentDetailsForEvent(t){return this.enrollmentService.getEnrollmentDetailsForEvent(t)}createEnrollment(t,s,r,a){return this.enrollmentService.createEnrollment(t,s,r,a)}cancelEnrollment(t){return this.enrollmentService.cancelEnrollment(t)}markAttendance(t){return this.enrollmentService.markAttendance(t)}getNotifications(t){return this.notificationService.getNotifications(t)}subscribeToNotifications(t,s){return this.notificationService.subscribeToNotifications(t,s)}markNotificationAsRead(t){return this.notificationService.markNotificationAsRead(t)}markAllNotificationsAsRead(t){return this.notificationService.markAllNotificationsAsRead(t)}createNotification(t){return this.notificationService.createNotification(t)}saveDeviceToken(t,s){return this.notificationService.saveDeviceToken(t,s)}getCertificateConfig(){return this.configService.getCertificateConfig()}updateCertificateConfig(t){return this.configService.updateCertificateConfig(t)}getSystemConfig(){return this.configService.getSystemConfig()}updateSystemConfig(t){return this.configService.updateSystemConfig(t)}addPreStudents(t){return this.preRegistrationService.addPreStudents(t)}getPreStudentByRM(t){return this.preRegistrationService.getPreStudentByRM(t)}getPreStudents(t){return this.preRegistrationService.getPreStudents(t)}deletePreStudent(t){return this.preRegistrationService.deletePreStudent(t)}resetAndSeedData(){return this.devService.resetAndSeedData()}exportData(){return this.devService.exportData()}importData(t){return this.devService.importData(t)}}const gs=()=>oe.useFirebase?new ts:new ms,_=gs(),gt=b.createContext(void 0),us=({children:o})=>{const[t,s]=b.useState(null),[r,a]=b.useState(!0);b.useEffect(()=>{const c=_.onAuthStateChanged(m=>{s(m),a(!1)});return()=>c()},[]);const n=async(c,m)=>{a(!0);try{await _.login(c,m)}catch(g){throw console.error(g),a(!1),g}},i=async()=>{a(!0);try{await _.loginWithGoogle()}catch(c){throw console.error(c),a(!1),c}},d=async()=>{a(!0),await _.logout()},l=async()=>{if(t){a(!0);try{const c=await _.getUserProfile(t.uid);s(c)}catch(c){console.error("Falha ao atualizar o perfil",c)}finally{a(!1)}}};return e.jsx(gt.Provider,{value:{user:t,loading:r,login:n,loginWithGoogle:i,logout:d,refreshProfile:l},children:o})},re=()=>{const o=b.useContext(gt);if(!o)throw new Error("useAuth must be used within an AuthProvider");return o},ut=b.createContext(void 0),xs=({children:o})=>{const[t,s]=b.useState([]),r=b.useCallback(n=>{s(i=>i.filter(d=>d.id!==n))},[]),a=b.useCallback((n,i)=>{const d=Math.random().toString(36).substr(2,9);s(l=>[...l,{id:d,type:n,message:i}]),setTimeout(()=>{r(d)},4e3)},[r]);return e.jsxs(ut.Provider,{value:{addToast:a,removeToast:r},children:[o,e.jsx("div",{className:"fixed bottom-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none",children:t.map(n=>e.jsxs("div",{className:`pointer-events-auto transform transition-all duration-300 ease-in-out translate-y-0 opacity-100 min-w-[300px] max-w-md p-4 rounded-lg shadow-lg border-l-4 flex items-start justify-between bg-white dark:bg-darkcard dark:border-gray-600
              ${n.type==="success"?"border-green-500":""}
              ${n.type==="error"?"border-red-500":""}
              ${n.type==="warning"?"border-amber-500":""}
              ${n.type==="info"?"border-blue-500":""}
            `,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"text-xl mr-3",children:[n.type==="success"&&"âœ…",n.type==="error"&&"âŒ",n.type==="warning"&&"âš ï¸",n.type==="info"&&"â„¹ï¸"]}),e.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-gray-200",children:n.message})]}),e.jsx("button",{onClick:()=>r(n.id),className:"ml-4 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300 focus:outline-none",children:"Ã—"})]},n.id))})]})},ke=()=>{const o=b.useContext(ut);if(!o)throw new Error("useToast must be used within a ToastProvider");return o},xt=b.createContext(void 0),hs=({children:o})=>{const[t,s]=b.useState(()=>{const a=localStorage.getItem("eduevent_theme");return a==="dark"||a==="light"?a:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"});b.useEffect(()=>{const a=window.document.documentElement;t==="dark"?a.classList.add("dark"):a.classList.remove("dark"),localStorage.setItem("eduevent_theme",t)},[t]);const r=()=>{s(a=>a==="light"?"dark":"light")};return e.jsx(xt.Provider,{value:{theme:t,toggleTheme:r},children:o})},fs=()=>{const o=b.useContext(xt);if(!o)throw new Error("useTheme must be used within a ThemeProvider");return o},ps=()=>{const{user:o}=re(),[t,s]=b.useState([]),[r,a]=b.useState(0),[n,i]=b.useState(!1),[d,l]=b.useState(!0),[c,m]=b.useState(typeof Notification<"u"?Notification.permission:"denied"),g=b.useCallback(async()=>{if(!(typeof Notification>"u"))try{const p=await Notification.requestPermission();m(p),p==="granted"&&new Notification("EduEvent",{body:"NotificaÃ§Ãµes ativadas com sucesso!",icon:"https://cdn-icons-png.flaticon.com/512/2995/2995458.png"})}catch(p){console.error("Error requesting notification permission:",p)}},[]);b.useEffect(()=>{if(!o)return;const p=_.subscribeToNotifications(o.uid,E=>{if(E.length>0&&t.length>0){const I=E[0],v=t[0];I.id!==v.id&&!I.read&&Notification.permission==="granted"&&new Notification(I.title,{body:I.message,icon:"https://cdn-icons-png.flaticon.com/512/2995/2995458.png"})}s(E),a(E.filter(I=>!I.read).length),l(!1)});return()=>p()},[o]);const f=b.useCallback(async()=>{if(!o)return;const p=localStorage.getItem(`last_event_check_${o.uid}`),I=new Date().toISOString().split("T")[0];if(p!==I)try{const v=await _.getEnrollmentsForUser(o.uid);if(v.length===0)return;const w=[...new Set(v.map(A=>A.eventId))],k=await _.getEventsByIds(w),N=new Date;N.setDate(N.getDate()+1);const S=N.toISOString().split("T")[0];for(const A of v){const C=k.find(O=>O.id===A.eventId);if(!C)continue;const R=C.sessions.find(O=>O.id===A.sessionId);if(R&&(R.date===I||R.date===S)){const O=R.date===I,T=O?"Evento Hoje! ðŸ“…":"Evento AmanhÃ£! â³",L=`NÃ£o esqueÃ§a: "${C.name}" acontece ${O?"hoje":"amanhÃ£"} Ã s ${R.startTime}.`;t.some(G=>G.type==="reminder"&&G.message===L)||await _.createNotification({userId:o.uid,title:T,message:L,type:"reminder",read:!1,createdAt:new Date().toISOString(),link:`/event/${C.id}`})}}localStorage.setItem(`last_event_check_${o.uid}`,I)}catch(v){console.error("Error checking upcoming events",v)}},[o,t]);return b.useEffect(()=>{f()},[f]),{notifications:t,unreadCount:r,isOpen:n,setIsOpen:i,markAsRead:async p=>{s(E=>E.map(I=>I.id===p?{...I,read:!0}:I)),a(E=>Math.max(0,E-1)),await _.markNotificationAsRead(p)},markAllAsRead:async()=>{o&&(s(p=>p.map(E=>({...E,read:!0}))),a(0),await _.markAllNotificationsAsRead(o.uid))},loading:d,permission:c,requestPermission:g}},nt=()=>{const{notifications:o,unreadCount:t,isOpen:s,setIsOpen:r,markAsRead:a,markAllAsRead:n,permission:i,requestPermission:d}=ps(),l=b.useRef(null);b.useEffect(()=>{const m=g=>{l.current&&!l.current.contains(g.target)&&r(!1)};return document.addEventListener("mousedown",m),()=>document.removeEventListener("mousedown",m)},[r]);const c=m=>{switch(m){case"success":return"âœ…";case"warning":return"âš ï¸";case"reminder":return"â°";default:return"â„¹ï¸"}};return e.jsxs("div",{className:"relative",ref:l,children:[e.jsxs("button",{onClick:()=>r(!s),className:"relative p-2 text-gray-400 hover:text-gray-500 dark:text-gray-400 dark:hover:text-gray-300 focus:outline-none",children:[e.jsx("span",{className:"sr-only",children:"NotificaÃ§Ãµes"}),e.jsx("svg",{className:"h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),t>0&&e.jsx("span",{className:"absolute top-1.5 right-1.5 block h-2.5 w-2.5 rounded-full ring-2 ring-white dark:ring-gray-800 bg-red-500 animate-pulse"})]}),s&&e.jsxs("div",{className:`
            fixed left-4 right-4 top-16 mt-2 z-[60]
            sm:absolute sm:right-0 sm:left-auto sm:top-full sm:w-80 sm:mt-2
            origin-top-right rounded-md shadow-lg bg-white dark:bg-darkcard 
            ring-1 ring-black ring-opacity-5 focus:outline-none 
            overflow-hidden border border-gray-100 dark:border-gray-700
        `,children:[e.jsxs("div",{className:"py-2 px-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800",children:[e.jsx("span",{className:"text-sm font-bold text-gray-700 dark:text-gray-200",children:"NotificaÃ§Ãµes"}),t>0&&e.jsx("button",{onClick:n,className:"text-xs text-primary hover:text-indigo-600 dark:text-indigo-400",children:"Marcar todas como lidas"})]}),i==="default"&&e.jsxs("div",{className:"p-3 bg-indigo-50 dark:bg-indigo-900/20 border-b border-indigo-100 dark:border-indigo-800/30",children:[e.jsx("p",{className:"text-xs text-indigo-700 dark:text-indigo-300 mb-2",children:"Receba alertas sobre eventos e mudanÃ§as na sua equipe."}),e.jsx("button",{onClick:d,className:"w-full py-1.5 px-3 bg-white dark:bg-indigo-700 border border-indigo-200 dark:border-indigo-600 rounded text-xs font-bold text-indigo-600 dark:text-white hover:bg-indigo-50 dark:hover:bg-indigo-600 transition-colors shadow-sm",children:"Ativar notificaÃ§Ãµes no desktop ðŸ””"})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:o.length===0?e.jsx("div",{className:"py-8 text-center text-gray-500 dark:text-gray-400 text-sm",children:"Nenhuma notificaÃ§Ã£o."}):e.jsx("ul",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:o.map(m=>e.jsx("li",{className:`p-4 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors ${m.read?"":"bg-indigo-50/50 dark:bg-indigo-900/10"}`,onClick:()=>a(m.id),children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"flex-shrink-0 text-xl pt-1",children:c(m.type)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-sm font-medium ${m.read?"text-gray-600 dark:text-gray-400":"text-gray-900 dark:text-white"}`,children:m.title}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:m.message}),e.jsxs("div",{className:"mt-2 flex justify-between items-center",children:[e.jsx("span",{className:"text-[10px] text-gray-400",children:new Date(m.createdAt).toLocaleDateString()}),m.link&&e.jsx($,{to:m.link,className:"text-xs text-primary font-bold hover:underline",onClick:()=>r(!1),children:"Ver Detalhes"})]})]}),!m.read&&e.jsx("div",{className:"flex-shrink-0 self-center",children:e.jsx("span",{className:"block h-2 w-2 rounded-full bg-primary"})})]})},m.id))})})]})]})},te=({children:o})=>{const{user:t,logout:s}=re(),{theme:r,toggleTheme:a}=fs(),n=fe(),i=We(),[d,l]=b.useState(!1),c=async()=>{await s(),n("/")},m=p=>i.pathname===p?"bg-indigo-50 border-primary text-primary dark:bg-indigo-900/50 dark:text-indigo-200":"border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200",g=p=>i.pathname===p?"border-primary text-gray-900 dark:text-white dark:border-indigo-400":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200";if(!t)return e.jsx(e.Fragment,{children:o});const f=t.role===B.ADMIN,x=t.role===B.ADMIN||t.role===B.COORDINATOR,y="inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium transition-colors h-full whitespace-nowrap";return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50 dark:bg-darkbg transition-colors duration-200",children:[e.jsxs("nav",{className:"bg-white dark:bg-darkcard shadow-sm sticky top-0 z-50 transition-colors duration-200",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-16",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center",children:e.jsx($,{to:"/dashboard",className:"text-primary font-bold text-xl tracking-tight dark:text-indigo-400",children:"EduEvent"})}),e.jsxs("div",{className:"hidden sm:ml-6 sm:flex sm:items-center sm:gap-6 overflow-x-auto no-scrollbar",children:[e.jsx($,{to:"/dashboard",className:`${y} ${g("/dashboard")}`,children:"Eventos"}),e.jsx($,{to:"/calendar",className:`${y} ${g("/calendar")}`,children:"CalendÃ¡rio"}),e.jsx($,{to:"/my-enrollments",className:`${y} ${g("/my-enrollments")}`,children:"Minhas InscriÃ§Ãµes"}),x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-5 w-px bg-gray-300 dark:bg-gray-700"}),e.jsx($,{to:"/admin/scanner",className:`${y} ${g("/admin/scanner")}`,children:"Scanner"}),e.jsx($,{to:"/admin/events",className:`${y} ${g("/admin/events")}`,children:"Eventos"})]}),f&&e.jsxs(e.Fragment,{children:[e.jsx($,{to:"/admin/courses",className:`${y} ${g("/admin/courses")}`,children:"Cursos"}),e.jsx($,{to:"/admin/users",className:`${y} ${g("/admin/users")}`,children:"UsuÃ¡rios"}),e.jsx($,{to:"/admin/pre-students",className:`${y} ${g("/admin/pre-students")}`,children:"PrÃ©-Cadastro"}),e.jsx($,{to:"/admin/certificate",className:`${y} ${g("/admin/certificate")}`,children:"Certificados"}),e.jsx($,{to:"/admin/dev",className:`${y} text-amber-600 dark:text-amber-400 ${g("/admin/dev")}`,children:"Dev"})]})]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-4",children:[e.jsx(nt,{}),e.jsx("button",{onClick:a,className:"p-2 rounded-full text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700 transition-colors",title:r==="dark"?"Mudar para modo claro":"Mudar para modo escuro",children:r==="dark"?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})}),e.jsxs("div",{className:"flex-shrink-0 flex items-center",children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400 mr-4 truncate max-w-[150px]",children:t.name||t.email}),e.jsx("button",{onClick:c,className:"relative inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-primary hover:bg-indigo-700 shadow-sm focus:outline-none transition-colors",children:"Sair"})]})]}),e.jsxs("div",{className:"-mr-2 flex items-center sm:hidden gap-2",children:[e.jsx(nt,{}),e.jsx("button",{onClick:a,className:"p-3 rounded-full text-gray-500 hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-700 transition-colors",children:r==="dark"?e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})}),e.jsxs("button",{onClick:()=>l(!d),type:"button",className:"bg-white dark:bg-gray-800 inline-flex items-center justify-center p-3 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary","aria-controls":"mobile-menu","aria-expanded":"false",children:[e.jsx("span",{className:"sr-only",children:"Abrir menu principal"}),d?e.jsx("svg",{className:"block h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})}):e.jsx("svg",{className:"block h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"})})]})]})]})}),d&&e.jsxs("div",{className:"sm:hidden border-t border-gray-200 dark:border-gray-700",id:"mobile-menu",children:[e.jsxs("div",{className:"pt-2 pb-3 space-y-1",children:[e.jsx($,{to:"/dashboard",onClick:()=>l(!1),className:`block pl-3 pr-4 py-3 border-l-4 text-base font-medium transition-colors ${m("/dashboard")}`,children:"Eventos"}),e.jsx($,{to:"/calendar",onClick:()=>l(!1),className:`block pl-3 pr-4 py-3 border-l-4 text-base font-medium transition-colors ${m("/calendar")}`,children:"CalendÃ¡rio"}),e.jsx($,{to:"/my-enrollments",onClick:()=>l(!1),className:`block pl-3 pr-4 py-3 border-l-4 text-base font-medium transition-colors ${m("/my-enrollments")}`,children:"Minhas InscriÃ§Ãµes"}),x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pt-4 pb-2",children:e.jsx("span",{className:"px-4 text-xs font-bold text-gray-400 uppercase tracking-wider",children:"GestÃ£o"})}),e.jsx($,{to:"/admin/scanner",onClick:()=>l(!1),className:`block pl-3 pr-4 py-3 border-l-4 text-base font-medium transition-colors ${m("/admin/scanner")}`,children:"Scanner Check-in"}),e.jsx($,{to:"/admin/events",onClick:()=>l(!1),className:`block pl-3 pr-4 py-3 border-l-4 text-base font-medium transition-colors ${m("/admin/events")}`,children:"Gerenciar Eventos"})]}),f&&e.jsxs(e.Fragment,{children:[e.jsx($,{to:"/admin/courses",onClick:()=>l(!1),className:`block pl-3 pr-4 py-3 border-l-4 text-base font-medium transition-colors ${m("/admin/courses")}`,children:"Gerenciar Cursos"}),e.jsx($,{to:"/admin/users",onClick:()=>l(!1),className:`block pl-3 pr-4 py-3 border-l-4 text-base font-medium transition-colors ${m("/admin/users")}`,children:"Gerenciar UsuÃ¡rios"}),e.jsx($,{to:"/admin/pre-students",onClick:()=>l(!1),className:`block pl-3 pr-4 py-3 border-l-4 text-base font-medium transition-colors ${m("/admin/pre-students")}`,children:"PrÃ©-Cadastro Alunos"}),e.jsx($,{to:"/admin/certificate",onClick:()=>l(!1),className:`block pl-3 pr-4 py-3 border-l-4 text-base font-medium transition-colors ${m("/admin/certificate")}`,children:"Config. Certificados"}),e.jsx($,{to:"/admin/dev",onClick:()=>l(!1),className:"block pl-3 pr-4 py-3 border-l-4 text-base font-medium text-amber-600 bg-amber-50 border-amber-300 dark:bg-amber-900/20 dark:border-amber-700 dark:text-amber-500",children:"Dev"})]})]}),e.jsxs("div",{className:"pt-4 pb-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center px-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-900 flex items-center justify-center text-primary dark:text-indigo-200 font-bold text-lg",children:t.name?t.name.charAt(0):t.email.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-base font-medium text-gray-800 dark:text-gray-200",children:t.name||"UsuÃ¡rio"}),e.jsx("div",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:t.email})]})]}),e.jsx("div",{className:"mt-3 space-y-1",children:e.jsx("button",{onClick:c,className:"block w-full text-left px-4 py-3 text-base font-medium text-gray-500 hover:text-gray-800 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-gray-200 dark:hover:bg-gray-700",children:"Sair do Sistema"})})]})]})]}),e.jsx("main",{className:"flex-1 py-6",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:o})})]})},de=({children:o,isLoading:t=!1,variant:s="primary",className:r="",disabled:a,...n})=>{const i="relative inline-flex items-center justify-center px-4 py-2 border text-sm font-medium rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors disabled:opacity-60 disabled:cursor-not-allowed",d={primary:"border-transparent text-white bg-primary hover:bg-indigo-700 focus:ring-primary",secondary:"border-transparent text-white bg-secondary hover:bg-emerald-700 focus:ring-secondary",danger:"border-transparent text-white bg-red-600 hover:bg-red-700 focus:ring-red-500",outline:"border-gray-300 text-gray-700 bg-white hover:bg-gray-50 focus:ring-primary"};return e.jsxs("button",{disabled:t||a,className:`${i} ${d[s]} ${r}`,...n,children:[e.jsx("span",{className:t?"invisible":"",children:o}),t&&e.jsx("span",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("svg",{className:"animate-spin h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]})},Te=o=>{const t=(o==null?void 0:o.code)||"",s=(o==null?void 0:o.message)||"";if(typeof s=="string"&&s.startsWith("CONFLICT|")){const r=s.split("|");return r.length>=4?`Conflito de horÃ¡rio! VocÃª jÃ¡ possui o evento "${r[1]}" agendado entre ${r[2]} e ${r[3]}.`:"Conflito de horÃ¡rio com outro evento jÃ¡ agendado."}if(s==="A sessÃ£o estÃ¡ lotada"||s.includes("capacidade mÃ¡xima"))return"Que pena! Esta sessÃ£o acabou de lotar.";if(s.includes("jÃ¡ estÃ¡ inscrito"))return"VocÃª jÃ¡ garantiu sua vaga neste evento!";if(s.includes("Evento nÃ£o encontrado"))return"O evento que vocÃª procura nÃ£o estÃ¡ mais disponÃ­vel.";switch(t){case"auth/invalid-credential":case"auth/user-not-found":case"auth/wrong-password":return"E-mail ou senha incorretos. Verifique e tente novamente.";case"auth/email-already-in-use":return"Este e-mail jÃ¡ estÃ¡ sendo usado por outra conta.";case"auth/weak-password":return"Sua senha Ã© muito fraca. Escolha uma senha mais forte.";case"auth/invalid-email":return"O formato do e-mail Ã© invÃ¡lido.";case"auth/user-disabled":return"Esta conta foi desativada. Contate o administrador.";case"auth/too-many-requests":return"Muitas tentativas consecutivas. Aguarde alguns instantes.";case"auth/network-request-failed":return"Erro de conexÃ£o. Verifique sua internet.";case"auth/popup-closed-by-user":return"O login foi cancelado.";case"permission-denied":return"VocÃª nÃ£o tem permissÃ£o para realizar esta aÃ§Ã£o.";default:return s||"Ocorreu um erro inesperado. Tente novamente mais tarde."}},xe=({label:o,error:t,helperText:s,as:r="input",className:a="",children:n,id:i,...d})=>{const l=i||d.name||Math.random().toString(36).substr(2,9),c=`${l}-error`,m=`${l}-helper`,g=`
    appearance-none 
    block 
    w-full 
    px-4 
    py-3 
    text-base 
    rounded-lg 
    border 
    bg-white dark:bg-gray-800 
    text-gray-900 dark:text-white 
    placeholder-gray-400 
    focus:outline-none 
    focus:ring-2 
    focus:ring-offset-0
    transition-shadow 
    duration-200
  `,f=t?"border-red-300 focus:border-red-500 focus:ring-red-200 dark:border-red-800 dark:focus:ring-red-900/30":"border-gray-300 dark:border-gray-600 focus:border-primary focus:ring-indigo-100 dark:focus:ring-indigo-900/30",x=[t?c:void 0,s?m:void 0].filter(Boolean).join(" ")||void 0;return e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:l,className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5 ml-1",children:o}),e.jsx("div",{className:"relative",children:r==="select"?e.jsx("select",{id:l,className:`${g} ${f} ${a} pr-10`,"aria-invalid":!!t,"aria-describedby":x,...d,children:n}):e.jsx("input",{id:l,className:`${g} ${f} ${a}`,"aria-invalid":!!t,"aria-describedby":x,...d})}),t?e.jsxs("p",{id:c,className:"mt-1.5 text-sm text-red-600 dark:text-red-400 flex items-center animate-fade-in ml-1",role:"alert",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),t]}):s?e.jsx("p",{id:m,className:"mt-1.5 text-sm text-gray-500 dark:text-gray-400 ml-1",children:s}):null]})},bs=()=>{var E,I;const[o,t]=b.useState(""),[s,r]=b.useState(""),{user:a,loading:n,login:i,loginWithGoogle:d}=re(),l=fe(),c=We(),{addToast:m}=ke(),[g,f]=b.useState(!1),x=(I=(E=c.state)==null?void 0:E.from)!=null&&I.pathname?c.state.from.pathname+(c.state.from.search||""):"/dashboard";b.useEffect(()=>{!n&&a&&l(x,{replace:!0})},[a,n,l,x]);const y=async v=>{v.preventDefault(),f(!0);try{await i(o,s),m("success","Login realizado com sucesso!")}catch(w){const k=Te(w);m("error",k)}finally{f(!1)}},p=async()=>{f(!0);try{await d(),m("success","Autenticado com Google!")}catch(v){const w=Te(v);m("error",w),f(!1)}};return n||!n&&a?e.jsx("div",{className:"h-screen flex items-center justify-center bg-gray-50 dark:bg-darkbg text-primary font-medium",children:"Verificando sessÃ£o..."}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-darkbg py-12 px-4 sm:px-6 lg:px-8 transition-colors duration-300",children:e.jsxs("div",{className:"max-w-md w-full space-y-8 text-center",children:[e.jsx("div",{className:"flex justify-start",children:e.jsxs($,{to:"/",className:"flex items-center text-sm text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary transition-colors font-medium p-2 -ml-2 rounded-lg active:bg-gray-100 dark:active:bg-gray-800",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Voltar para o inÃ­cio"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold text-primary dark:text-indigo-400",children:"EduEvent"}),e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900 dark:text-white",children:"Acesse sua conta"}),e.jsx("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:oe.useFirebase?"Gerencie suas inscriÃ§Ãµes e eventos em um sÃ³ lugar.":"Ambiente de DemonstraÃ§Ã£o (Mock)"})]}),e.jsxs("form",{className:"mt-8 space-y-2",onSubmit:y,children:[e.jsx(xe,{id:"email-address",name:"email",type:"email",autoComplete:"email",required:!0,label:"E-mail",placeholder:"seu@email.com",value:o,onChange:v=>t(v.target.value),inputMode:"email"}),e.jsx(xe,{id:"password",name:"password",type:"password",autoComplete:"current-password",required:oe.useFirebase,label:"Senha",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",value:s,onChange:v=>r(v.target.value),enterKeyHint:"go"}),e.jsx("div",{className:"pt-4",children:e.jsx(de,{type:"submit",isLoading:g,className:"w-full h-12 text-base shadow-lg shadow-indigo-200 dark:shadow-none",children:"Acessar Plataforma"})}),e.jsxs("div",{className:"relative my-6",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-300 dark:border-gray-700"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-gray-50 dark:bg-darkbg text-gray-500 dark:text-gray-400",children:"Ou entre rapidamente com"})})]}),e.jsxs("button",{type:"button",onClick:p,disabled:g,className:"w-full h-12 flex items-center justify-center px-4 border border-gray-300 dark:border-gray-600 shadow-sm text-base font-medium rounded-lg text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-70 transition-colors active:scale-[0.98]",children:[e.jsxs("svg",{className:"h-5 w-5 mr-3","aria-hidden":"true",viewBox:"0 0 24 24",children:[e.jsx("path",{d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z",fill:"#4285F4"}),e.jsx("path",{d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z",fill:"#34A853"}),e.jsx("path",{d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.84z",fill:"#FBBC05"}),e.jsx("path",{d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z",fill:"#EA4335"})]}),"Google"]})]}),!oe.useFirebase&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-4 p-4 border border-dashed border-gray-300 dark:border-gray-700 rounded-lg",children:[e.jsx("p",{className:"font-bold mb-2",children:"Ambiente de Teste (Mock):"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{onClick:()=>t("student@school.com"),className:"cursor-pointer hover:text-primary transition-colors p-2 bg-white dark:bg-gray-800 rounded shadow-sm border border-gray-100 dark:border-gray-700",children:"ðŸ‘¤ student@school.com"}),e.jsx("li",{onClick:()=>t("admin@school.com"),className:"cursor-pointer hover:text-primary transition-colors p-2 bg-white dark:bg-gray-800 rounded shadow-sm border border-gray-100 dark:border-gray-700",children:"ðŸ›¡ï¸ admin@school.com"})]})]})]})})},ys=(o,t={})=>{const[s,r]=b.useState(null),[a,n]=b.useState(null),i=t.minSwipeDistance||50;return{onTouchStart:m=>{n(null),r({x:m.targetTouches[0].clientX,y:m.targetTouches[0].clientY})},onTouchMove:m=>{n({x:m.targetTouches[0].clientX,y:m.targetTouches[0].clientY})},onTouchEnd:()=>{if(!s||!a)return;const m=s.x-a.x,g=s.y-a.y;if(Math.abs(m)>Math.abs(g)){if(Math.abs(m)<i)return;m>0?o.onSwipeLeft&&o.onSwipeLeft():o.onSwipeRight&&o.onSwipeRight()}else{if(Math.abs(g)<i)return;g>0?o.onSwipeUp&&o.onSwipeUp():o.onSwipeDown&&o.onSwipeDown()}}}},le=({isOpen:o,onClose:t,title:s,children:r})=>{const a=b.useRef(null),n=b.useRef(null),i=ys({onSwipeDown:t});return b.useEffect(()=>(o?(n.current=document.activeElement,document.body.style.overflow="hidden",setTimeout(()=>{a.current&&a.current.focus()},50)):(document.body.style.overflow="unset",n.current&&n.current.focus()),()=>{document.body.style.overflow="unset"}),[o]),b.useEffect(()=>{const d=l=>{l.key==="Escape"&&t()};return o&&window.addEventListener("keydown",d),()=>{window.removeEventListener("keydown",d)}},[o,t]),o?e.jsx("div",{className:"fixed inset-0 z-[100] overflow-y-auto","aria-labelledby":"modal-title",role:"dialog","aria-modal":"true",children:e.jsxs("div",{className:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-80 transition-opacity animate-fade-in","aria-hidden":"true",onClick:t}),e.jsx("span",{className:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true",children:"â€‹"}),e.jsxs("div",{ref:a,tabIndex:-1,className:`
              inline-block align-bottom bg-white dark:bg-darkcard 
              rounded-t-2xl sm:rounded-lg 
              text-left overflow-hidden shadow-xl 
              transform transition-all 
              w-full sm:my-8 sm:align-middle sm:max-w-lg 
              animate-slide-in outline-none
              relative
            `,...i,children:[e.jsx("div",{className:"sm:hidden w-full flex justify-center pt-3 pb-1",onClick:t,children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 dark:bg-gray-600 rounded-full"})}),e.jsx("div",{className:"bg-white dark:bg-darkcard px-4 pt-2 pb-4 sm:p-6 sm:pb-4",children:e.jsx("div",{className:"sm:flex sm:items-start",children:e.jsxs("div",{className:"mt-2 text-center sm:mt-0 sm:text-left w-full",children:[e.jsx("h3",{className:"text-lg leading-6 font-bold text-gray-900 dark:text-white",id:"modal-title",children:s}),e.jsx("div",{className:"mt-4 text-gray-600 dark:text-gray-300",children:r})]})})}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800/50 px-4 py-4 sm:px-6 sm:flex sm:flex-row-reverse border-t border-gray-100 dark:border-gray-700",children:e.jsx("button",{type:"button",className:"w-full inline-flex justify-center rounded-lg border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-3 bg-white dark:bg-gray-700 text-base font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm sm:py-2 transition-colors active:scale-[0.98]",onClick:t,children:"Fechar"})})]})]})}):null},vs=()=>{const{user:o,refreshProfile:t,logout:s}=re(),r=fe(),{addToast:a}=ke(),[n,i]=b.useState(!1),[d,l]=b.useState(!0),[c,m]=b.useState(!1),[g,f]=b.useState([]),[x,y]=b.useState([]),[p,E]=b.useState(null),[I,v]=b.useState(!1),[w,k]=b.useState({name:(o==null?void 0:o.name)||"",rm:"",courseId:"",classId:""});b.useEffect(()=>{if(o!=null&&o.isOnboarded){r("/dashboard");return}if(o!=null&&o.blocked){r("/blocked");return}(async()=>{try{const[L,D,G]=await Promise.all([_.getSystemConfig(),_.getCourses(),_.getClasses()]);m(L.preRegistrationEnabled),f(D),y(G)}catch(L){console.error(L)}finally{l(!1)}})()},[o,r]),b.useEffect(()=>{!c&&w.courseId},[w.courseId,c]);const N=T=>{var L;return((L=g.find(D=>D.id===T))==null?void 0:L.name)||"Desconhecido"},S=T=>{var L;return((L=x.find(D=>D.id===T))==null?void 0:L.name)||"Desconhecida"},A=async T=>{if(T.preventDefault(),!!o)if(c){const L=w.rm.trim();if(!L){a("error","O RM Ã© obrigatÃ³rio.");return}k(D=>({...D,rm:L})),v(!0)}else{i(!0);try{const L={...w,email:o.email,role:o.role};await _.updateUserProfile(o.uid,L),await t(),a("success","Perfil completado com sucesso! Bem-vindo."),r("/dashboard")}catch(L){const D=Te(L);a("error",D),i(!1)}}},C=async()=>{if(!o)return;v(!1),i(!0);const T=w.rm.trim();try{const L=await _.getPreStudentByRM(T);if(L)E(L),i(!1);else{const D={rm:T,email:o.email,name:o.name||w.name,blocked:!0,isOnboarded:!1,role:o.role||B.USER};await _.updateUserProfile(o.uid,D);try{const{data:G}=await _.getUsers({limit:50,filters:{role:B.ADMIN}});G.length>0&&await Promise.all(G.map(Ne=>_.createNotification({userId:Ne.uid,title:"Tentativa de Cadastro InvÃ¡lida ðŸš«",message:`RM ${T} (${o.email}) tentou cadastro mas nÃ£o consta no prÃ©-banco.`,type:"warning",read:!1,createdAt:new Date().toISOString(),link:`/admin/users?search=${encodeURIComponent(o.email)}`})))}catch(G){console.error("Erro ao notificar admins:",G)}await t(),r("/blocked")}}catch(L){const D=Te(L);a("error",D),i(!1)}},R=async()=>{if(!(!o||!p)){i(!0);try{const T={rm:p.rm,name:p.name,classId:p.classId,courseId:p.courseId,email:o.email,role:o.role,isOnboarded:!0,blocked:!1};await _.updateUserProfile(o.uid,T),await t(),a("success",`Bem-vindo(a), ${p.name}! Cadastro validado.`),r("/dashboard")}catch{a("error","Erro ao finalizar cadastro."),i(!1)}}},O=()=>{E(null),i(!1)};return d?e.jsx("div",{className:"h-screen flex items-center justify-center text-gray-500",children:"Carregando..."}):e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-darkbg py-12 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"max-w-md w-full space-y-8 bg-white dark:bg-darkcard p-8 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 transition-all",children:p?e.jsxs("div",{className:"animate-fade-in space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-green-100 dark:bg-green-900/30 mb-4",children:e.jsx("svg",{className:"h-8 w-8 text-green-600 dark:text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Cadastro Encontrado!"}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"Por favor, verifique se estes dados estÃ£o corretos antes de continuar."})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-5 border border-gray-200 dark:border-gray-700 space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"RM"}),e.jsx("div",{className:"font-mono font-bold text-lg text-gray-900 dark:text-white",children:p.rm})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Nome do Aluno"}),e.jsx("div",{className:"font-medium text-gray-800 dark:text-gray-200",children:p.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-2 border-t border-gray-200 dark:border-gray-700 mt-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Curso"}),e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:N(p.courseId)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider",children:"Turma"}),e.jsx("div",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:S(p.classId)})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(de,{onClick:R,isLoading:n,className:"w-full h-12 text-base shadow-lg bg-green-600 hover:bg-green-700 focus:ring-green-500",children:"Confirmar e Acessar"}),e.jsx("button",{onClick:O,disabled:n,className:"w-full py-3 text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white font-medium transition-colors",children:"NÃ£o sou eu / Voltar"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-2 text-center text-3xl font-extrabold text-gray-900 dark:text-white",children:c?"ValidaÃ§Ã£o de MatrÃ­cula":"Complete seu perfil"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600 dark:text-gray-400",children:c?"Informe seu RM para localizarmos seu cadastro.":"Precisamos de mais alguns detalhes antes de comeÃ§ar."})]}),e.jsxs("form",{className:"mt-8 space-y-4",onSubmit:A,children:[e.jsx(xe,{id:"rm",name:"rm",type:"text",required:!0,label:"Registro de MatrÃ­cula (RM)",placeholder:"Ex: 12345",value:w.rm,onChange:T=>k({...w,rm:T.target.value.trim()}),inputMode:"numeric",autoFocus:!0}),!c&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{id:"name",name:"name",type:"text",required:!0,label:"Nome Completo",placeholder:"Ex: JoÃ£o da Silva",value:w.name,onChange:T=>k({...w,name:T.target.value}),autoComplete:"name"}),e.jsxs(xe,{as:"select",label:"Curso",required:!0,value:w.courseId,onChange:T=>k({...w,courseId:T.target.value}),children:[e.jsx("option",{value:"",children:"Selecione o Curso"}),g.map(T=>e.jsx("option",{value:T.id,children:T.name},T.id))]}),e.jsxs(xe,{as:"select",label:"Turma",required:!0,disabled:!w.courseId,value:w.classId,onChange:T=>k({...w,classId:T.target.value}),className:"disabled:opacity-50",children:[e.jsx("option",{value:"",children:"Selecione a Turma"}),x.filter(T=>T.courseId===w.courseId).map(T=>e.jsx("option",{value:T.id,children:T.name},T.id))]})]}),e.jsxs("div",{className:"pt-4 flex flex-col gap-3",children:[e.jsx(de,{type:"submit",isLoading:n,className:"w-full h-12 text-base shadow-lg",children:c?"Buscar Cadastro":"Concluir Cadastro"}),e.jsx("button",{type:"button",onClick:s,className:"text-sm text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white text-center",children:"Sair / Entrar com outra conta"})]})]})]})}),e.jsx(le,{isOpen:I,onClose:()=>v(!1),title:"Confirmar RM",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 uppercase font-bold tracking-wider mb-1",children:"VocÃª digitou o RM"}),e.jsx("p",{className:"text-4xl font-mono font-bold text-gray-900 dark:text-white tracking-widest",children:w.rm})]}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-lg border-l-4 border-amber-500 flex gap-3",children:[e.jsx("div",{className:"shrink-0 text-amber-500",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-bold text-amber-800 dark:text-amber-400",children:"AtenÃ§Ã£o"}),e.jsxs("p",{className:"text-sm text-amber-700 dark:text-amber-300 mt-1",children:["Se este RM nÃ£o for encontrado, seu acesso serÃ¡ ",e.jsx("strong",{children:"automaticamente bloqueado"})," para anÃ¡lise da administraÃ§Ã£o."]})]})]}),e.jsx("p",{className:"text-center text-sm text-gray-600 dark:text-gray-400",children:"Verifique se o nÃºmero estÃ¡ correto antes de prosseguir."}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>v(!1),className:"flex-1 py-3 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-700 dark:text-gray-300 font-medium hover:bg-gray-50 dark:hover:bg-gray-700",children:"Corrigir"}),e.jsx("button",{onClick:C,className:"flex-1 py-3 bg-primary hover:bg-indigo-700 text-white rounded-lg font-bold shadow-md",children:"Confirmar"})]})]})})]})},ws=()=>{const{logout:o}=re(),t=fe(),s=async()=>{await o(),t("/login",{replace:!0})};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-darkbg px-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-darkcard shadow-xl rounded-2xl p-8 text-center border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"mx-auto flex items-center justify-center h-20 w-20 rounded-full bg-red-100 dark:bg-red-900/30 mb-6",children:e.jsx("svg",{className:"h-10 w-10 text-red-600 dark:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 00-2-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Acesso Bloqueado"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Seu RM nÃ£o foi encontrado na base de alunos autorizados ou seu acesso estÃ¡ pendente de aprovaÃ§Ã£o."}),e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4 mb-8 text-sm text-amber-800 dark:text-amber-300 text-left",children:[e.jsx("p",{className:"font-bold mb-1",children:"O que fazer?"}),e.jsxs("ul",{className:"list-disc pl-4 space-y-1",children:[e.jsx("li",{children:"Verifique se digitou o RM correto."}),e.jsx("li",{children:"Aguarde a liberaÃ§Ã£o de um administrador."}),e.jsx("li",{children:"Entre em contato com a secretaria do curso."})]})]}),e.jsx("button",{onClick:s,className:"w-full bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-800 dark:text-gray-200 font-bold py-3 px-4 rounded-xl transition-colors",children:"Sair e Tentar Novamente"})]})})},js=({currentPage:o,totalItems:t,itemsPerPage:s,onPageChange:r})=>{const a=Math.ceil(t/s);if(a<=1)return null;const n=()=>{const i=[];if(a<=7)for(let d=1;d<=a;d++)i.push(d);else o<=4?i.push(1,2,3,4,5,"...",a):o>=a-3?i.push(1,"...",a-4,a-3,a-2,a-1,a):i.push(1,"...",o-1,o,o+1,"...",a);return i};return e.jsxs("div",{className:"flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 mt-4 rounded-lg shadow-sm",children:[e.jsxs("div",{className:"flex flex-1 justify-between sm:hidden",children:[e.jsx("button",{onClick:()=>r(Math.max(1,o-1)),disabled:o===1,className:"relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"Anterior"}),e.jsx("button",{onClick:()=>r(Math.min(a,o+1)),disabled:o===a,className:"relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 disabled:opacity-50",children:"PrÃ³ximo"})]}),e.jsxs("div",{className:"hidden sm:flex sm:flex-1 sm:items-center sm:justify-between",children:[e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-700",children:["Mostrando ",e.jsx("span",{className:"font-medium",children:(o-1)*s+1})," a ",e.jsx("span",{className:"font-medium",children:Math.min(o*s,t)})," de ",e.jsx("span",{className:"font-medium",children:t})," resultados"]})}),e.jsx("div",{children:e.jsxs("nav",{className:"isolate inline-flex -space-x-px rounded-md shadow-sm","aria-label":"Pagination",children:[e.jsxs("button",{onClick:()=>r(Math.max(1,o-1)),disabled:o===1,className:"relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50",children:[e.jsx("span",{className:"sr-only",children:"Anterior"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z",clipRule:"evenodd"})})]}),n().map((i,d)=>typeof i=="number"?e.jsx("button",{onClick:()=>r(i),"aria-current":o===i?"page":void 0,className:`relative inline-flex items-center px-4 py-2 text-sm font-semibold ${o===i?"z-10 bg-primary text-white focus:z-20 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600":"text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0"}`,children:i},d):e.jsx("span",{className:"relative inline-flex items-center px-4 py-2 text-sm font-semibold text-gray-700 ring-1 ring-inset ring-gray-300 focus:outline-offset-0",children:"..."},d)),e.jsxs("button",{onClick:()=>r(Math.min(a,o+1)),disabled:o===a,className:"relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0 disabled:opacity-50",children:[e.jsx("span",{className:"sr-only",children:"PrÃ³ximo"}),e.jsx("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z",clipRule:"evenodd"})})]})]})})]})]})},ht=(o,t)=>{const[s,r]=b.useState(null),[a,n]=b.useState(!1),{addToast:i}=ke(),d=b.useCallback(()=>{r(null)},[]),l=b.useCallback(async(m,g)=>{if(o){d(),n(!0);try{await _.createEnrollment(o.uid,m.id,g),i("success",`InscriÃ§Ã£o confirmada em ${m.name}!`),setTimeout(()=>t(),500)}catch(f){const x=f.message||"";if(x.startsWith("CONFLICT|")){const[y,p,E,I]=x.split("|");r({name:p,time:`${E} - ${I}`}),i("warning","Conflito de horÃ¡rio detectado.")}else{const y=Te(f);i("error",y)}}finally{n(!1)}}},[o,t,d,i]),c=b.useCallback(async m=>{if(o){n(!0);try{await _.cancelEnrollment(m),i("success","InscriÃ§Ã£o cancelada com sucesso."),setTimeout(()=>t(),500)}catch(g){i("error","Erro ao cancelar inscriÃ§Ã£o."),console.error(g)}finally{n(!1)}}},[o,t,i]);return{handleEnroll:l,handleCancel:c,isProcessing:a,isEnrolling:a,conflictData:s,clearState:d}};function ks(o,t=300){const[s,r]=b.useState(o);return b.useEffect(()=>{const a=setTimeout(()=>{r(o)},t);return()=>{clearTimeout(a)}},[o,t]),s}const Ns=o=>{const[t,s]=b.useState([]),[r,a]=b.useState([]),[n,i]=b.useState(!0),[d,l]=b.useState(""),[c,m]=b.useState(""),[g,f]=b.useState(!1),[x,y]=b.useState(1),p=9,E=ks(d,300),I=b.useCallback(async(S=!0)=>{if(o){S&&i(!0);try{const[A,C]=await Promise.all([_.getAvailableEventsForUser(o),_.getEnrollmentsForUser(o.uid)]);s(A),a(C)}catch(A){console.error(A)}finally{S&&i(!1)}}},[o]);b.useEffect(()=>{I()},[I]);const v=b.useMemo(()=>{const S=new Set;return t.forEach(A=>{A.parentId&&S.add(A.parentId)}),S},[t]),w=b.useMemo(()=>{const S=new Date().toISOString().split("T")[0];return t.filter(A=>{if(A.parentId)return!1;const C=A.name.toLowerCase().includes(E.toLowerCase())||A.description.toLowerCase().includes(E.toLowerCase()),R=t.filter(D=>D.parentId===A.id),O=[...A.sessions,...R.flatMap(D=>D.sessions)],T=c?O.some(D=>D.date===c):!0,L=g||O.some(D=>D.date>=S);return C&&T&&L})},[t,E,c,g]);b.useEffect(()=>{y(1)},[E,c,g]);const k=b.useMemo(()=>{const S=(x-1)*p;return w.slice(S,S+p)},[w,x]),N=(S,A)=>r.find(C=>C.eventId===S&&C.sessionId===A);return{events:t,filteredEvents:w,paginatedEvents:k,parentIds:v,loading:n,filters:{searchTerm:d,setSearchTerm:l,filterDate:c,setFilterDate:m,showPastEvents:g,setShowPastEvents:f},pagination:{currentPage:x,setCurrentPage:y,totalItems:w.length,itemsPerPage:p},helpers:{getEnrollment:N},refresh:()=>I(!1)}},Ss=()=>e.jsx("li",{className:"px-6 py-4 animate-pulse",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/5"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/5"})]}),e.jsx("div",{className:"h-8 bg-gray-200 rounded w-24"})]})}),Es=()=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 flex flex-col h-full animate-pulse",children:[e.jsxs("div",{className:"p-5 flex-1 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded-full w-1/3"})]}),e.jsx("div",{className:"h-5 bg-gray-200 rounded w-4/5 mb-2"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-5/6"})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/3"})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"h-2 bg-gray-200 rounded-full"})})]}),e.jsx("div",{className:"w-full h-12 bg-gray-100 border-t border-gray-200"})]}),tr=()=>e.jsxs("tr",{className:"animate-pulse",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200"}),e.jsxs("div",{className:"ml-4 space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-32"})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-20"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded w-12"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"h-5 bg-gray-200 rounded-full w-16"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:e.jsx("div",{className:"h-5 bg-gray-200 rounded w-36 inline-block"})})]}),sr=()=>e.jsxs("div",{className:"bg-white shadow rounded-lg p-4 flex flex-col space-y-3 animate-pulse",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-200"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-32"})]})]}),e.jsx("div",{className:"h-5 bg-gray-200 rounded-full w-16"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 border-t border-b border-gray-100 py-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-2 bg-gray-200 rounded w-10"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-20"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"h-2 bg-gray-200 rounded w-10"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})]})]}),e.jsx("div",{className:"flex justify-end pt-1",children:e.jsx("div",{className:"h-6 bg-gray-200 rounded w-48"})})]}),ft=({icon:o,title:t,description:s,action:r})=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4 text-center bg-white dark:bg-darkcard rounded-lg border-2 border-dashed border-gray-200 dark:border-gray-700 transition-colors duration-200",children:[e.jsx("div",{className:"text-5xl text-gray-300 dark:text-gray-600 mb-4 transition-colors duration-200",children:o||"ðŸ“­"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-1",children:t}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-sm mb-6",children:s}),r&&e.jsx("button",{onClick:r.onClick,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-primary dark:text-indigo-300 bg-indigo-50 dark:bg-indigo-900/30 hover:bg-indigo-100 dark:hover:bg-indigo-900/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors duration-200",children:r.label})]}),Ge=({isOpen:o,onClose:t,onConfirm:s,title:r,message:a,confirmText:n="Confirmar",cancelText:i="Cancelar",isProcessing:d=!1,variant:l="danger"})=>e.jsx(le,{isOpen:o,onClose:()=>!d&&t(),title:r,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-gray-700",children:a}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:t,disabled:d,className:"px-4 py-2 bg-gray-100 rounded-md hover:bg-gray-200 text-gray-800 text-sm font-medium disabled:opacity-50",children:i}),e.jsx(de,{onClick:s,isLoading:d,variant:l,children:n})]})]})}),Cs=({isOpen:o,onClose:t})=>{const[s,r]=b.useState(0),[a,n]=b.useState(!1);if(!o)return null;const i=[{title:"Bem-vindo ao EduEvent! ðŸŽ“",description:"Sua nova central para descobrir, gerenciar e participar dos melhores eventos acadÃªmicos e escolares da sua instituiÃ§Ã£o.",color:"bg-indigo-500",image:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",className:"w-32 h-32 text-indigo-600 dark:text-indigo-400",children:[e.jsx("path",{d:"M22 10v6M2 10l10-5 10 5-10 5z"}),e.jsx("path",{d:"M6 12v5c3 3 9 3 12 0v-5"})]})},{title:"Explore Eventos IncrÃ­veis ðŸŒ",description:"Navegue pelo Dashboard para encontrar eventos. Use os filtros inteligentes para buscar por data, nome ou ver apenas o que Ã© relevante para seu curso.",color:"bg-emerald-500",image:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",className:"w-32 h-32 text-emerald-600 dark:text-emerald-400",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}),e.jsx("path",{d:"M11 8v6M8 11h6"})]})},{title:"InscriÃ§Ã£o em 1 Clique ðŸ‘†",description:"Gostou de um evento? Clique em 'Garantir Vaga' ou 'Inscrever'. O sistema verifica conflitos de horÃ¡rio automaticamente para vocÃª.",color:"bg-amber-500",image:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",className:"w-32 h-32 text-amber-600 dark:text-amber-400",children:[e.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e.jsx("polyline",{points:"14 2 14 8 20 8"}),e.jsx("path",{d:"M9 15l2 2 4-4"})]})},{title:"Sua Agenda Organizada ðŸ“…",description:"Acesse 'Minhas InscriÃ§Ãµes' para ver todos os seus compromissos confirmados. VocÃª pode cancelar inscriÃ§Ãµes se mudar de ideia.",color:"bg-purple-500",image:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",className:"w-32 h-32 text-purple-600 dark:text-purple-400",children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"}),e.jsx("path",{d:"M8 14h.01"}),e.jsx("path",{d:"M12 14h.01"}),e.jsx("path",{d:"M16 14h.01"}),e.jsx("path",{d:"M8 18h.01"}),e.jsx("path",{d:"M12 18h.01"}),e.jsx("path",{d:"M16 18h.01"})]})},{title:"Tudo Pronto! ðŸš€",description:"VocÃª jÃ¡ sabe o bÃ¡sico. Agora Ã© com vocÃª! Explore, aprenda e aproveite ao mÃ¡ximo os eventos da sua escola.",color:"bg-primary",image:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",className:"w-32 h-32 text-primary dark:text-indigo-400",children:[e.jsx("path",{d:"M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"}),e.jsx("path",{d:"m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"}),e.jsx("path",{d:"M9 12H4s.55-3.03 2-4c1.62-1.08 5 0 5 0"}),e.jsx("path",{d:"M12 15v5s3.03-.55 4-2c1.08-1.62 0-5 0-5"})]})}],d=()=>{s<i.length-1?(n(!0),setTimeout(()=>{r(m=>m+1),n(!1)},300)):t()},l=()=>{t()},c=i[s];return e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-gray-900/60 backdrop-blur-sm transition-opacity",onClick:l}),e.jsxs("div",{className:"relative bg-white dark:bg-darkcard w-full max-w-md rounded-2xl shadow-2xl overflow-hidden flex flex-col min-h-[500px] animate-fade-in border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:`h-2 w-full ${c.color} transition-colors duration-500`}),e.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-8 text-center",children:[e.jsx("div",{className:`mb-8 p-6 bg-gray-50 dark:bg-gray-800 rounded-full transition-all duration-300 transform ${a?"opacity-0 scale-90 translate-x-4":"opacity-100 scale-100 translate-x-0"}`,children:c.image}),e.jsxs("div",{className:`transition-all duration-300 ${a?"opacity-0 translate-y-4":"opacity-100 translate-y-0"}`,children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-3",children:c.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 leading-relaxed",children:c.description})]})]}),e.jsxs("div",{className:"p-6 bg-gray-50 dark:bg-gray-800/50 border-t border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"flex justify-center space-x-2 mb-6",children:i.map((m,g)=>e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${g===s?`w-6 ${c.color}`:"w-2 bg-gray-300 dark:bg-gray-600"}`},g))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:l,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 font-medium text-sm px-4 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:"Pular Tutorial"}),e.jsxs("button",{onClick:d,className:`px-6 py-2.5 rounded-xl text-white font-bold shadow-lg shadow-indigo-500/20 transform transition active:scale-95 flex items-center ${c.color} hover:brightness-110`,children:[s===i.length-1?"ComeÃ§ar Agora":"PrÃ³ximo",s<i.length-1&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]})]})]})},Is=ne.memo(({event:o,hasChildren:t,onAction:s})=>{const r=!t&&o.sessions.length===1?o.sessions[0]:null,a=r?r.capacity:0,n=r?r.filled:0,i=a>0?n/a*100:0,d=a>0&&n>=a,c=o.registrationLocked&&!t;let m="bg-indigo-500",g="PÃºblico";return o.visibility==="course"&&(m="bg-emerald-500",g="Meu Curso"),o.visibility==="class"&&(m="bg-purple-500",g="Minha Turma"),e.jsxs("div",{className:"group bg-white dark:bg-darkcard rounded-xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 dark:border-gray-700 flex flex-col h-full relative animate-fade-in hover:-translate-y-1",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1.5 h-full ${c?"bg-red-500":m} opacity-80`}),e.jsxs("div",{className:"p-5 flex-1 flex flex-col ml-2",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx("span",{className:`text-[10px] uppercase tracking-wider font-bold px-2 py-1 rounded-md ${m} bg-opacity-10 dark:bg-opacity-20 text-gray-700 dark:text-gray-200`,children:g}),o.isTeamEvent&&e.jsxs("span",{className:"text-[10px] uppercase tracking-wider font-bold px-2 py-1 rounded-md bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 border border-purple-200 dark:border-purple-800 flex items-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z"})}),"Equipe"]})]}),c?e.jsx("span",{className:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 text-xs px-2 py-1 rounded-full font-bold flex items-center border border-red-200 dark:border-red-900",children:"ðŸ”’ Fechado"}):t?e.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 text-xs px-2 py-1 rounded-full font-medium border border-gray-200 dark:border-gray-600",children:"Evento Principal"}):d&&r?e.jsxs("span",{className:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 text-xs px-2 py-1 rounded-full font-bold flex items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-red-500 rounded-full mr-1.5"}),"Esgotado"]}):e.jsxs("span",{className:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300 text-xs px-2 py-1 rounded-full font-bold flex items-center",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-green-500 rounded-full mr-1.5"}),"Aberto"]})]}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white leading-tight mb-2 group-hover:text-primary dark:group-hover:text-indigo-400 transition-colors",children:o.name}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm line-clamp-2 mb-4 flex-1",children:o.description}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-300 mt-auto",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 flex justify-center text-gray-400 dark:text-gray-500 mr-2",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),e.jsx("span",{className:"font-medium",children:o.location})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 flex justify-center text-gray-400 dark:text-gray-500 mr-2",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("span",{className:"font-medium",children:t?"Ver programaÃ§Ã£o completa":o.sessions.length>1?`${o.sessions.length} horÃ¡rios disponÃ­veis`:`${Z(r==null?void 0:r.date)} â€¢ ${r==null?void 0:r.startTime}`})]})]}),!t&&r&&!c&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs mb-1 font-medium",children:[e.jsx("span",{className:d?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400",children:d?"Sem vagas":o.isTeamEvent?`${a-n} equipes restantes`:`${a-n} vagas restantes`}),e.jsxs("span",{className:"text-gray-400 dark:text-gray-500",children:[Math.round(i),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-100 dark:bg-gray-700 rounded-full h-1.5 overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all duration-500 ${d?"bg-red-500":i>80?"bg-amber-400":"bg-emerald-500"}`,style:{width:`${i}%`}})})]})]}),e.jsxs("button",{onClick:()=>(!c||t)&&s(o),disabled:c,className:`w-full py-3 text-sm font-bold border-t border-indigo-100 dark:border-gray-700 flex justify-center items-center transition-colors
                    ${c?"bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-500 cursor-not-allowed":"text-primary dark:text-indigo-300 bg-indigo-50 dark:bg-gray-800/50 hover:bg-primary hover:text-white dark:hover:bg-indigo-600 dark:hover:text-white"}`,children:[c?"InscriÃ§Ãµes Encerradas":t||o.isTeamEvent?"Ver Detalhes":"Ver Detalhes e Inscrever",!c&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})}),Ts=({searchTerm:o,onSearchChange:t,filterDate:s,onDateChange:r,showPastEvents:a,onTogglePast:n})=>e.jsxs("div",{className:"bg-white dark:bg-darkcard p-5 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 flex flex-col lg:flex-row gap-4 items-end transition-colors duration-200",children:[e.jsxs("div",{className:"flex-1 w-full",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1 uppercase tracking-wider",children:"Buscar Evento"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:"h-5 w-5 text-gray-400 dark:text-gray-500",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",children:e.jsx("path",{fillRule:"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z",clipRule:"evenodd"})})}),e.jsx("input",{type:"text",placeholder:"Nome, descriÃ§Ã£o, local...",className:"pl-10 w-full border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-primary focus:border-primary sm:text-sm bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white py-2.5 transition-colors",value:o,onChange:i=>t(i.target.value)})]})]}),e.jsxs("div",{className:"w-full lg:w-48",children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1 uppercase tracking-wider",children:"Data EspecÃ­fica"}),e.jsx("input",{type:"date",className:"w-full border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-primary focus:border-primary sm:text-sm bg-gray-50 dark:bg-gray-800 text-gray-900 dark:text-white py-2.5 transition-colors",value:s,onChange:i=>r(i.target.value)})]}),e.jsx("div",{className:"w-full lg:w-auto pb-2",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsxs("div",{className:"relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in",children:[e.jsx("input",{type:"checkbox",className:"toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer",checked:a,onChange:i=>n(i.target.checked),style:{right:a?"0":"auto",left:a?"auto":"0",borderColor:a?"#4F46E5":"#E5E7EB"}}),e.jsx("label",{className:`toggle-label block overflow-hidden h-6 rounded-full cursor-pointer ${a?"bg-primary":"bg-gray-300 dark:bg-gray-600"}`})]}),e.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Mostrar Passados"})]})})]}),As=()=>{const{user:o}=re(),t=fe(),{events:s,paginatedEvents:r,parentIds:a,loading:n,filters:i,pagination:d,helpers:l,refresh:c}=Ns(o),[m,g]=b.useState(null),[f,x]=b.useState(null),[y,p]=b.useState(!1);b.useEffect(()=>{if(!localStorage.getItem("eduevent_tutorial_completed")){const R=setTimeout(()=>p(!0),1e3);return()=>clearTimeout(R)}},[]);const E=()=>{p(!1),localStorage.setItem("eduevent_tutorial_completed","true")},I=b.useCallback(()=>{c(),x(null)},[c]),{handleEnroll:v,handleCancel:w,isProcessing:k,conflictData:N,clearState:S}=ht(o,I);b.useEffect(()=>{if(m){const C=s.find(R=>R.id===m.id);C&&JSON.stringify(C)!==JSON.stringify(m)&&g(C)}},[s,m]);const A=b.useCallback(C=>{a.has(C.id)||C.isTeamEvent?t(`/event/${C.id}`):(S(),g(C))},[a,t,S]);return e.jsxs("div",{className:"space-y-8 animate-fade-in relative",children:[e.jsx(Cs,{isOpen:y,onClose:E}),e.jsx("header",{className:"flex flex-col md:flex-row md:justify-between md:items-end gap-4",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-extrabold text-gray-900 dark:text-white tracking-tight",children:"Dashboard de Eventos"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-1",children:"Explore e inscreva-se nas atividades disponÃ­veis para seu perfil."})]})}),e.jsx(Ts,{searchTerm:i.searchTerm,onSearchChange:i.setSearchTerm,filterDate:i.filterDate,onDateChange:i.setFilterDate,showPastEvents:i.showPastEvents,onTogglePast:i.setShowPastEvents}),n?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:6}).map((C,R)=>e.jsx(Es,{},R))}):r.length===0?e.jsx(ft,{title:"Nenhum evento encontrado",description:s.length===0?"NÃ£o hÃ¡ eventos disponÃ­veis para o seu curso ou turma no momento.":i.showPastEvents?"Nenhum evento corresponde aos filtros de busca.":"NÃ£o hÃ¡ eventos futuros correspondentes. Tente ativar 'Mostrar Passados'.",action:!i.showPastEvents&&s.length>0?{label:"Ver histÃ³rico de eventos",onClick:()=>i.setShowPastEvents(!0)}:void 0}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(C=>e.jsx(Is,{event:C,hasChildren:a.has(C.id),onAction:A},C.id))}),e.jsx(js,{currentPage:d.currentPage,totalItems:d.totalItems,itemsPerPage:d.itemsPerPage,onPageChange:d.setCurrentPage})]}),e.jsx(le,{isOpen:!!m,onClose:()=>g(null),title:m?m.name:"",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:m==null?void 0:m.description}),(m==null?void 0:m.registrationLocked)&&e.jsx("div",{className:"mt-2 p-2 bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200 text-sm font-bold rounded border border-red-200 dark:border-red-800 text-center",children:"âš ï¸ InscriÃ§Ãµes encerradas/bloqueadas para este evento."})]}),N&&e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/30 border-l-4 border-amber-400 p-4 rounded-r-md animate-slide-in",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-amber-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-bold text-amber-800 dark:text-amber-300",children:"Conflito de HorÃ¡rio"}),e.jsxs("div",{className:"mt-2 text-sm text-amber-700 dark:text-amber-200",children:[e.jsx("p",{className:"mb-2",children:"VocÃª jÃ¡ possui compromisso neste horÃ¡rio:"}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 bg-opacity-50 p-2 rounded border border-amber-200 dark:border-amber-700",children:[e.jsx("p",{className:"font-semibold",children:N.name}),e.jsx("p",{className:"text-xs",children:N.time})]})]})]})]})}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx("span",{className:"bg-primary h-6 w-1 rounded mr-2"}),"Selecione uma SessÃ£o"]}),e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto pr-1",children:m==null?void 0:m.sessions.map(C=>{const R=l.getEnrollment(m.id,C.id),O=!!R,T=C.filled>=C.capacity,L=C.filled/C.capacity*100,D=C.date<new Date().toISOString().split("T")[0],G=m.registrationLocked;return e.jsx("div",{className:`relative border rounded-lg p-4 transition-all duration-200 
                                ${O?"border-green-500 bg-green-50 dark:bg-green-900/20 ring-1 ring-green-500":T||D||G?"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 opacity-70":"border-gray-200 dark:border-gray-700 hover:border-primary hover:shadow-md bg-white dark:bg-darkcard"}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-gray-900 dark:text-white text-lg",children:Z(C.date)}),O&&e.jsx("span",{className:"bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200 text-[10px] font-bold px-2 py-0.5 rounded-full uppercase",children:"Inscrito"}),D&&!O&&e.jsx("span",{className:"bg-gray-200 dark:bg-gray-600 text-gray-600 dark:text-gray-300 text-[10px] font-bold px-2 py-0.5 rounded-full uppercase",children:"Encerrado"})]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 flex items-center gap-4",children:e.jsxs("span",{className:"flex items-center",children:["ðŸ•’ ",C.startTime," - ",C.endTime]})}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${T?"bg-red-500":L>80?"bg-amber-400":"bg-emerald-500"}`,style:{width:`${Math.min(L,100)}%`}})}),e.jsx("span",{className:`text-xs font-bold w-24 text-right ${T?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:T?"ESGOTADO":m.isTeamEvent?`${C.capacity-C.filled} equipes`:`${C.capacity-C.filled} vagas`})]})]}),e.jsx("div",{className:"flex items-center",children:O?e.jsx("button",{onClick:()=>R&&x(R.id),className:"w-full sm:w-auto bg-white dark:bg-gray-800 border border-red-300 text-red-600 dark:text-red-400 font-bold py-2 px-4 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/30 transition-colors text-sm",children:"Cancelar"}):e.jsx(de,{onClick:()=>m&&v(m,C.id),isLoading:k,disabled:T||D||G,className:`w-full sm:w-auto ${T||D||G?"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed hover:bg-gray-300":""}`,children:G?"Bloqueado":D?"Encerrado":T?"Lotado":"Garantir Vaga"})})]})},C.id)})})]})]})}),e.jsx(Ge,{isOpen:!!f,onClose:()=>x(null),onConfirm:()=>f&&w(f),title:"Cancelar InscriÃ§Ã£o",message:"Tem certeza que deseja cancelar sua inscriÃ§Ã£o? A vaga serÃ¡ liberada imediatamente.",confirmText:"Sim, Cancelar",isProcessing:k})]})},Ms=()=>{const[o,t]=b.useState([]),[s,r]=b.useState([]),[a,n]=b.useState(!0);return b.useEffect(()=>{(async()=>{n(!0);const d=await _.getPublicEvents(),l=d.filter(m=>m.hasDedicatedPage).slice(0,3),c=d.filter(m=>!m.hasDedicatedPage).slice(0,8);t(l),r(c),n(!1)})()},[]),e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-darkbg flex flex-col font-sans transition-colors duration-300",children:[e.jsx("nav",{className:"bg-white/80 dark:bg-darkcard/80 backdrop-blur-md border-b border-gray-100 dark:border-gray-700 sticky top-0 z-50 transition-colors",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-20 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"bg-primary/10 dark:bg-primary/20 p-2 rounded-lg",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-primary dark:text-indigo-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("span",{className:"text-gray-900 dark:text-white font-extrabold text-2xl tracking-tight",children:"EduEvent"})]}),e.jsx("div",{className:"flex items-center space-x-4",children:e.jsx($,{to:"/login",className:"text-gray-500 dark:text-gray-300 hover:text-primary dark:hover:text-indigo-400 font-medium px-3 py-2 transition-colors",children:"Acessar Painel"})})]})})}),e.jsxs("main",{className:"flex-1 max-w-7xl w-full mx-auto px-4 sm:px-6 lg:px-8 py-12 space-y-16",children:[o.length>0&&e.jsxs("section",{className:"animate-fade-in",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-3xl font-extrabold text-gray-900 dark:text-white",children:"Eventos em Destaque"}),e.jsx("p",{className:"mt-2 text-gray-500 dark:text-gray-400",children:"Confira as pÃ¡ginas exclusivas dos nossos principais eventos."})]}),e.jsx("div",{className:"grid gap-8 lg:grid-cols-2",children:o.map(i=>{var d,l,c,m,g;return e.jsxs($,{to:`/special/${i.id}`,className:"group relative bg-white dark:bg-darkcard rounded-2xl shadow-md hover:shadow-2xl transition-all duration-300 overflow-hidden flex flex-col min-h-[300px] border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 to-transparent dark:from-primary/20 opacity-50"}),((c=(l=(d=i.dedicatedPageConfig)==null?void 0:d.gallery)==null?void 0:l[0])==null?void 0:c.url)&&e.jsxs("div",{className:"h-48 w-full overflow-hidden relative",children:[e.jsx("img",{src:i.dedicatedPageConfig.gallery[0].url,alt:i.name,className:"w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-black/20 group-hover:bg-black/10 transition-colors"})]}),e.jsxs("div",{className:"p-8 relative z-10 flex flex-col flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-amber-100 text-amber-800 dark:bg-amber-900/30 dark:text-amber-300 uppercase tracking-wide",children:"â­ Especial"}),e.jsx("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:Z((m=i.sessions[0])==null?void 0:m.date)})]}),e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2 group-hover:text-primary dark:group-hover:text-indigo-400 transition-colors",children:i.name}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 line-clamp-2 mb-6",children:((g=i.dedicatedPageConfig)==null?void 0:g.presentationText)||i.description}),e.jsxs("div",{className:"mt-auto flex items-center font-bold text-primary dark:text-indigo-400 group-hover:translate-x-1 transition-transform",children:["Ver PÃ¡gina Exclusiva ",e.jsx("span",{className:"ml-2",children:"â†’"})]})]})]},i.id)})})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"mb-6 flex items-end justify-between border-b border-gray-200 dark:border-gray-700 pb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Agenda PÃºblica"}),e.jsx("p",{className:"mt-1 text-gray-500 dark:text-gray-400",children:"PrÃ³ximas atividades abertas Ã  comunidade."})]}),e.jsx($,{to:"/login",className:"hidden sm:block text-primary dark:text-indigo-400 hover:text-indigo-600 font-medium text-sm",children:"Ver todos no painel â†’"})]}),a?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(i=>e.jsx("div",{className:"bg-white dark:bg-darkcard h-40 rounded-xl animate-pulse"},i))}):s.length===0?e.jsx("div",{className:"text-center py-16 bg-white dark:bg-darkcard rounded-xl border border-dashed border-gray-300 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-400",children:"Nenhum outro evento pÃºblico agendado no momento."})}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:s.map(i=>{var m,g;const d=(m=i.sessions[0])!=null&&m.date?new Date(i.sessions[0].date):new Date,l=d.getDate(),c=d.toLocaleString("pt-BR",{month:"short"}).toUpperCase();return e.jsxs("div",{className:"bg-white dark:bg-darkcard rounded-xl shadow-sm hover:shadow-md transition-shadow p-5 border border-gray-100 dark:border-gray-700 flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 rounded-lg p-2 text-center min-w-[50px]",children:[e.jsx("span",{className:"block text-xs font-bold",children:c}),e.jsx("span",{className:"block text-lg font-extrabold leading-none",children:l})]}),e.jsx($,{to:"/login",className:"bg-primary/10 text-primary hover:bg-primary hover:text-white dark:text-indigo-400 dark:hover:bg-indigo-600 dark:hover:text-white px-3 py-1 rounded-full text-xs font-bold transition-colors",children:"Inscrever"})]}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2 line-clamp-2",children:i.name}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm line-clamp-2 mb-4 flex-1",children:i.description}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-gray-500 flex items-center",children:[e.jsxs("span",{className:"mr-2",children:["ðŸ“ ",i.location]}),e.jsxs("span",{children:["ðŸ•’ ",(g=i.sessions[0])==null?void 0:g.startTime]})]})]},i.id)})})]})]}),e.jsx("footer",{className:"bg-white dark:bg-darkcard border-t border-gray-200 dark:border-gray-700 mt-auto",children:e.jsxs("div",{className:"max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Â© 2024 EduEvent. Todos os direitos reservados."}),e.jsxs("div",{className:"flex space-x-6 mt-4 md:mt-0",children:[e.jsx("a",{href:"#",className:"text-gray-400 hover:text-gray-500",children:"Contato"}),e.jsx("a",{href:"#",className:"text-gray-400 hover:text-gray-500",children:"Privacidade"}),e.jsx($,{to:"/login",className:"text-gray-400 hover:text-primary",children:"Ãrea do Aluno"})]})]})})]})},Rs=()=>{var y,p,E,I,v,w,k;const{id:o}=it(),[t,s]=b.useState(null),[r,a]=b.useState([]),[n,i]=b.useState(!0),[d,l]=b.useState("about");b.useEffect(()=>{(async()=>{if(o)try{const[S,A]=await Promise.all([_.getEventById(o),_.getEventsByParentId(o)]);s(S||null),a(A)}catch(S){console.error("Failed to load dedicated page data",S)}finally{i(!1)}})()},[o]);const c=b.useMemo(()=>{var O,T;if(!t)return[];const N=((O=t.dedicatedPageConfig)==null?void 0:O.schedule)||[],S=[];r.forEach(L=>{L.sessions.forEach(D=>{S.push({id:`sub_${L.id}_${D.id}`,time:D.startTime,title:L.name,description:`${L.description||""} â€¢ Local: ${L.location||"NÃ£o informado"}`,dateLabel:st(D.date)})})});const A=(T=t.sessions[0])!=null&&T.date?st(t.sessions[0].date):"";return[...N.map(L=>({...L,dateLabel:L.id.startsWith("sub_")?void 0:A})),...S].sort((L,D)=>L.dateLabel!==D.dateLabel?(L.dateLabel||"").localeCompare(D.dateLabel||""):L.time.localeCompare(D.time))},[t,r]),m=b.useMemo(()=>{const N={};return c.forEach(S=>{const A=S.dateLabel||"Data a definir";N[A]||(N[A]=[]),N[A].push(S)}),N},[c]);if(n)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-darkbg text-gray-500",children:"Carregando evento..."});if(!t||!t.hasDedicatedPage)return e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-darkbg px-4 text-center",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-800 dark:text-white mb-4",children:"PÃ¡gina nÃ£o encontrada"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-8",children:"Este evento nÃ£o possui uma pÃ¡gina dedicada ou nÃ£o existe."}),e.jsx($,{to:"/",className:"text-primary hover:underline",children:"Voltar para Home"})]});const g=t.dedicatedPageConfig||{gallery:[]},f=g.themeColor||"#4F46E5",x={"--theme-color":f};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-darkbg text-gray-900 dark:text-gray-100 font-sans selection:bg-opacity-30 selection:bg-[var(--theme-color)]",style:x,children:[e.jsxs("header",{className:"relative bg-darkbg text-white overflow-hidden min-h-[55vh] flex flex-col justify-end pb-12",children:[((p=(y=g.gallery)==null?void 0:y[0])==null?void 0:p.url)&&e.jsxs("div",{className:"absolute inset-0 z-0",children:[e.jsx("img",{src:g.gallery[0].url,alt:"Background",className:"w-full h-full object-cover opacity-40 blur-sm scale-105 transform origin-center animate-fade-in"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-darkbg via-darkbg/60 to-transparent"})]}),e.jsxs("div",{className:"relative z-10 max-w-7xl mx-auto px-6 w-full animate-slide-in",children:[e.jsxs($,{to:"/",className:"inline-flex items-center mb-8 text-white/70 hover:text-white transition-colors text-sm font-medium group",children:[e.jsx("span",{className:"mr-2 group-hover:-translate-x-1 transition-transform",children:"â†"})," Voltar para Eventos"]}),e.jsx("div",{className:"flex flex-col lg:flex-row lg:items-end lg:justify-between gap-6",children:e.jsxs("div",{className:"max-w-4xl",children:[e.jsx("span",{className:"inline-block py-1 px-3 rounded text-[10px] font-bold tracking-widest mb-4 uppercase text-white bg-[var(--theme-color)] shadow-lg shadow-[var(--theme-color)]/20",children:"Evento em Destaque"}),e.jsx("h1",{className:"text-4xl md:text-6xl lg:text-7xl font-extrabold tracking-tight mb-4 leading-tight text-white drop-shadow-sm",children:t.name}),e.jsx("p",{className:"text-lg md:text-xl text-white/80 font-light max-w-2xl leading-relaxed",children:t.description})]})})]})]}),e.jsx("div",{className:"sticky top-0 z-40 bg-white/90 dark:bg-darkcard/90 backdrop-blur-md shadow-sm border-b border-gray-200 dark:border-gray-700",children:e.jsx("div",{className:"max-w-7xl mx-auto px-6",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsx("nav",{className:"flex space-x-1 h-full overflow-x-auto no-scrollbar",children:["about","schedule","gallery"].map(N=>e.jsxs("button",{onClick:()=>l(N),className:`relative px-5 inline-flex items-center h-full text-xs font-bold uppercase tracking-widest transition-all whitespace-nowrap
                                        ${d===N?"text-[var(--theme-color)]":"text-gray-500 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200"}`,children:[N==="about"&&"VisÃ£o Geral",N==="schedule"&&"Cronograma",N==="gallery"&&"Galeria",d===N&&e.jsx("span",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-[var(--theme-color)] shadow-[0_0_10px_var(--theme-color)]"})]},N))}),e.jsx("div",{className:"hidden md:flex items-center pl-6 border-l border-gray-200 dark:border-gray-700",children:e.jsx($,{to:"/login",className:"inline-flex items-center justify-center px-6 py-2 rounded-full font-bold text-white text-sm shadow-lg transform transition hover:-translate-y-0.5 active:translate-y-0 hover:shadow-xl",style:{backgroundColor:f},children:"Garantir Vaga"})})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-6 py-12 animate-fade-in min-h-[40vh]",children:[d==="about"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-12",children:[e.jsxs("div",{className:"lg:col-span-8 space-y-12",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-3xl font-bold mb-6 text-gray-900 dark:text-white",children:"Sobre o Evento"}),e.jsx("div",{className:"prose dark:prose-invert prose-lg max-w-none text-gray-600 dark:text-gray-300 leading-relaxed",children:e.jsx("p",{className:"whitespace-pre-line",children:g.presentationText||"Junte-se a nÃ³s para uma experiÃªncia inesquecÃ­vel. Este evento foi cuidadosamente planejado para oferecer o melhor conteÃºdo e oportunidades de networking."})})]}),r.length>0&&e.jsxs("section",{className:"pt-8 border-t border-gray-100 dark:border-gray-800",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Destaques da ProgramaÃ§Ã£o"}),e.jsx("button",{onClick:()=>l("schedule"),className:"text-sm font-bold text-[var(--theme-color)] hover:underline hidden sm:block",children:"Ver tudo â†’"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:r.map(N=>e.jsxs("div",{className:"group relative bg-white dark:bg-darkcard rounded-2xl p-6 shadow-sm border border-gray-100 dark:border-gray-700 hover:shadow-xl hover:border-transparent transition-all duration-300 flex flex-col justify-between overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-[var(--theme-color)] to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("span",{className:"inline-block px-2 py-1 rounded bg-gray-50 dark:bg-gray-800 text-[10px] font-bold uppercase tracking-wider text-gray-500 dark:text-gray-400",children:"Atividade"}),e.jsx("span",{className:"text-[var(--theme-color)] opacity-0 group-hover:opacity-100 transform translate-x-2 group-hover:translate-x-0 transition-all duration-300",children:"â†—"})]}),e.jsx("h4",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2 leading-tight group-hover:text-[var(--theme-color)] transition-colors",children:N.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 line-clamp-3 mb-4 leading-relaxed",children:N.description})]}),e.jsxs("div",{className:"pt-4 border-t border-gray-50 dark:border-gray-800 flex items-center justify-between text-xs font-medium text-gray-400 dark:text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),N.sessions.length>0?N.sessions[0].startTime:"TBA"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("svg",{className:"w-4 h-4 mr-1.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),N.location]})]})]},N.id))})]})]}),e.jsx("div",{className:"lg:col-span-4 space-y-8",children:e.jsxs("div",{className:"bg-white dark:bg-darkcard rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-8 sticky top-24",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-6 pb-4 border-b border-gray-100 dark:border-gray-700",children:"InformaÃ§Ãµes do Evento"}),e.jsxs("ul",{className:"space-y-6",children:[e.jsxs("li",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gray-50 dark:bg-gray-800 flex items-center justify-center text-xl mr-4",children:"ðŸ“…"}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs font-bold uppercase text-gray-400 mb-0.5",children:"Data Principal"}),e.jsx("span",{className:"block text-gray-900 dark:text-white font-medium",children:Z((E=t.sessions[0])==null?void 0:E.date)})]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gray-50 dark:bg-gray-800 flex items-center justify-center text-xl mr-4",children:"ðŸ•’"}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs font-bold uppercase text-gray-400 mb-0.5",children:"HorÃ¡rio"}),e.jsxs("span",{className:"block text-gray-900 dark:text-white font-medium",children:[(I=t.sessions[0])==null?void 0:I.startTime," Ã s ",(v=t.sessions[0])==null?void 0:v.endTime]})]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gray-50 dark:bg-gray-800 flex items-center justify-center text-xl mr-4",children:"ðŸ“"}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs font-bold uppercase text-gray-400 mb-0.5",children:"LocalizaÃ§Ã£o"}),e.jsx("span",{className:"block text-gray-900 dark:text-white font-medium",children:t.location})]})]}),e.jsxs("li",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 w-10 h-10 rounded-full bg-gray-50 dark:bg-gray-800 flex items-center justify-center text-xl mr-4",children:"ðŸ‘¥"}),e.jsxs("div",{children:[e.jsx("span",{className:"block text-xs font-bold uppercase text-gray-400 mb-0.5",children:"Capacidade"}),e.jsxs("span",{className:"block text-gray-900 dark:text-white font-medium",children:[t.sessions.reduce((N,S)=>N+S.capacity,0)," vagas totais"]})]})]})]}),e.jsx("div",{className:"mt-8 pt-6 border-t border-gray-100 dark:border-gray-700",children:e.jsx($,{to:"/login",className:"w-full flex items-center justify-center px-4 py-3 rounded-xl font-bold text-white shadow-lg transition transform hover:scale-[1.02]",style:{backgroundColor:f},children:"Inscrever-se"})})]})})]}),d==="schedule"&&e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Cronograma Completo"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"Acompanhe todos os horÃ¡rios e atividades."})]}),Object.keys(m).length===0?e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-12 rounded-2xl text-center border-2 border-dashed border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-500",children:"ProgramaÃ§Ã£o detalhada em breve."})}):e.jsx("div",{className:"space-y-16",children:Object.entries(m).map(([N,S])=>{const A=S;return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"sticky top-20 z-20 bg-gray-50/95 dark:bg-darkbg/95 backdrop-blur-sm py-4 mb-8 border-b border-gray-200 dark:border-gray-700 flex items-center",children:[e.jsxs("span",{className:"px-3 py-1 rounded bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-sm font-bold shadow-sm mr-3",children:[N.split(",")[0]," "]}),e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[N.split(",")[1]," "]})]}),e.jsx("div",{className:"relative border-l-2 border-gray-200 dark:border-gray-800 ml-4 md:ml-6 space-y-12 pb-4",children:A.map((C,R)=>e.jsxs("div",{className:"relative pl-8 md:pl-12 group",children:[e.jsx("div",{className:"absolute -left-[9px] top-1.5 h-[18px] w-[18px] rounded-full border-4 border-white dark:border-darkbg shadow-sm transition-transform group-hover:scale-125",style:{backgroundColor:f}}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-baseline gap-2 md:gap-8 mb-2",children:[e.jsx("div",{className:"flex-shrink-0 w-20 pt-1",children:e.jsx("span",{className:"text-lg font-black text-gray-900 dark:text-white",children:C.time})}),e.jsxs("div",{className:"flex-1 bg-white dark:bg-darkcard p-5 rounded-xl border border-gray-100 dark:border-gray-800 shadow-sm group-hover:shadow-md transition-shadow",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-1 group-hover:text-[var(--theme-color)] transition-colors",children:C.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 leading-relaxed text-sm whitespace-pre-line",children:C.description})]})]})]},R))})]},N)})})]}),d==="gallery"&&e.jsxs("div",{children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:"Galeria de Fotos"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mt-2",children:"Momentos marcantes."})]}),((w=g.gallery)==null?void 0:w.length)===0?e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-12 rounded-2xl text-center border-2 border-dashed border-gray-200 dark:border-gray-700",children:e.jsx("p",{className:"text-gray-500",children:"Imagens indisponÃ­veis no momento."})}):e.jsx("div",{className:"columns-1 md:columns-2 lg:columns-3 gap-6 space-y-6",children:(k=g.gallery)==null?void 0:k.map((N,S)=>e.jsxs("div",{className:"break-inside-avoid group relative rounded-2xl overflow-hidden shadow-md cursor-zoom-in",children:[e.jsx("img",{src:N.url,alt:N.caption||`Imagem ${S+1}`,className:"w-full h-auto object-cover transition-transform duration-700 group-hover:scale-105"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end p-6",children:N.caption&&e.jsx("p",{className:"text-white font-medium transform translate-y-4 group-hover:translate-y-0 transition-transform duration-300",children:N.caption})})]},S))})]})]}),e.jsx("div",{className:"md:hidden fixed bottom-6 right-6 z-50 animate-bounce-slow",children:e.jsx($,{to:"/login",className:"flex items-center justify-center w-14 h-14 rounded-full text-white shadow-xl shadow-indigo-900/20 hover:scale-110 transition-transform",style:{backgroundColor:f},children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})})]})},Ls=(o,t)=>{const{addToast:s}=ke(),[r,a]=b.useState([]),[n,i]=b.useState(null),[d,l]=b.useState(!1),[c,m]=b.useState({}),[g,f]=b.useState({}),x=b.useRef(new Set),y=b.useCallback(async w=>{if(o){l(!0);try{const[k,N]=await Promise.all([_.getTeamsForEvent(w),_.getEnrollmentsForUser(o.uid)]);a(k),t&&t();const A=[...new Set(k.map(R=>R.captainId))].filter(R=>!x.current.has(R));if(A.length>0){const R={};await Promise.all(A.map(async O=>{try{const T=await _.getUserProfile(O);T&&(R[O]=T,x.current.add(O))}catch{console.error("Error fetching captain",O)}})),Object.keys(R).length>0&&m(O=>({...O,...R}))}const C=N.find(R=>R.eventId===w&&R.status===Y.CONFIRMED);if(C&&C.teamId){const R=k.find(O=>O.id===C.teamId);i(R||null)}else i(null)}catch(k){console.error(k)}finally{l(!1)}}},[o,t]);return b.useEffect(()=>{(async()=>{if(n&&n.members.length>0){const k={},N=n.members.filter(S=>!x.current.has(S));await Promise.all(N.map(async S=>{if(o&&o.uid===S){k[S]=o,x.current.add(S);return}try{const A=await _.getUserProfile(S);A&&(k[S]=A,x.current.add(S))}catch{console.error("Error fetching member",S)}})),Object.keys(k).length>0&&f(S=>({...S,...k}))}})()},[n,o]),{teams:r,myTeam:n,loading:d,captainProfiles:c,memberProfiles:g,loadTeams:y,createTeam:async(w,k)=>{if(!o)return null;l(!0);try{const N=await _.createTeam(w,k,o);return await y(w),N}catch(N){throw N}finally{l(!1)}},joinTeam:async w=>{if(o){l(!0);try{await _.joinTeam(w.id,o,w.code),await y(w.eventId)}catch(k){throw k}finally{l(!1)}}},leaveTeam:async()=>{if(!(!o||!n)){l(!0);try{const w=n.eventId;await _.leaveTeam(n.id,o.uid),await y(w)}catch(w){throw w}finally{l(!1)}}},kickMember:async w=>{if(n){l(!0);try{await _.kickMember(n.id,w),await y(n.eventId)}catch(k){throw k}finally{l(!1)}}}}},Ds=(o,t)=>{switch(t.type){case"CLOSE":return{type:"NONE"};case"OPEN_ENROLL":return{type:"ENROLL",data:t.payload};case"OPEN_TEAM_SUCCESS":return{type:"TEAM_SUCCESS",data:t.payload};case"OPEN_TEAM_INPUT":return{type:"TEAM_INPUT",data:t.payload};case"OPEN_TEAM_CONFIRM":return{type:"TEAM_CONFIRM",data:t.payload};default:return o}},_s=()=>{var Ke,Xe,Ze;const{id:o}=it(),[t,s]=Tt(),r=t.get("join_code"),{user:a}=re(),n=fe(),{addToast:i}=ke(),[d,l]=b.useState(null),[c,m]=b.useState([]),[g,f]=b.useState([]),[x,y]=b.useState([]),[p,E]=b.useState(!0),[I,v]=b.useState(null),[w,k]=b.useReducer(Ds,{type:"NONE"}),[N,S]=b.useState(""),[A,C]=b.useState("join"),R=b.useCallback(async(j=!0)=>{if(!(!o||!a)){j&&E(!0);try{const[M,P,J,se]=await Promise.all([_.getEventById(o),_.getEventsByParentId(o),_.getEnrollmentsForUser(a.uid),_.getClasses()]);if(!M){n("/dashboard");return}l(M),m(P),f(J),y(se)}catch(M){console.error(M)}finally{j&&E(!1)}}},[o,a,n]),O=b.useCallback(()=>{R(!1),v(null)},[R]),{handleEnroll:T,handleCancel:L,isProcessing:D,conflictData:G,clearState:Ne}=ht(a,O),{teams:Se,myTeam:ee,loading:Le,captainProfiles:be,memberProfiles:He,loadTeams:De,createTeam:bt,joinTeam:yt,leaveTeam:vt,kickMember:wt}=Ls(a,O);b.useEffect(()=>{R()},[R]),b.useEffect(()=>{if(w.type==="ENROLL"&&w.data){const M=[d,...c].filter(Boolean).find(P=>P.id===w.data.id);M&&JSON.stringify(M)!==JSON.stringify(w.data)&&k({type:"OPEN_ENROLL",payload:M})}},[d,c,w.type,w.data]),b.useEffect(()=>{if(r&&d&&!p){let j;d.isTeamEvent?j=d:j=c.find(M=>M.isTeamEvent),j&&w.type==="NONE"&&(k({type:"OPEN_ENROLL",payload:j}),C("join"),De(j.id))}},[r,d,c,p,De,w.type]),b.useEffect(()=>{if(r&&Se.length>0&&w.type==="ENROLL"){const j=Se.find(M=>M.code===r);j&&(g.some(P=>P.eventId===j.eventId&&P.teamId===j.id)||(k({type:"OPEN_TEAM_CONFIRM",payload:j}),s(P=>{const J=new URLSearchParams(P);return J.delete("join_code"),J},{replace:!0})))}},[r,Se,w.type,g,s]);const _e=j=>{var M;return j?((M=x.find(P=>P.id===j))==null?void 0:M.name)||"Desconhecida":"N/A"},Ee=async j=>{try{await navigator.clipboard.writeText(j),i("success","CÃ³digo copiado!")}catch{i("error","Erro ao copiar.")}},Je=async j=>{const M=window.location.href.split("#")[0],J=`${M.endsWith("/")?M:`${M}/`}#/event/${o}?join_code=${j.code}`;if(navigator.share)try{await navigator.share({title:`Junte-se Ã  minha equipe: ${j.name}`,text:`Use o cÃ³digo ${j.code} ou clique no link para entrar:`,url:J})}catch(se){se.name!=="AbortError"&&(await Ee(J),i("success","Link copiado!"))}else await Ee(J),i("success","Link copiado!")},jt=async j=>{const M=w.type==="ENROLL"?w.data:null;if(M)try{const P=await bt(M.id,j);P&&(k({type:"OPEN_TEAM_SUCCESS",payload:P}),i("success","Equipe criada com sucesso!"))}catch(P){i("error",P.message)}},kt=async()=>{const j=w.type==="TEAM_CONFIRM"?w.data:null;if(j)try{await yt(j),i("success","VocÃª entrou na equipe!"),k({type:"CLOSE"})}catch(M){i("error",M.message)}},Nt=async()=>{try{await vt(),i("success","VocÃª saiu da equipe.")}catch(j){i("error",j.message)}},St=async j=>{try{await wt(j),i("success","Membro removido.")}catch(M){i("error",M.message)}},Et=j=>{S(""),k({type:"OPEN_TEAM_INPUT",payload:j})},Ct=()=>{const j=w.type==="TEAM_INPUT"?w.data:null;if(j){if(N.toUpperCase()!==j.code){i("error","CÃ³digo incorreto.");return}k({type:"OPEN_TEAM_CONFIRM",payload:j})}},Qe=j=>{Ne(),k({type:"OPEN_ENROLL",payload:j}),j.isTeamEvent&&(C("join"),De(j.id))},Ye=(j,M)=>g.find(P=>P.eventId===j&&P.sessionId===M),ge=()=>k({type:"CLOSE"});if(p)return e.jsx("div",{className:"p-12 text-center text-gray-500 dark:text-gray-400 font-medium",children:"Carregando detalhes do evento..."});if(!d)return e.jsx("div",{className:"p-12 text-center text-red-500 dark:text-red-400 font-bold",children:"Evento nÃ£o encontrado."});const H=w.type==="ENROLL"?w.data:null,Ce=w.type==="TEAM_SUCCESS"?w.data:null,Oe=w.type==="TEAM_INPUT"?w.data:null,ye=w.type==="TEAM_CONFIRM"?w.data:null;return e.jsxs("div",{className:"space-y-8 pb-12",children:[e.jsx("nav",{className:"flex","aria-label":"Breadcrumb",children:e.jsxs("ol",{className:"flex items-center space-x-2",children:[e.jsx("li",{children:e.jsx($,{to:"/dashboard",className:"text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-indigo-400 font-medium transition",children:"Eventos"})}),e.jsx("li",{children:e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:"/"})}),e.jsx("li",{className:"text-gray-900 dark:text-white font-semibold","aria-current":"page",children:d.name})]})}),e.jsxs("div",{className:"bg-white dark:bg-darkcard rounded-2xl shadow-md overflow-hidden border border-gray-100 dark:border-gray-700 relative",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-primary to-indigo-400"}),e.jsx("div",{className:"p-8 md:p-10",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-start gap-6",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("div",{className:"inline-block px-3 py-1 rounded-full bg-indigo-50 dark:bg-indigo-900/30 text-indigo-700 dark:text-indigo-300 text-xs font-bold uppercase tracking-wide border border-indigo-100 dark:border-indigo-900/50",children:"Evento Principal"}),d.isTeamEvent&&e.jsx("div",{className:"inline-block px-3 py-1 rounded-full bg-purple-50 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 text-xs font-bold uppercase tracking-wide border border-purple-100 dark:border-purple-900/50",children:"ðŸ† Evento por Equipe"}),d.registrationLocked&&e.jsx("div",{className:"inline-block px-3 py-1 rounded-full bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 text-xs font-bold uppercase tracking-wide border border-red-200 dark:border-red-900",children:"ðŸ”’ InscriÃ§Ãµes Bloqueadas"})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold text-gray-900 dark:text-white mb-4 leading-tight",children:d.name}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-300 leading-relaxed mb-6 max-w-4xl",children:d.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-6 text-gray-500 dark:text-gray-400 text-sm font-medium",children:[e.jsxs("div",{className:"flex items-center bg-gray-50 dark:bg-gray-800 px-3 py-1.5 rounded-lg",children:[e.jsx("span",{className:"mr-2 text-xl",children:"ðŸ“"})," ",d.location]}),e.jsxs("div",{className:"flex items-center bg-gray-50 dark:bg-gray-800 px-3 py-1.5 rounded-lg",children:[e.jsx("span",{className:"mr-2 text-xl",children:"ðŸ“…"})," ",d.sessions.length," SessÃµes Principais"]})]})]}),d.sessions.length>0&&e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:()=>Qe(d),className:`w-full md:w-auto px-6 py-3 rounded-xl font-bold shadow-lg transition transform flex items-center justify-center
                                        ${d.registrationLocked?"bg-gray-300 dark:bg-gray-700 text-gray-500 cursor-not-allowed":"bg-primary hover:bg-indigo-700 text-white shadow-indigo-200 dark:shadow-none hover:-translate-y-1"}`,disabled:d.registrationLocked,children:[d.registrationLocked?"Fechado":"Ver ProgramaÃ§Ã£o",!d.registrationLocked&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ml-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7 7"})})]})})]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Atividades & Sub-eventos"}),e.jsx("div",{className:"h-px bg-gray-200 dark:bg-gray-700 flex-1"})]}),c.length===0?e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl p-12 text-center",children:[e.jsx("div",{className:"text-4xl mb-3 opacity-30",children:"ðŸ“‚"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:"Nenhuma atividade especÃ­fica cadastrada para este evento ainda."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:c.map(j=>{const M=j.sessions.length===1?j.sessions[0]:null,P=M?M.capacity:0,J=M?M.filled:0,se=P>0?J/P*100:0,ce=P>0&&J>=P,Fe=j.sessions.some(It=>Ye(j.id,It.id)),ue=j.registrationLocked;return e.jsxs("div",{className:"group bg-white dark:bg-darkcard rounded-xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 dark:border-gray-700 flex flex-col relative",children:[e.jsx("div",{className:`absolute top-0 left-0 w-1 h-full transition-colors ${ue?"bg-red-500":"bg-gray-200 dark:bg-gray-700 group-hover:bg-primary"}`}),e.jsxs("div",{className:"p-6 flex-1 flex flex-col ml-1",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white group-hover:text-primary dark:group-hover:text-indigo-400 transition-colors",children:j.name}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[j.isTeamEvent&&e.jsx("span",{className:"text-[10px] bg-purple-100 text-purple-800 px-2 py-0.5 rounded-full font-bold",children:"EQUIPE"}),ue&&e.jsx("span",{className:"text-[10px] bg-red-100 text-red-800 px-2 py-0.5 rounded-full font-bold",children:"BLOQUEADO"})]})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm line-clamp-3 mb-4 flex-1",children:j.description}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-300 mt-auto pt-4 border-t border-gray-50 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-6 text-center mr-2 text-gray-400 dark:text-gray-500",children:"ðŸ“"}),e.jsx("span",{className:"font-medium",children:j.location})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"w-6 text-center mr-2 text-gray-400 dark:text-gray-500",children:"ðŸ“…"}),e.jsx("span",{className:"font-medium",children:j.sessions.length>1?`${j.sessions.length} opÃ§Ãµes de horÃ¡rio`:`${Z(M==null?void 0:M.date)} â€¢ ${M==null?void 0:M.startTime}`})]})]}),M&&!ue&&e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"flex justify-between text-xs mb-1 font-bold",children:e.jsx("span",{className:ce?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400",children:ce?"LOTADO":j.isTeamEvent?`${P-J} equipes restantes`:`${P-J} vagas`})}),e.jsx("div",{className:"w-full bg-gray-100 dark:bg-gray-700 rounded-full h-1.5",children:e.jsx("div",{className:`h-full rounded-full ${ce?"bg-red-500":"bg-emerald-500"}`,style:{width:`${se}%`}})})]})]}),e.jsx("button",{onClick:()=>!ue&&Qe(j),disabled:ue&&!Fe,className:`w-full py-3 font-bold text-sm transition-colors border-t border-gray-100 dark:border-gray-700 ${Fe?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/40":ue?"bg-gray-100 dark:bg-gray-800 text-gray-400 cursor-not-allowed":"bg-gray-50 dark:bg-gray-800/50 hover:bg-primary hover:text-white dark:hover:bg-indigo-600 dark:hover:text-white text-primary dark:text-indigo-300"}`,children:Fe?"Gerenciar InscriÃ§Ã£o":ue?"InscriÃ§Ãµes Fechadas":"Inscrever-se Agora"})]},j.id)})}),e.jsx(le,{isOpen:w.type==="ENROLL",onClose:ge,title:H?H.name:"",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("p",{className:"text-gray-700 dark:text-gray-300 leading-relaxed",children:H==null?void 0:H.description}),(H==null?void 0:H.registrationLocked)&&e.jsx("div",{className:"mt-2 text-sm text-red-600 font-bold p-2 bg-red-50 rounded",children:"âš ï¸ Este evento nÃ£o estÃ¡ recebendo novas inscriÃ§Ãµes no momento."})]}),G&&e.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/30 border-l-4 border-amber-400 p-4 rounded-r-md",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-5 w-5 text-amber-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-bold text-amber-800 dark:text-amber-300",children:"Conflito de HorÃ¡rio"}),e.jsxs("div",{className:"mt-2 text-sm text-amber-700 dark:text-amber-200",children:[e.jsx("p",{className:"mb-2",children:"VocÃª jÃ¡ possui compromisso neste horÃ¡rio:"}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 bg-opacity-50 p-2 rounded border border-amber-200 dark:border-amber-700",children:[e.jsx("p",{className:"font-semibold",children:G.name}),e.jsx("p",{className:"text-xs",children:G.time})]})]})]})]})}),H!=null&&H.isTeamEvent?e.jsx("div",{className:"animate-fade-in",children:ee?e.jsxs("div",{className:"bg-white dark:bg-darkcard border border-gray-200 dark:border-gray-700 rounded-xl shadow-lg overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-600 p-6 text-white relative",children:[e.jsx("div",{className:"absolute top-4 right-4 bg-white/20 backdrop-blur rounded-full px-3 py-1 text-xs font-bold uppercase tracking-wider",children:"Minha Equipe"}),e.jsx("h3",{className:"text-2xl md:text-3xl font-extrabold mb-1 pr-24 md:pr-0",children:ee.name}),e.jsx("div",{className:"flex items-center gap-2 opacity-90 text-sm",children:e.jsxs("span",{children:["CapitÃ£o: ",ee.captainId===(a==null?void 0:a.uid)?"VocÃª":((Ke=be[ee.captainId])==null?void 0:Ke.name)||"Desconhecido"]})})]}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1",children:"CÃ³digo de Acesso"}),e.jsxs("div",{className:"flex items-center gap-2 bg-gray-50 dark:bg-gray-800 px-3 py-1 rounded border border-gray-200 dark:border-gray-700",children:[e.jsx("code",{className:"text-2xl font-mono font-bold text-primary dark:text-indigo-400 tracking-wide select-all",children:ee.code}),e.jsx("button",{onClick:()=>Ee(ee.code),className:"p-1.5 text-gray-500 hover:text-indigo-600 dark:text-gray-400 dark:hover:text-indigo-300 transition-colors",title:"Copiar cÃ³digo",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),e.jsx("div",{className:"h-6 w-px bg-gray-300 dark:bg-gray-600 mx-1"}),e.jsx("button",{onClick:()=>Je(ee),className:"p-1.5 text-gray-500 hover:text-indigo-600 dark:text-gray-400 dark:hover:text-indigo-300 transition-colors",title:"Compartilhar Link",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})})]})]}),e.jsxs("div",{className:"w-full md:w-auto text-left md:text-right",children:[e.jsx("p",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-1",children:"Membros"}),e.jsx("span",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:ee.members.length})]})]}),e.jsxs("div",{className:"border-t border-gray-100 dark:border-gray-700 pt-4",children:[e.jsx("h4",{className:"font-bold text-gray-900 dark:text-white mb-3 text-sm",children:"Integrantes"}),e.jsx("ul",{className:"space-y-2 mb-6",children:ee.members.map(j=>{var M,P,J,se;return e.jsxs("li",{className:"flex justify-between items-center text-sm p-3 rounded-lg bg-gray-50 dark:bg-gray-800/50 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-100 dark:bg-indigo-900 flex items-center justify-center text-primary dark:text-indigo-300 font-bold text-xs",children:(((M=He[j])==null?void 0:M.name)||((P=be[j])==null?void 0:P.name)||"U").charAt(0)}),e.jsxs("span",{className:`text-gray-700 dark:text-gray-300 ${j===(a==null?void 0:a.uid)?"font-bold":""}`,children:[j===(a==null?void 0:a.uid)?"VocÃª":((J=He[j])==null?void 0:J.name)||((se=be[j])==null?void 0:se.name)||"UsuÃ¡rio...",j===ee.captainId&&" ðŸ‘‘"]})]}),ee.captainId===(a==null?void 0:a.uid)&&j!==(a==null?void 0:a.uid)&&e.jsx("button",{onClick:()=>St(j),className:"text-red-500 hover:text-red-700 text-xs font-bold px-2 py-1 rounded hover:bg-red-50 dark:hover:bg-red-900/20",children:"Remover"})]},j)})}),e.jsx(de,{onClick:Nt,isLoading:Le,variant:"danger",className:"w-full",children:ee.captainId===(a==null?void 0:a.uid)?"Desfazer Equipe e Sair":"Sair da Equipe"})]})]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex p-1 bg-gray-100 dark:bg-gray-800 rounded-lg mb-6",children:[e.jsx("button",{onClick:()=>C("join"),className:`flex-1 py-2 text-sm font-bold rounded-md transition-all ${A==="join"?"bg-white dark:bg-darkcard text-primary shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}`,children:"Entrar em Equipe"}),e.jsx("button",{onClick:()=>C("create"),className:`flex-1 py-2 text-sm font-bold rounded-md transition-all ${A==="create"?"bg-white dark:bg-darkcard text-primary shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"}`,children:"Criar Nova Equipe"})]}),A==="join"&&e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 gap-3 max-h-[300px] overflow-y-auto pr-1",children:Se.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"text-2xl block mb-2",children:"ðŸ›¡ï¸"}),e.jsxs("p",{children:["Nenhuma equipe criada ainda.",e.jsx("br",{}),"Seja o primeiro a criar!"]})]}):Se.map(j=>{var M;return e.jsxs("div",{className:"group bg-white dark:bg-darkcard border border-gray-200 dark:border-gray-700 rounded-xl p-4 flex flex-col sm:flex-row justify-between items-start sm:items-center hover:shadow-md hover:border-primary/30 transition-all cursor-default gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 flex items-center justify-center text-lg flex-shrink-0",children:"ðŸ›¡ï¸"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("span",{className:"font-bold text-gray-900 dark:text-white block truncate",children:j.name}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 mt-0.5 flex-wrap",children:[e.jsxs("span",{children:["CapitÃ£o: ",((M=be[j.captainId])==null?void 0:M.name)||"..."]}),e.jsx("span",{className:"w-1 h-1 bg-gray-300 rounded-full hidden sm:block"}),e.jsxs("span",{className:"flex items-center text-primary dark:text-indigo-400 font-bold bg-primary/10 dark:bg-indigo-900/30 px-1.5 py-0.5 rounded",children:[j.members.length," membros"]})]})]})]}),e.jsx("button",{onClick:()=>Et(j),disabled:H.registrationLocked,className:`w-full sm:w-auto px-4 py-2 font-bold text-sm rounded-lg transition-colors ${H.registrationLocked?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-gray-50 dark:bg-gray-800 text-primary dark:text-indigo-400 hover:bg-primary hover:text-white dark:hover:bg-indigo-600 dark:hover:text-white"}`,children:H.registrationLocked?"Bloqueado":"Entrar"})]},j.id)})})}),A==="create"&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:"Escolha um horÃ¡rio disponÃ­vel para registrar sua equipe:"}),e.jsx("div",{className:"space-y-3 max-h-[300px] overflow-y-auto pr-1",children:H.sessions.map(j=>{const M=j.filled>=j.capacity,P=H.registrationLocked;return e.jsxs("div",{className:`p-4 border rounded-xl flex flex-col sm:flex-row justify-between items-start sm:items-center transition-all ${M||P?"bg-gray-50 border-gray-200 opacity-60":"bg-white dark:bg-darkcard border-gray-200 dark:border-gray-700 hover:border-primary/50 hover:shadow-sm"}`,children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx("span",{children:Z(j.date)}),e.jsx("span",{className:"text-xs font-normal text-gray-400",children:"|"}),e.jsxs("span",{children:[j.startTime," - ",j.endTime]})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:M?"Esgotado":`${j.capacity-j.filled} slots disponÃ­veis`})]}),e.jsx(de,{onClick:()=>jt(j.id),isLoading:Le,disabled:M||P,className:`w-full sm:w-auto mt-3 sm:mt-0 ${M||P?"bg-gray-300 text-gray-500":"bg-primary"}`,variant:M||P?"outline":"primary",children:P?"Bloqueado":M?"Lotado":"Criar Aqui"})]},j.id)})})]})]})}):e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-white mb-3 flex items-center",children:[e.jsx("span",{className:"bg-primary h-6 w-1 rounded mr-2"}),"Selecione uma SessÃ£o"]}),e.jsx("div",{className:"space-y-3 max-h-[400px] overflow-y-auto pr-1",children:H==null?void 0:H.sessions.map(j=>{const M=Ye(H.id,j.id),P=!!M,J=j.filled>=j.capacity,se=j.filled/j.capacity*100,ce=H.registrationLocked;return e.jsx("div",{className:`relative border rounded-lg p-4 transition-all ${P?"border-green-500 bg-green-50 dark:bg-green-900/20 ring-1 ring-green-500":J||ce?"border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 opacity-90":"border-gray-200 dark:border-gray-700 hover:border-primary hover:shadow-md bg-white dark:bg-darkcard"}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-gray-900 dark:text-white text-lg",children:Z(j.date)}),P&&e.jsx("span",{className:"bg-green-200 dark:bg-green-800 text-green-800 dark:text-green-200 text-[10px] font-bold px-2 py-0.5 rounded-full uppercase",children:"Inscrito"})]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 flex items-center gap-4",children:e.jsxs("span",{className:"flex items-center",children:["ðŸ•’ ",j.startTime," - ",j.endTime]})}),e.jsxs("div",{className:"mt-3 flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full ${J?"bg-red-500":se>80?"bg-amber-500":"bg-emerald-500"}`,style:{width:`${Math.min(se,100)}%`}})}),e.jsx("span",{className:`text-xs font-bold w-24 text-right ${J?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:J?"ESGOTADO":H.isTeamEvent?`${j.capacity-j.filled} equipes`:`${j.capacity-j.filled} vagas`})]})]}),e.jsx("div",{className:"flex items-center",children:P?e.jsx("button",{onClick:()=>M&&v(M.id),className:"w-full sm:w-auto bg-white dark:bg-gray-800 border border-red-300 dark:border-red-900 text-red-600 dark:text-red-400 font-bold py-2 px-4 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/30 transition-colors text-sm",children:"Cancelar"}):e.jsx(de,{onClick:()=>H&&T(H,j.id),isLoading:D,disabled:J||ce,className:`w-full sm:w-auto ${J||ce?"bg-gray-300 dark:bg-gray-700 text-gray-500 dark:text-gray-400 cursor-not-allowed":""}`,children:ce?"Bloqueado":J?"Lotado":"Inscrever"})})]})},j.id)})})]})]})}),e.jsx(le,{isOpen:w.type==="TEAM_SUCCESS",onClose:ge,title:"Dados da Equipe Criada",children:Ce&&a&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg border border-green-200 dark:border-green-900/50 text-center",children:[e.jsx("span",{className:"text-2xl mb-2 block",children:"ðŸŽ‰"}),e.jsx("h3",{className:"text-lg font-bold text-green-800 dark:text-green-300",children:"Equipe criada com sucesso!"}),e.jsx("p",{className:"text-sm text-green-700 dark:text-green-400",children:"Compartilhe o cÃ³digo abaixo com seus colegas."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase",children:"Nome da Equipe"}),e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-white font-medium",children:Ce.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase",children:"CapitÃ£o (VocÃª)"}),e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-white font-medium",children:a.name})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase",children:"RM"}),e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-white",children:a.rm||"-"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-500 uppercase",children:"Turma"}),e.jsx("div",{className:"p-3 bg-gray-100 dark:bg-gray-700 rounded border border-gray-200 dark:border-gray-600 text-gray-900 dark:text-white",children:_e(a.classId)})]})]}),e.jsxs("div",{className:"bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded border border-indigo-200 dark:border-indigo-800 text-center",children:[e.jsx("label",{className:"block text-xs font-bold text-indigo-500 uppercase mb-1",children:"CÃ³digo de Acesso"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("code",{className:"text-3xl font-mono font-bold text-indigo-700 dark:text-indigo-300 tracking-wider select-all",children:Ce.code}),e.jsx("button",{onClick:()=>Ee(Ce.code),className:"p-1.5 text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-200 transition-colors",title:"Copiar cÃ³digo",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),e.jsx("div",{className:"h-6 w-px bg-indigo-200 dark:bg-indigo-700 mx-1"}),e.jsx("button",{onClick:()=>Je(Ce),className:"p-1.5 text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-200 transition-colors",title:"Compartilhar Link",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})})})]})]})]}),e.jsx("button",{onClick:ge,className:"w-full bg-primary hover:bg-indigo-700 text-white font-bold py-3 rounded-lg shadow-md transition-colors",children:"Confirmar"})]})}),e.jsx(le,{isOpen:w.type==="TEAM_INPUT",onClose:ge,title:"CÃ³digo de Acesso",children:e.jsxs("div",{className:"space-y-6 pt-2",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-300",children:["Digite o cÃ³digo fornecido pelo capitÃ£o da equipe ",e.jsx("strong",{children:Oe==null?void 0:Oe.name}),"."]}),e.jsx(xe,{label:"CÃ³digo da Equipe",placeholder:"Ex: A1B2",value:N,onChange:j=>S(j.target.value.toUpperCase()),className:"text-center font-mono text-xl tracking-widest uppercase",autoFocus:!0}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:ge,className:"px-4 py-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"Cancelar"}),e.jsx("button",{onClick:Ct,className:"px-6 py-2 bg-primary text-white rounded font-bold hover:bg-indigo-700",children:"Verificar"})]})]})}),e.jsx(le,{isOpen:w.type==="TEAM_CONFIRM",onClose:ge,title:"Confirmar Entrada",children:ye&&a&&e.jsxs("div",{className:"space-y-5",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-100 dark:border-blue-900/30",children:[e.jsx("h4",{className:"font-bold text-blue-900 dark:text-blue-300 mb-2 border-b border-blue-200 dark:border-blue-800 pb-2",children:"Dados da Equipe"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 dark:text-blue-400",children:"Nome:"}),e.jsx("span",{className:"font-medium dark:text-gray-200",children:ye.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 dark:text-blue-400",children:"CapitÃ£o:"}),e.jsx("span",{className:"font-medium dark:text-gray-200",children:((Xe=be[ye.captainId])==null?void 0:Xe.name)||"..."})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-blue-700 dark:text-blue-400",children:"Turma do CapitÃ£o:"}),e.jsx("span",{className:"font-medium dark:text-gray-200",children:_e((Ze=be[ye.captainId])==null?void 0:Ze.classId)})]})]})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg border border-gray-100 dark:border-gray-700",children:[e.jsx("h4",{className:"font-bold text-gray-700 dark:text-gray-300 mb-2 border-b border-gray-200 dark:border-gray-600 pb-2",children:"Seus Dados (Entrando como Membro)"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Nome:"}),e.jsx("span",{className:"font-medium dark:text-white",children:a.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"RM:"}),e.jsx("span",{className:"font-medium dark:text-white",children:a.rm})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:"Turma:"}),e.jsx("span",{className:"font-medium dark:text-white",children:_e(a.classId)})]})]})]}),e.jsxs("div",{className:"text-center py-2",children:[e.jsx("span",{className:"text-xs font-bold text-gray-400 uppercase",children:"CÃ³digo Verificado"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"font-mono font-bold text-xl text-green-600 dark:text-green-400",children:ye.code}),e.jsx("button",{onClick:()=>Ee(ye.code),className:"p-1 text-gray-500 hover:text-green-600 dark:text-gray-400 dark:hover:text-green-400 transition-colors",title:"Copiar cÃ³digo",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:ge,className:"flex-1 py-3 border border-gray-300 dark:border-gray-600 rounded-lg text-gray-600 dark:text-gray-300 font-bold hover:bg-gray-50 dark:hover:bg-gray-700",children:"Cancelar"}),e.jsx(de,{onClick:kt,isLoading:Le,className:"flex-1 py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-lg shadow",children:"Confirmar Entrada"})]})]})}),e.jsx(Ge,{isOpen:!!I,onClose:()=>v(null),onConfirm:()=>I&&L(I),title:"Cancelar InscriÃ§Ã£o",message:"Tem certeza que deseja cancelar sua inscriÃ§Ã£o? A vaga serÃ¡ liberada imediatamente.",confirmText:"Sim, Cancelar",isProcessing:D})]})},Os=async(o,t,s,r,a)=>{const n=a||await _.getCertificateConfig(),i=new Dt({orientation:"landscape",unit:"mm",format:"a4"}),d=i.internal.pageSize.getWidth(),l=i.internal.pageSize.getHeight();if(n.backgroundType==="image"&&n.backgroundImage)try{i.addImage(n.backgroundImage,"PNG",0,0,d,l)}catch(x){console.error("Failed to load background image",x),i.setFillColor(n.backgroundColor||"#FFFFFF"),i.rect(0,0,d,l,"F")}else i.setFillColor(n.backgroundColor||"#FFFFFF"),i.rect(0,0,d,l,"F");n.showBorder!==!1&&(i.setDrawColor(0,0,0),i.setLineWidth(1),i.rect(10,10,d-10*2,l-10*2),i.setLineWidth(.5),i.rect(12,12,d-10*2-4,l-10*2-4));const c=x=>{let y=x;const p={"{student_name}":o.name||"Aluno","{student_email}":o.email||"","{student_rm}":o.rm||"","{event_name}":t.name,"{date}":Z(s.date),"{start_time}":s.startTime,"{end_time}":s.endTime,"{enrollment_id}":r,"{location}":t.location};if(y.includes("{hours}")){const E=s.startTime.split(":").map(Number),I=s.endTime.split(":").map(Number);let v=0;if(!isNaN(E[0])&&!isNaN(I[0])){const w=E[0]*60+(E[1]||0);v=(I[0]*60+(I[1]||0)-w)/60}v=Math.max(1,Math.round(v*10)/10),p["{hours}"]=v.toString()}return Object.keys(p).forEach(E=>{y=y.replace(new RegExp(E,"g"),p[E])}),y};n.elements.forEach(x=>{if(x.type==="text"||x.type==="variable"){const y=x.fontSize||12;i.setFontSize(y),i.setTextColor(x.fontColor||"#000000"),i.setFont(x.fontFamily||"helvetica",x.fontWeight||"normal");const p=c(x.content),E=x.align||"left";i.text(p,x.x,x.y,{align:E,maxWidth:d-20})}else if(x.type==="image"&&x.content&&x.width&&x.height)try{i.addImage(x.content,"PNG",x.x,x.y,x.width,x.height)}catch{console.error("Failed to render element image",x.label)}});const m=(o.name||"aluno").replace(/[^a-z0-9]/gi,"_").toLowerCase(),g=t.name.replace(/[^a-z0-9]/gi,"_").toLowerCase().substring(0,20),f=`certificado_${m}_${g}.pdf`;i.save(f)},Fs=()=>{const{user:o}=re(),{addToast:t}=ke(),[s,r]=b.useState([]),[a,n]=b.useState(null),[i,d]=b.useState(!0),[l,c]=b.useState(!1),[m,g]=b.useState(null),[f,x]=b.useState(null),y=async()=>{if(o){d(!0);try{const k=await _.getEnrollmentsForUser(o.uid);if(k.length===0){r([]),d(!1);return}const N=[...new Set(k.map(T=>T.eventId))],S=await _.getEventsByIds(N),A=new Map(S.map(T=>[T.id,T])),C=S.filter(T=>T.isTeamEvent),R=new Map;await Promise.all(C.map(async T=>{try{(await _.getTeamsForEvent(T.id)).forEach(D=>R.set(D.id,D))}catch(L){console.error(`Error loading teams for event ${T.id}`,L)}}));const O=k.map(T=>{const L=A.get(T.eventId);if(!L)return null;const D=L.sessions.find(Ne=>Ne.id===T.sessionId);if(!D)return null;const G=T.teamId?R.get(T.teamId):void 0;return{enrollment:T,event:L,session:D,team:G}}).filter(T=>T!==null);r(O)}catch(k){console.error("Failed to load enrollments data:",k),t("error","Falha ao carregar inscriÃ§Ãµes."),r([])}finally{d(!1)}}};b.useEffect(()=>{y()},[o]);const p=async()=>{if(a){c(!0);try{await _.cancelEnrollment(a),t("success","InscriÃ§Ã£o cancelada com sucesso.")}catch(k){console.error(k),t("error","Erro ao cancelar inscriÃ§Ã£o.")}finally{n(null),c(!1),y()}}},E=async k=>{try{await navigator.clipboard.writeText(k),t("success","CÃ³digo copiado!")}catch{}},I=(k,N,S)=>{o&&x({enrollmentId:k.id,event:N,sessionDate:S.date,sessionTime:`${S.startTime} - ${S.endTime}`,user:o,attended:k.attended})},v=async(k,N,S)=>{if(o){g(k.id);try{await new Promise(A=>setTimeout(A,50)),await Os(o,N,S,k.id),t("success","Certificado gerado com sucesso!")}catch(A){console.error(A),t("error","Erro ao gerar certificado.")}finally{g(null)}}},w=new Date().toISOString().split("T")[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Minha Agenda"}),i?e.jsx("div",{className:"bg-white dark:bg-darkcard shadow overflow-hidden sm:rounded-md border border-gray-200 dark:border-gray-700",children:e.jsx("ul",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:Array.from({length:3}).map((k,N)=>e.jsx(Ss,{},N))})}):s.length===0?e.jsx(ft,{title:"Agenda Vazia",description:"VocÃª ainda nÃ£o se inscreveu em nenhum evento."}):e.jsx("div",{className:"bg-white dark:bg-darkcard shadow overflow-hidden sm:rounded-md border border-gray-200 dark:border-gray-700",children:e.jsx("ul",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:s.map(({enrollment:k,event:N,session:S,team:A})=>{const C=S.date<w,R=C&&k.attended;return e.jsxs("li",{className:"px-6 py-4 flex flex-col sm:flex-row sm:items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-800/50 gap-4 transition-colors",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[N.isTeamEvent&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-indigo-100 text-indigo-800 dark:bg-indigo-900/40 dark:text-indigo-300 uppercase tracking-wide border border-indigo-200 dark:border-indigo-800",children:"ðŸ›¡ï¸ Equipe"}),k.attended&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-[10px] font-bold bg-green-100 text-green-800 dark:bg-green-900/40 dark:text-green-300 uppercase tracking-wide border border-green-200 dark:border-green-800",children:"âœ… PresenÃ§a"}),e.jsx("h3",{className:"text-lg font-medium text-primary dark:text-indigo-400",children:N.name})]}),e.jsxs("div",{className:"text-sm text-gray-700 dark:text-gray-300 mt-1 flex flex-wrap gap-x-4 gap-y-1",children:[e.jsxs("span",{children:["ðŸ“… ",Z(S.date)]}),e.jsxs("span",{children:["â° ",S.startTime," - ",S.endTime]}),e.jsxs("span",{children:["ðŸ“ ",N.location]})]}),A&&e.jsxs("div",{className:"mt-3 flex flex-col sm:flex-row sm:items-center items-start gap-3 p-3 bg-indigo-50 dark:bg-indigo-900/10 rounded-lg border border-indigo-100 dark:border-indigo-800/30 w-full sm:w-fit",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-200 dark:bg-indigo-800 flex items-center justify-center text-lg flex-shrink-0",children:"ðŸ›¡ï¸"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Sua Equipe"}),e.jsx("div",{className:"text-sm font-bold text-gray-900 dark:text-white",children:A.name})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pl-0 sm:pl-3 border-t sm:border-t-0 sm:border-l border-indigo-200 dark:border-indigo-700 pt-2 sm:pt-0 w-full sm:w-auto",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase mr-2 sm:mr-0",children:"CÃ³digo:"}),e.jsxs("button",{onClick:()=>E(A.code),className:"text-xs font-mono font-bold text-indigo-600 dark:text-indigo-300 hover:underline flex items-center gap-1",title:"Copiar CÃ³digo",children:[A.code," ðŸ“‹"]})]})]}),C&&!R&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 mt-2",children:"Evento Finalizado (Sem PresenÃ§a)"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 flex-shrink-0",children:[R?e.jsx("button",{onClick:()=>v(k,N,S),disabled:m===k.id,className:"w-full sm:w-auto text-sm px-4 py-2 rounded-lg transition border font-bold bg-amber-100 text-amber-800 border-amber-200 dark:bg-amber-900/40 dark:text-amber-300 dark:border-amber-800 hover:bg-amber-200 dark:hover:bg-amber-900/60 flex items-center justify-center gap-2 disabled:opacity-70 disabled:cursor-wait",children:m===k.id?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Gerando..."]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-base",children:"ðŸ…"})," Baixar Certificado"]})}):e.jsxs("button",{onClick:()=>I(k,N,S),className:"w-full sm:w-auto text-sm px-4 py-2 rounded-lg transition border font-medium bg-white dark:bg-darkcard border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 hover:bg-gray-50 dark:hover:bg-gray-800 flex items-center justify-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4h2v-4zM6 8v4M6 16v4m12-16H6a2 2 0 00-2 2v12a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2z"})}),"Ver Ticket"]}),!R&&e.jsx("button",{onClick:()=>n(k.id),disabled:C||k.attended,className:`w-full sm:w-auto text-sm px-4 py-2 rounded-lg transition border font-medium
                                                ${C||k.attended?"bg-gray-100 dark:bg-gray-800 text-gray-400 dark:text-gray-500 border-gray-200 dark:border-gray-700 cursor-not-allowed hidden sm:block":"text-red-600 dark:text-red-400 hover:text-white hover:bg-red-600 dark:hover:bg-red-500 border-red-200 dark:border-red-900/30"}`,children:C?"ConcluÃ­do":k.attended?"PresenÃ§a Confirmada":N.isTeamEvent?"Sair da Equipe":"Cancelar InscriÃ§Ã£o"})]})]},k.id)})})}),e.jsx(Ge,{isOpen:!!a,onClose:()=>n(null),onConfirm:p,title:"Cancelar InscriÃ§Ã£o",message:"Tem certeza que deseja cancelar sua inscriÃ§Ã£o neste evento? Se for um evento de equipe, vocÃª sairÃ¡ do grupo e a vaga poderÃ¡ ser perdida.",confirmText:"Sim, Cancelar",cancelText:"Manter InscriÃ§Ã£o",isProcessing:l}),e.jsx(le,{isOpen:!!f,onClose:()=>x(null),title:"Seu Ticket de Entrada",children:f&&e.jsxs("div",{className:"flex flex-col items-center justify-center p-4 space-y-6",children:[e.jsx("div",{className:`p-4 bg-white rounded-xl shadow-lg border-2 ${f.attended?"border-green-500":"border-gray-900"}`,children:e.jsx(At,{value:f.enrollmentId,size:200})}),e.jsxs("div",{className:"text-center space-y-1",children:[f.attended?e.jsx("span",{className:"inline-block px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-bold uppercase mb-2",children:"âœ… Check-in Realizado"}):e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Apresente este cÃ³digo na entrada"}),e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:f.event.name}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:[Z(f.sessionDate)," â€¢ ",f.sessionTime]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:f.event.location})]}),e.jsxs("div",{className:"w-full border-t border-gray-200 dark:border-gray-700 pt-4 text-center",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:f.user.name}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["RM: ",f.user.rm||"-"]}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-2 font-mono",children:f.enrollmentId})]})]})})]})},Ps=()=>{const{user:o}=re(),t=fe(),[s,r]=b.useState(new Date),[a,n]=b.useState({}),[i,d]=b.useState(!0),[l,c]=b.useState(null),m=(o==null?void 0:o.role)===B.ADMIN||(o==null?void 0:o.role)===B.COORDINATOR;b.useEffect(()=>{g()},[o]);const g=async()=>{if(o){d(!0);try{let v={};if(m){const{data:w}=await _.getEvents({limit:1e3,filters:{}});w.forEach(k=>{k.sessions.forEach(N=>{v[N.date]||(v[N.date]=[]),v[N.date].push({id:`cal_${k.id}_${N.id}`,title:k.name,date:N.date,startTime:N.startTime,endTime:N.endTime,location:k.location,type:k.registrationLocked?"locked":"available",originalEvent:k,sessionId:N.id})})})}else{const k=(await _.getEnrollmentsForUser(o.uid)).filter(N=>N.status===Y.CONFIRMED);if(k.length>0){const N=[...new Set(k.map(C=>C.eventId))],S=await _.getEventsByIds(N),A=new Map(S.map(C=>[C.id,C]));k.forEach(C=>{const R=A.get(C.eventId);if(R){const O=R.sessions.find(T=>T.id===C.sessionId);O&&(v[O.date]||(v[O.date]=[]),v[O.date].push({id:`cal_${R.id}_${O.id}`,title:R.name,date:O.date,startTime:O.startTime,endTime:O.endTime,location:R.location,type:"enrolled",originalEvent:R,sessionId:O.id}))}})}}n(v)}catch(v){console.error(v)}finally{d(!1)}}},f=(v,w)=>new Date(v,w+1,0).getDate(),x=(v,w)=>new Date(v,w,1).getDay(),y=v=>{const w=new Date(s.getFullYear(),s.getMonth()+v,1);r(w)},p=v=>{const w=(s.getMonth()+1).toString().padStart(2,"0"),k=v.toString().padStart(2,"0"),N=`${s.getFullYear()}-${w}-${k}`,S=a[N]||[];S.length>0&&c({date:N,events:S})},E=()=>{const v=s.getFullYear(),w=s.getMonth(),k=f(v,w),N=x(v,w),S=[];for(let A=0;A<N;A++)S.push(e.jsx("div",{className:"h-24 md:h-32 bg-gray-50 dark:bg-gray-800/30 border border-gray-100 dark:border-gray-700/50"},`empty-${A}`));for(let A=1;A<=k;A++){const C=(w+1).toString().padStart(2,"0"),R=A.toString().padStart(2,"0"),O=`${v}-${C}-${R}`,T=a[O]||[],L=new Date().toISOString().split("T")[0]===O;S.push(e.jsxs("div",{onClick:()=>p(A),className:`h-24 md:h-32 border border-gray-200 dark:border-gray-700 p-1 md:p-2 relative transition-colors 
                        ${T.length>0?"bg-white dark:bg-darkcard hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer":"bg-gray-50/50 dark:bg-gray-800/20"}
                        ${L?"ring-2 ring-inset ring-primary z-10":""}
                    `,children:[e.jsx("div",{className:`text-sm font-bold mb-1 ${L?"text-primary":"text-gray-700 dark:text-gray-300"}`,children:A}),e.jsxs("div",{className:"flex flex-col gap-1 overflow-hidden h-[calc(100%-24px)]",children:[e.jsxs("div",{className:"hidden md:flex flex-col gap-1",children:[T.slice(0,3).map((D,G)=>e.jsxs("div",{className:`text-[10px] truncate px-1.5 py-0.5 rounded border-l-2
                                        ${D.type==="enrolled"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300 border-green-500":D.type==="locked"?"bg-red-50 dark:bg-red-900/20 text-red-800 dark:text-red-300 border-red-500":"bg-indigo-50 dark:bg-indigo-900/20 text-indigo-800 dark:text-indigo-300 border-indigo-500"}`,children:[D.startTime," ",D.title]},G)),T.length>3&&e.jsxs("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 pl-1",children:["+ ",T.length-3," mais"]})]}),e.jsx("div",{className:"md:hidden flex flex-wrap gap-1 content-start mt-1",children:T.map((D,G)=>e.jsx("div",{className:`w-2 h-2 rounded-full 
                                        ${D.type==="enrolled"?"bg-green-500":D.type==="locked"?"bg-red-500":"bg-indigo-500"}
                                    `},G))})]})]},A))}return S},I=v=>{t(m?"/admin/events":`/event/${v.originalEvent.id}`)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:m?"CalendÃ¡rio Geral":"Minha Agenda"}),e.jsxs("div",{className:"flex items-center gap-4 bg-white dark:bg-darkcard p-1 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>y(-1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg text-gray-600 dark:text-gray-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsx("span",{className:"text-lg font-bold text-gray-800 dark:text-white w-40 text-center capitalize",children:s.toLocaleString("pt-BR",{month:"long",year:"numeric"})}),e.jsx("button",{onClick:()=>y(1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg text-gray-600 dark:text-gray-300",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-darkcard rounded-xl shadow border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"grid grid-cols-7 border-b border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-center py-2",children:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"].map(v=>e.jsx("div",{className:"text-xs font-bold text-gray-500 uppercase tracking-wider",children:v},v))}),e.jsx("div",{className:"grid grid-cols-7",children:i?e.jsx("div",{className:"col-span-7 h-96 flex items-center justify-center text-gray-500",children:"Carregando eventos..."}):E()})]}),e.jsx("div",{className:"flex flex-wrap gap-4 text-xs text-gray-600 dark:text-gray-400 justify-center sm:justify-start",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-indigo-500"})," Evento DisponÃ­vel"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-red-500"})," Bloqueado"]})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded bg-green-500"})," Minha InscriÃ§Ã£o"]})}),e.jsx(le,{isOpen:!!l,onClose:()=>c(null),title:l?`Eventos de ${Z(l.date)}`:"",children:e.jsx("div",{className:"space-y-3",children:l==null?void 0:l.events.sort((v,w)=>v.startTime.localeCompare(w.startTime)).map(v=>e.jsxs("div",{onClick:()=>I(v),className:`p-4 rounded-lg border-l-4 shadow-sm cursor-pointer transition-transform hover:-translate-y-0.5
                                ${v.type==="enrolled"?"bg-green-50 dark:bg-green-900/10 border-green-500 hover:bg-green-100 dark:hover:bg-green-900/20":v.type==="locked"?"bg-red-50 dark:bg-red-900/10 border-red-500 hover:bg-red-100 dark:hover:bg-red-900/20":"bg-indigo-50 dark:bg-indigo-900/10 border-indigo-500 hover:bg-indigo-100 dark:hover:bg-indigo-900/20"}
                            `,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white",children:v.title}),v.type==="enrolled"&&e.jsx("span",{className:"text-[10px] font-bold bg-green-200 text-green-800 px-2 py-0.5 rounded-full uppercase",children:"Inscrito"})]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-300 mt-1 flex items-center gap-3",children:[e.jsxs("span",{children:["ðŸ•’ ",v.startTime," - ",v.endTime]}),e.jsxs("span",{children:["ðŸ“ ",v.location]})]})]},v.id))})})]})},$s=ne.lazy(()=>me(()=>import("./AdminEvents-BuJdU-nY.js"),__vite__mapDeps([0,1,2,3,4])).then(o=>({default:o.AdminEvents}))),Us=ne.lazy(()=>me(()=>import("./AdminUsers-CVzGInSx.js"),__vite__mapDeps([5,1,2,3,4])).then(o=>({default:o.AdminUsers}))),zs=ne.lazy(()=>me(()=>import("./AdminCourses-PpTtgPm_.js"),__vite__mapDeps([6,1,2,3,4])).then(o=>({default:o.AdminCourses}))),Bs=ne.lazy(()=>me(()=>import("./AdminEventEnrollments-DebcoFfC.js"),__vite__mapDeps([7,1,2,3,8,4])).then(o=>({default:o.AdminEventEnrollments}))),qs=ne.lazy(()=>me(()=>import("./AdminScanner-CKbXQc8_.js"),__vite__mapDeps([9,1,2,3,4])).then(o=>({default:o.AdminScanner}))),Vs=ne.lazy(()=>me(()=>import("./AdminCertificateConfig-DUHjpaCt.js"),__vite__mapDeps([10,1,2,3,4])).then(o=>({default:o.AdminCertificateConfig}))),Ws=ne.lazy(()=>me(()=>import("./AdminPreStudents-BcY8kAIn.js"),__vite__mapDeps([11,1,2,3,4])).then(o=>({default:o.AdminPreStudents}))),Gs=ne.lazy(()=>me(()=>import("./DevTools-DOKC7Tyj.js"),__vite__mapDeps([12,1,2,3,4])).then(o=>({default:o.DevTools}))),Hs=()=>e.jsx("div",{className:"h-full w-full flex items-center justify-center p-10",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}),X=({children:o,allowedRoles:t})=>{const{user:s,loading:r}=re(),a=We();return r?e.jsx("div",{className:"h-screen flex items-center justify-center text-primary font-medium dark:bg-darkbg dark:text-gray-200",children:"Carregando EduEvent..."}):s?s.blocked&&window.location.hash!=="#/blocked"?e.jsx(Ie,{to:"/blocked",replace:!0}):!s.blocked&&!s.isOnboarded&&window.location.hash!=="#/complete-profile"?e.jsx(Ie,{to:"/complete-profile"}):t&&!t.includes(s.role)?e.jsx(Ie,{to:"/dashboard"}):e.jsx(e.Fragment,{children:o}):e.jsx(Ie,{to:"/login",state:{from:a},replace:!0})},Js=()=>{const{user:o}=re();return e.jsx(b.Suspense,{fallback:e.jsx(Hs,{}),children:e.jsxs(Rt,{children:[e.jsx(K,{path:"/",element:o?e.jsx(Ie,{to:"/dashboard"}):e.jsx(Ms,{})}),e.jsx(K,{path:"/special/:id",element:e.jsx(Rs,{})}),e.jsx(K,{path:"/login",element:e.jsx(bs,{})}),e.jsx(K,{path:"/blocked",element:e.jsx(ws,{})}),e.jsx(K,{path:"/complete-profile",element:e.jsx(X,{children:e.jsx(vs,{})})}),e.jsx(K,{path:"/dashboard",element:e.jsx(X,{children:e.jsx(te,{children:e.jsx(As,{})})})}),e.jsx(K,{path:"/calendar",element:e.jsx(X,{children:e.jsx(te,{children:e.jsx(Ps,{})})})}),e.jsx(K,{path:"/event/:id",element:e.jsx(X,{children:e.jsx(te,{children:e.jsx(_s,{})})})}),e.jsx(K,{path:"/my-enrollments",element:e.jsx(X,{children:e.jsx(te,{children:e.jsx(Fs,{})})})}),e.jsx(K,{path:"/admin/events",element:e.jsx(X,{allowedRoles:[B.ADMIN,B.COORDINATOR],children:e.jsx(te,{children:e.jsx($s,{})})})}),e.jsx(K,{path:"/admin/events/:id/enrollments",element:e.jsx(X,{allowedRoles:[B.ADMIN,B.COORDINATOR],children:e.jsx(te,{children:e.jsx(Bs,{})})})}),e.jsx(K,{path:"/admin/scanner",element:e.jsx(X,{allowedRoles:[B.ADMIN,B.COORDINATOR],children:e.jsx(te,{children:e.jsx(qs,{})})})}),e.jsx(K,{path:"/admin/courses",element:e.jsx(X,{allowedRoles:[B.ADMIN],children:e.jsx(te,{children:e.jsx(zs,{})})})}),e.jsx(K,{path:"/admin/users",element:e.jsx(X,{allowedRoles:[B.ADMIN],children:e.jsx(te,{children:e.jsx(Us,{})})})}),e.jsx(K,{path:"/admin/certificate",element:e.jsx(X,{allowedRoles:[B.ADMIN],children:e.jsx(te,{children:e.jsx(Vs,{})})})}),e.jsx(K,{path:"/admin/pre-students",element:e.jsx(X,{allowedRoles:[B.ADMIN],children:e.jsx(te,{children:e.jsx(Ws,{})})})}),e.jsx(K,{path:"/admin/dev",element:e.jsx(X,{allowedRoles:[B.ADMIN],children:e.jsx(te,{children:e.jsx(Gs,{})})})})]})})};function Qs(){return e.jsx(us,{children:e.jsx(hs,{children:e.jsx(xs,{children:e.jsx(Mt,{children:e.jsx(Js,{})})})})})}const pt=document.getElementById("root");if(!pt)throw new Error("Could not find root element to mount to");const Ys=Lt.createRoot(pt);Ys.render(e.jsx(ne.StrictMode,{children:e.jsx(Qs,{})}));export{Ge as C,ft as E,de as L,le as M,Ss as S,B as U,ks as a,re as b,tr as c,sr as d,Os as e,Z as f,Te as g,_ as s,ke as u};
